"use strict";function setupPool(t){if(!(t>=0))throw"setupPool takes a size >= 0 as argument.";for(this.pool=this.pool||[],this.poolSize=this.poolSize||0,this.pnew=pnew,Object.defineProperty?Object.defineProperty(this.prototype,"pdispose",{value:pdispose}):Object.prototype.pdispose=pdispose;this.poolSize<t;)(new this).pdispose();this.poolSize>t&&(this.poolSize=t,this.pool.length=t)}function pnew(){var t=null;return 0!==this.poolSize?(this.poolSize--,t=this.pool[this.poolSize],this.pool[this.poolSize]=null):t=new this,this.apply(t,arguments),t}function pdispose(){var t=this.constructor;this.dispose&&this.dispose(),t.pool[t.poolSize++]=this}if(!window.console)var console={log:function(){},warn:function(){}};if("Float32Array"in window||(console.log("no float32"),window.Float32Array=window.Array),Object.keys||(console.warn("This browser does not support Object.keys() . Using polyfill instead."),Object.keys=function(){var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=e.length;return function(h){if("object"!=typeof h&&("function"!=typeof h||null===h))throw new TypeError("Object.keys called on non-object");var o=[],n,r;for(n in h)t.call(h,n)&&o.push(n);if(i)for(r=0;r<s;r++)t.call(h,e[r])&&o.push(e[r]);return o}}()),"function"!=typeof Object.create&&(console.warn("This browser does not support Object.create() . Using polyfill instead."),Object.create=function(){var t=function(){};return function(i){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof i)throw new TypeError("Argument must be an object");t.prototype=i;var e=new t;return t.prototype=null,e}}()),function(){for(var t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.warn("This browser does not support requestAnimationFrame() . Using setTimeout() instead."),window.requestAnimationFrame=function(t){return window.setTimeout(function(){t(Date.now())},1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),!window.console)var console={log:function(){},warn:function(){}};"Float32Array"in window||(console.log("no float32"),window.Float32Array=window.Array),Object.keys||(console.warn("This browser does not support Object.keys() . Using polyfill instead."),Object.keys=function(){var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=e.length;return function(h){if("object"!=typeof h&&("function"!=typeof h||null===h))throw new TypeError("Object.keys called on non-object");var o=[],n,r;for(n in h)t.call(h,n)&&o.push(n);if(i)for(r=0;r<s;r++)t.call(h,e[r])&&o.push(e[r]);return o}}()),"function"!=typeof Object.create&&(console.warn("This browser does not support Object.create() . Using polyfill instead."),Object.create=function(){var t=function(){};return function(i){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof i)throw new TypeError("Argument must be an object");t.prototype=i;var e=new t;return t.prototype=null,e}}()),function(){for(var t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.warn("This browser does not support requestAnimationFrame() . Using setTimeout() instead."),window.requestAnimationFrame=function(t){return window.setTimeout(function(){t(Date.now())},1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var getWebGLContextType=function(){var t=document.createElement("canvas");return t.getContext("webgl")?"webgl":!!t.getContext("experimental-webgl")&&"experimental-webgl"},Studio=Studio||{stages:[],_current_stage:null,assets:{length:0},asset_count:0,queue:0,progress:0,active:!0,cap:50,draws:0,loaded:!0,version:"0.5.1",now:0,delta:0,time:1,RAF:null,browser_info:{type:navigator.userAgent.toLowerCase(),webGL:getWebGLContextType(),iOS:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},_temp:{}};Studio.updateProgress=function(){this.progress=this.queue/this.assets.length},Studio._continue=function(t){Studio.stages.length>1?Studio.RAF=requestAnimationFrame(Studio.loopAll):(Studio._current_stage=Studio.stages[0],Studio.RAF=requestAnimationFrame(Studio.loop))},Studio.start=function(t){Studio.queue===Studio.assets.length&&(Studio.progress=1),t?(Studio.now=t,Studio.time=t,Studio._continue()):Studio.RAF=requestAnimationFrame(Studio.start)},Studio._loop=function(){Studio._current_stage.active&&Studio._current_stage.loop(Studio.delta)},Studio.loop=function(t){Studio.tick(t),Studio.draws=0,Studio._loop(),Studio.RAF=requestAnimationFrame(Studio.loop)},Studio.loopAll=function(t){Studio.tick(t),Studio.draws=0;for(var i=0;i!==Studio.stages.length;i++)Studio._current_stage=Studio.stages[i],Studio._loop();Studio.RAF=requestAnimationFrame(Studio.loopAll)},Studio._tick={console:function(t){this.delta=16.6666666,this.now+=this.delta},capped:function(t){this.delta=t-this.now,this.now=t,this.delta=this.cap>this.delta?this.delta:this.cap},uncapped:function(t){this.delta=t-this.now,this.now=t}},Studio.tick=Studio._tick.capped,Studio._addingAsset=function(){this.assets.length++,this.updateProgress()},Studio._loadedAsset=function(){this.queue++,this.updateProgress(),this.asset_count++},Studio.handleVisibilityChange=function(){document.hidden?(console.log("%cStudio Paused (visibilitychange)",Studio.statStyle),cancelAnimationFrame(Studio.RAF)):(console.log("%cStudio Play (visibilitychange)",Studio.statStyle),Studio.RAF=requestAnimationFrame(Studio._continue))},document.addEventListener("visibilitychange",Studio.handleVisibilityChange,!1),Studio.z_index=function(t,i){return t.z<i.z?-1:t.z>i.z?1:0},Studio.round=function(t){return t+.5|0},Studio.apply=function(t){for(Studio._temp.keys=Object.keys(t),Studio._temp.keys_i=Studio._temp.keys.length;Studio._temp.keys_i;)"color_hex"===Studio._temp.key&&this.color&&this.color.setFromHex(t[Studio._temp.key]),Studio._temp.key=Studio._temp.keys[Studio._temp.keys_i-1],this[Studio._temp.key]=t[Studio._temp.key],Studio._temp.keys_i--;return this},Studio.addTo=function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(t[s]=e[s])}return t},Studio.inherit=function(t,i,e){t.prototype=e?new i(e):new i,t.prototype.constructor=t},Studio.windowResize=function(){for(var t=0;t!==Studio.stages.length;t++)Studio.stages[t].resize&&Studio.stages[t].resize()},window.addEventListener("resize",Studio.windowResize),Studio.TOP=Studio.LEFT=0,Studio.MIDDLE=Studio.CENTER=.5,Studio.BOTTOM=Studio.RIGHT=1,Studio.infoStyle="background-color: #3af; padding: 2px 4px; color: #fff",Studio.errorStyle="background-color: #c01; padding: 2px 4px;",Studio.warningStyle="background-color: #fd2; padding: 2px 4px;",Studio.statStyle="background-color: #eee; padding: 2px 4px; color: #555; font-size: 10px",Studio.engineStyle="background-color: #eee; color: #3af; padding: 1px 4px; border: 1px solid #3af",Studio.Point=function(t,i){return this.x=t||0,this.y=i||0,this.temp=0,this},Studio.Point.prototype={constructor:Studio.Point,translate:function(t,i){this.x+=t,this.y+=i},scale:function(t,i){this.x*=t,this.y*=i},rotate:function(t,i){this.temp=this.x*i-this.y*t,this.y=this.x*t+this.y*i,this.x=this.temp},set:function(t,i){this.x=t,this.y=i}},Studio.Box=function(t,i,e,s){return this.TL=new Studio.Point(t,i),this.TR=new Studio.Point(t+e,i),this.BR=new Studio.Point(t,i+s),this.BL=new Studio.Point(t+e,i+s),this.left=0,this.right=0,this.top=0,this.bottom=0,this.sin=0,this.cos=0,this},Studio.Box.prototype={constructor:Studio.Box,set:function(t,i,e,s){this.TL.set(t,i),this.TR.set(t+e,i),this.BL.set(t,i+s),this.BR.set(t+e,i)},get_bounds:function(t){t._world.rotation?t.skews?this.get_rotated_bounds_w_skew(t):this.get_rotated_bounds(t):this.get_straight_bounds(t)},get_straight_bounds:function(t){this.TL.set(t._dx-t._world.width*t.anchorX,t._dy-t._world.height*t.anchorY),this.TR.set(this.TL.x+t._world.width,this.TL.y),this.BR.set(this.TR.x,this.TR.y+t._world.height),this.BL.set(this.TL.x,this.BR.y)},_shift:function(t,i){this.TL.translate(t,i),this.TR.translate(t,i),this.BR.translate(t,i),this.BL.translate(t,i)},_scale:function(t,i){this.TL.scale(t,i),this.TR.scale(t,i),this.BR.scale(t,i),this.BL.scale(t,i)},_set_orbit_xy:function(t,i){this.TL.x=this.left*i-this.top*t,this.TL.y=this.left*t+this.top*i,this.TR.x=this.right*i-this.top*t,this.TR.y=this.right*t+this.top*i,this.BR.x=this.right*i-this.bottom*t,this.BR.y=this.right*t+this.bottom*i,this.BL.x=this.left*i-this.bottom*t,this.BL.y=this.left*t+this.bottom*i},_set_bounds:function(t,i,e,s){this.left=-t,this.right=this.left+e,this.top=-i,this.bottom=this.top+s},get_rotated_bounds_w_skew:function(t){this.sin=Math.sin(t._dAngle),this.cos=Math.cos(t._dAngle),this._set_bounds(t.width*t.anchorX,t.height*t.anchorY,t.width,t.height),this._set_orbit_xy(this.sin,this.cos),this._scale(t._world.scaleX,t._world.scaleY),this._shift(t._dx,t._dy)},get_rotated_bounds:function(t){this.sin=Math.sin(t._dAngle),this.cos=Math.cos(t._dAngle),this._set_bounds(t._world.width*t.anchorX,t._world.height*t.anchorY,t._world.width,t._world.height),this._set_orbit_xy(this.sin,this.cos),this._shift(t._dx,t._dy)}},Studio.RECT_BOX=new Studio.Box(10,0,0,0),Studio.Color=function(t,i,e,s){return this.r=t/255||0,this.g=i/255||0,this.b=e/255||0,this.a=s||1,this.style="rgba(255,255,255,1)",this._build_style(),this},Studio.Color.prototype={constructor:Studio.Color,set:function(t,i,e,s){return this.r=t/255,this.g=i/255,this.b=e/255,this.a=s,this._build_style(),this},red:function(t){return this.r=t,this},green:function(t){return this.g=t,this},blue:function(t){return this.b=t,this},alpha:function(t){return this.a=t,this},build:function(){return this._build_style(),this},setFromHex:function(t){if(t)return 4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff"),7===t.length&&(t+="ff"),this.set("0x"+t[1]+t[2]|0,"0x"+t[3]+t[4]|0,"0x"+t[5]+t[6]|0,("0x"+t[7]+t[8]|0)/255),this},_build_style:function(){this.style="rgba("+parseInt(255*this.r)+","+parseInt(255*this.g)+","+parseInt(255*this.b)+","+this.a+")"},dirty:!1},Studio.RED=new Studio.Color(204,0,17,1),Studio.ORANGE=new Studio.Color(255,150,0),Studio.YELLOW=new Studio.Color(255,221,34,1),Studio.GREEN=new Studio.Color(0,200,0,1),Studio.BLUE=new Studio.Color(51,170,255,1),Studio.PURPLE=new Studio.Color(128,0,255,1),Studio.WHITE=new Studio.Color(255,255,255,1),Studio.BLACK=new Studio.Color(0,0,0,1),Studio.TRANSPARENT=Studio.TRANS=new Studio.Color(0,0,0,0),Studio.DisplayProperty=function(){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.angle=0,this.alpha=1,this.speed=1},Studio.DisplayProperty.prototype={constructor:Studio.DisplayProperty,apply:Studio.apply},Studio.Messenger=function(){this.listeners={},this.message=0},Studio.Messenger.constructor=Studio.Messenger,Studio.Messenger.prototype.addListener=function(t,i){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({callback:i})},Studio.Messenger.prototype.addListenerTo=function(t,i,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({callback:i,who:e})},Studio.Messenger.prototype.sendMessage=function(t,i){this.message=i;var e=null;if(this.listeners[t])for(var s=0;s<this.listeners[t].length;s++)e=this.listeners[t][s].who,e?e[this.listeners[t][s].callback].call(e,this.message,t):this.listeners[t][s].callback(this.message,t)};var LinkedList=function(){this.first=null,this.last=null,this.length=0};LinkedList.prototype={add:function(t){return++this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},addItems:function(t){for(var i=0;i!==arguments.length;i++)this.add(arguments[i])},insert:function(t,i){this.length++,t.prev=i,i!==this.last?i.next=t:(this.last=t,t.next=this.first)},init:function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.length=0},remove:function(t){if(1===this.length)return this.init(),t.next=null,void(t.prev=null);this.first===t?this.first=this.first.next:this.last===t&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=null,t.prev=null,null===this.first&&(this.last=null),this.length--},update:function(t,i){for(var e=this.first;e;)this.next=e.next,e.update(t,i),e=e.next||this.next},render:function(t,i){for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},action:function(t){for(var i=this.first;i;)this.next=i.next,i[t](),i=i.next||this.next},removeAll:function(t){for(var i=this.first;i;)this.next=i.next,this.pdispose&&this.pdispose(),this.remove(i),i=i.next||this.next;i=null,t&&this.add(t)},toString:function(){for(var t=this.first,i="linked list : [";t;)i+=t,t=t.next;i+="];"},constructor:LinkedList},Studio.Plugin=function(t){this.init=null,this.options={},this.action=null,this.apply(t)},Studio.Plugin.constructor=Studio.Plugin,Studio.Plugin.prototype.apply=Studio.apply,Studio.Plugin.prototype._options=function(t){for(var i in t)this.options[i]=t[i]},Studio.Image=function t(i,e){return this.path=i+"_"+parseInt(1e5*Math.random()).toString(16),this.bitmap=null,this.width=1,this.height=1,this.slice={Full:{x:0,y:0,width:1,height:1}},this.sliceGL={},e&&this.addSlice(e),i&&this.loadImage(i),this},Studio.inherit(Studio.Image,Studio.Messenger),Studio.Image.prototype.ready=!1,Studio.Image.prototype.height=1,Studio.Image.prototype.width=1,Studio.Image.prototype._onImageLoad=function t(i){return Studio.progress=Studio.queue/Studio.assets.length,Studio._loadedAsset(),this._setWidthHeights(i),i},Studio.Image.prototype._setWidthHeights=function(t){this.slice.Full.height=t.height,this.slice.Full.width=t.width,this.width=t.width,this.height=t.height,this.addSlice(this.slice),this.ready=!0,this.sendMessage("ready",this.ready)},Studio.Image.prototype.loadImage=function t(i){var e=this;if(Studio.assets[i])return console.warn("Already loaded : ",i,Studio.assets[i]),this.bitmap=Studio.assets[i],Studio.assets.width?(this.ready=!0,this.sendMessage("ready",this.ready)):Studio.assets[i].addEventListener("load",function(t){e._setWidthHeights(t.target)}),this;Studio.assets[i]=new Image,Studio._addingAsset(),Studio.assets[i].addEventListener("load",function(t){e._onImageLoad(t.target)}),Studio.assets[i].src=i,this.bitmap=Studio.assets[i]},Studio.Image.prototype.buildSliceForGL=function t(i){var e=i.x/this.width,s=i.y/this.height;return{x:e,y:s,width:i.width/this.width+e,height:i.height/this.height+s}},Studio.Image.prototype.addSlice=function t(i){for(var e in i)this.slice[e]=i[e],this.sliceGL[e]=this.buildSliceForGL(i[e])},Studio.Image.prototype._rebuildGLSlices=function(){for(var t in this.slice)this.sliceGL[t]=this.buildSliceForGL(this.slice[t])},Studio.Cache=function(t,i,e){this.resolution=e||1,this.path="cache_"+parseInt(1e5*Math.random()).toString(16),this.bitmap=document.createElement("canvas"),this.bitmap.width=t*this.resolution||512,this.bitmap.height=i*this.resolution||512,this.width=t,this.height=i,this.ready=!1,this.ctx=this.bitmap.getContext("2d"),this.ctx.scale(e,e),this.slice.Full={x:0,y:0,width:this.bitmap.width,height:this.bitmap.height},this.sliceGL.Full={x:0,y:0,width:1,height:1},Studio.DEBUG&&document.body.appendChild(this.bitmap)},Studio.inherit(Studio.Cache,Studio.Image),Studio.Cache.prototype.applyEffect=function(t){t.action(this)},Studio.Ease={},Studio.Ease.linear=function(t){return t},Studio.Ease.snap=function(t){return t+.5|0},Studio.Ease.chillInOut=function(t){var i=.75;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},Studio.Ease.backOut=function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},Studio.Ease.bounceOut=function(t){return t<.363636?7.5625*t*t:t<.727272?7.5625*(t-=.545454)*t+.75:t<.90909?7.5625*(t-=.818181)*t+.9375:7.5625*(t-=.959595)*t+.984375},Studio.Ease.elasticOut=function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/6.283,e*Math.pow(2,-10*t)*Math.sin(6.283*(t-i)/s)+1)},Studio.Ease.linearRandom=function(t){return Math.random()*t},Studio.Ease.random=function(){return Math.random()},Studio.Ease.shake=function(){return Math.random()-.5},Studio.Ease.quadIn=function(t){return t*t},Studio.Ease.quadOut=function(t){return t*(2-t)},Studio.Ease.quadInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Studio.createPool=function(t,i){var e=[],s=i||0;t.constructor!=t&&(t.constructor=t);for(var h=0;h!=s;h++)e[h]=new t,e[h].init&&e[h].init();t.fromPool=function(i){var h=e[--s];return h||(h=new t,s++),e[s]=null,i&&h.apply(i),h},t.prototype.intoPool=function(){e[s]=this,s++},t.getPoolCapacity=function(){return e.length},t.getPool=function(){return e},t.isPoolEmpty=function(){return 0===s}},Studio.DisplayObject=function(t){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.anchorX=.5,this.anchorY=.5,this.rotation=0,this.skews=0,this.alpha=1,this.visible=1,this.speed=1,this.active=1,this.orbits=!0,this.orbit=0,this.inheritRotation=!0,this.inheritScale=!0,this.orbitSpeed=1,t&&this.apply(t),this._boundingBox=new Studio.Box,this._parent=null,this._hasChildren=0,this.__x=this._world.x,this.__y=this._world.y,this._dx=this._world.x,this._dy=this._world.y},Studio.difference={},Studio.DisplayObject.prototype={constructor:Studio.DisplayObject,_world:new Studio.DisplayProperty,blendmode:"source-over",apply:Studio.apply,__update_XY:!0,__update_SCALE:!0,__update_DIMENSIONS:!0,__update_SPEED:!0,__update_ALPHA:!0,__update_ROTATION:!0,addChild:function(t){return this.hasOwnProperty("children")||(this.children=[]),this.hasOwnProperty("_world")||(this._world=new Studio.DisplayProperty,this._initWorld()),t.hasOwnProperty("_world")||(t._world=new Studio.DisplayProperty),t._parent=this._world,t._parent_box=this._boundingBox,this.children[this._hasChildren]=t,this._hasChildren++,t.force_update(),t._dset(),t._hasChildren&&t.force_update_children(),this},removeChildAtIndex:function(t){for(var i=this.children.length-1,e=t;e<i;e++)this.children[e]=this.children[e+1];this.children.length=i,this._hasChildren=i},removeChild:function(t){for(var i=this.children.length-1,e=0;e<=i;e++)if(this.children[e]==t)return void this.removeChildAtIndex(e);console.log("child not found.")},_initWorld:function(){this._world.x=this.x,this._world.y=this.y,this._world.y=this.y,this._world.z=this.z,this._world.height=this.height,this._world.width=this.width,this._world.scaleX=this.scaleX,this._world.scaleY=this.scaleY,this._world.rotation=this.rotation,this._world.angle=this.angle,this._world.alpha=this.alpha,this._world.speed=this.speed},addChildren:function(){for(var t=0;t!==arguments.length;t++)this.addChild(arguments[t]);return this},getChildByName:function(t){for(var i=0;i!==this._hasChildren;i++)if(this.children[i].name===t)return this.children[i];return null},_destroy:function(){for(var t in this)this.hasOwnProperty(t)||delete this[t]},_order:function(){this.children.sort(Studio.z_index)},draw:function(){},snapPixels:function(){this._dx=this._dx+0|0,this._dy=this._dy+0|0,this._world.height=this._world.height+0|0,this._world.width=this._world.width+0|0},hitTestPoint:function(t,i){return this._relativeX=t-this._world.x,this._relativeY=i-this._world.y,this.anchoredX=this.anchorX*this._world.width,this.anchoredY=this.anchorY*this._world.height,!(this._relativeX<-this.anchoredX&&this._relativeY<-this.anchoredY)&&(!(this._relativeX>this.width&&this._relativeY>this.height)&&(this._world.rotation&&(t=this._relativeX*Math.cos(-this.angle)-this._relativeY*Math.sin(-this.angle),i=this._relativeX*Math.sin(-this.angle)+this._relativeY*Math.cos(-this.angle),this._relativeX=t,this._relativeY=i),this._relativeX>-this.anchoredX&&this._relativeY>-this.anchoredY&&this._relativeX<this._world.width-this.anchoredX&&this._relativeY<this._world.height-this.anchoredY))},hitTestRect:function(t){return Studio.difference.height=this._world.height+t._world.height,Studio.difference.width=this._world.width+t._world.width,Studio.difference.x=this._world.x-this._world.width*this.anchorX-t._world.x-t._world.width*t.anchorX,Studio.difference.y=this._world.y-this._world.height*this.anchorY-t._world.y-t._world.height*t.anchorY,Studio.difference.x<0&&Studio.difference.y<=0&&Studio.difference.height+Studio.difference.y>=0&&Studio.difference.width+Studio.difference.x>=0},vertex_children:function(t,i,e){if(this._hasChildren)for(var s=0;s<this._hasChildren;s++){if(!this.children[s].buildElement)return void console.log("no build",this.children[s]);this.children[s].buildElement(t,i,e),this.children[s]&&this.children[s].vertex_children(t,i,e)}},buildElement:function(t,i,e){},render_children:function(t,i,e){if(this._hasChildren)for(var s=0;s<this._hasChildren;s++)this.children[s].render(t,i,e)},render:function(t,i,e){this._visible&&(e?this._delta(i):this._dset(),t.snap&&this.snapPixels(),this.draw(t.ctx),this.render_children(t,i,e)),this.onExitFrame&&this.onExitFrame()},update_visibility:function(){this._world.alpha=this.alpha*this._parent.alpha,this._visible=this._world.alpha*this.visible},setAlpha:function(t){this._world.alpha!==t.globalAlpha&&this._visible&&(t.globalAlpha=this._world.alpha),this.blendmode!==t.globalCompositeOperation&&this._visible&&(t.globalCompositeOperation=this.blendmode)},update_scale:function(){this.inheritScale?(this._world.scaleX=this._parent.scaleX*this.scaleX,this._world.scaleY=this._parent.scaleY*this.scaleY):(this._world.scaleX=this.scaleX,this._world.scaleY=this.scaleY)},update_dimensions:function(){this._world.width=this.width*this._world.scaleX,this._world.height=this.height*this._world.scaleY},update_angle:function(){this.angle=this._world.rotation/180*3.14159265},update_speed:function(){this._world.speed=this.speed*this._parent.speed},orbitXY:function(){var t=this.x*this._world.scaleX,i=this.y*this._world.scaleY,e=Math.sin((this._parent.angle+this.orbit)*this.orbitSpeed),s=Math.cos((this._parent.angle+this.orbit)*this.orbitSpeed);this._orbitX=t*s-i*e,this._orbitY=t*e+i*s},update_rotation:function(){this.inheritRotation?this._world.rotation=this._parent.rotation+this.rotation:this._world.rotation=this.rotation,this._world.rotation?this.update_angle():this.angle=0},update_orbit_xy:function(){this.orbitXY(),this._world.x=this._orbitX+this._parent.x,this._world.y=this._orbitY+this._parent.y},update_xy:function(){this.orbits&&this._parent.angle?this.update_orbit_xy():(this._world.x=this.x*this._parent.scaleX+this._parent.x,this._world.y=this.y*this._parent.scaleY+this._parent.y)},snapshot:function(){this.__x=this._world.x,this.__y=this._world.y,this.__update_DIMENSIONS&&(this.__width=this._world.width,this.__height=this._world.height),this._world.rotation&&(this._world.angle=this.angle)},__deltaXY:function(t){this.__update_XY&&(this._dx=this.__delta(this.__x,this._world.x,t),this._dy=this.__delta(this.__y,this._world.y,t))},__deltaHW:function(t){this.__update_DIMENSIONS&&(this._dwidth=this.__delta(this.__width,this._world.width,t),this._dheight=this.__delta(this.__height,this._world.height,t))},__deltaRotation:function(t){this._world.rotation&&(this._dAngle=this.__delta(this._world.angle,this.angle,t))},__delta:function(t,i,e){return t+(i-t)*e},_delta:function(t){this.__deltaXY(t),this.__deltaHW(t),this.__deltaRotation(t)},__dsetXY:function(){this.__update_XY&&(this._dx=this._world.x,this._dy=this._world.y)},__dsetHW:function(){this._dwidth=this._world.width,this._dheight=this._world.height},__dsetRotation:function(){this._world.rotation&&(this._dAngle=this._world.angle+this.angle)},_dset:function(){this.__dsetXY(),this.__dsetHW(),this.__dsetRotation()},_snapback:function(){this.force_update()},force_update:function(){this.update_visibility(),this.update_scale(),this.update_speed(),this.update_dimensions(),this.update_rotation(),this.update_xy(),this.snapshot()},force_update_children:function(t){for(var i=0;i<this._hasChildren;i++)this.children[i].force_update();for(var i=0;i<this._hasChildren;i++)this.children[i]._dset()},_update:function(t){this.__update_ALPHA&&this.update_visibility(),this._visible&&(this.__update_SCALE&&this.update_scale(),this.__update_SPEED&&this.update_speed(),this.__update_DIMENSIONS&&this.update_dimensions(),this.__update_ROTATION&&this.update_rotation(),this.__update_XY&&this.update_xy(),this.update_children(t))},update_children:function(t){if(this._hasChildren)for(var i=0;i<this._hasChildren;i++)this.children[i].update(t)},_logic:function(){this.logic&&this.logic(),this.onEnterFrame&&this.onEnterFrame()},setAnchor:function(t,i){this.anchorX=t,this.anchorY=i||t},update:function(t){t&&this.snapshot(),this._logic(),this._update(t)}},Studio.DisplayList=function(t){this.cache=null,this.ctx=null,this.cached=!1,this.first=null,this.last=null,this.length=0,this.marked=[],this.autoCache=!0,t&&this.apply(t)},Studio.inherit(Studio.DisplayList,Studio.DisplayObject),Studio.DisplayList.prototype.cacheAsBitmap=function(t){this.cache=document.createElement("canvas"),this.cache.height=this.height*t.resolution,this.cache.width=this.width*t.resolution,this.ctx=this.cache.getContext("2d"),this.ctx.scale(t.resolution,t.resolution)},Studio.DisplayList.prototype.updateCache=function(){this.cached=!1,this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1),this.cached=!0},Studio.DisplayList.prototype._cacheIt=function(){this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1)},Studio.DisplayList.prototype.updateElement=function(t){t.render(this)},Studio.DisplayList.prototype.clearCachedElement=function(t){this.ctx.clearRect(t._world.x-t.width/2,t._world.y-t.height/2,t.width,t.height)},Studio.DisplayList.prototype.markedForRemoval=function(t){this.marked[this.marked.length]=t},Studio.DisplayList.prototype.removeMarked=function(){for(var t=0;t!==this.marked.length;t++)this.marked[t]&&this.clearCachedElement(this.marked[t]),this.marked[t]=null;this.marked.lengh=0},Studio.DisplayList.prototype.deactivateCache=function(){this.cached=!1},Studio.DisplayList.prototype.update=function(){this.marked.length&&this.removeMarked(),this.update_visibility(),this.update_scale(),this.update_dimensions(),this.update_xy(),this.update_speed();for(var t=this.first;t;)this.next=t.next,t.update(),t=t.next||this.next;!this.cached&&this.autoCache&&this.ctx&&this.updateCache()},Studio.DisplayList.prototype.render=function(t,i){if(this.cached)this._world.alpha!==t.ctx.globalAlpha&&(t.ctx.globalAlpha=this._world.alpha),this.draw(t.ctx);else for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},Studio.DisplayList.prototype.add=function(t){return t._parent=this,++this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},Studio.DisplayList.prototype.draw=function(t){t.drawImage(this.cache,0,0,this.cache.width,this.cache.height,this._world.x,this._world.y,this._world.width,this._world.height)},Studio.addTo(Studio.DisplayList.prototype,LinkedList.prototype),Studio.Rect=function(t){this.color=new Studio.Color(255,255,255,1),this.dirty=0,t&&this.apply(t)},Studio.inherit(Studio.Rect,Studio.DisplayObject),Studio.DefaultImage=new Studio.Cache(1,1,1),Studio.DefaultImage.ctx.fillStyle="#fff",Studio.DefaultImage.ctx.fillRect(0,0,1,1),Studio.BufferGL=function(t,i,e){this.bytes=36,this.size=i||e._maxCount,this.data=new Float32Array(this.size*this.bytes),this.count=0,this.texture=t||Studio.DefaultImage},Studio.BufferGL.prototype.constructor=Studio.BufferGL,Studio.BufferGL.prototype.draw=function(t){this.count&&(!this._texture&&this.texture&&this.setTexture(t,1),this.texture&&(t.bindTexture(t.TEXTURE_2D,this._texture),this.texture.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.texture.bitmap),this.texture.dirty=!1)),t.bufferData(t.ARRAY_BUFFER,this.data,t.DYNAMIC_DRAW),t.drawElements(t.TRIANGLES,this.count/6,t.UNSIGNED_SHORT,0),this.count=0)},Studio.BufferGL.prototype.prepTexture=function t(i){this._texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.vertexAttribPointer(i.positionLocation,3,i.FLOAT,i.FALSE,this.bytes,0),i.vertexAttribPointer(i.colorLocation,4,i.FLOAT,i.FALSE,this.bytes,12),i.vertexAttribPointer(i.textureLocation,2,i.FLOAT,i.FALSE,this.bytes,28),i.bufferData(i.ARRAY_BUFFER,this.data,i.DYNAMIC_DRAW)},Studio.BufferGL.prototype.setTexture=function t(i,e){this._texture||this.prepTexture(i),this.texture&&(this.texture.updateGlTexture&&this.texture.updateGlTexture(i),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this.texture.bitmap),e&&i.generateMipmap(i.TEXTURE_2D))},Studio.Rect.prototype.addXYZ=function(t,i,e){t.data[t.count++]=i.x,t.data[t.count++]=i.y,t.data[t.count++]=-1e-6*e.draws},Studio.Rect.prototype.addRGBA=function(t,i){t.data[t.count++]=i.r,t.data[t.count++]=i.g,t.data[t.count++]=i.b,t.data[t.count++]=i.a*this._world.alpha},Studio.Rect.prototype.addTX=function(t,i,e){t.data[t.count++]=i,t.data[t.count++]=e},Studio.Rect.prototype.addVert=function(t,i,e,s,h){this.addXYZ(t,i,h),this.addRGBA(t,this.color),this.addTX(t,e,s)},Studio.Rect.prototype.verts=function(t,i){var e=i.rect_buffer;this.addVert(e,t.TL,0,0,i),this.addVert(e,t.TR,0,0,i),this.addVert(e,t.BL,0,0,i),this.addVert(e,t.BR,0,0,i)},Studio.Rect.prototype.buildElement=function(t,i,e){t.draws++,e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.verts(this._boundingBox,t)},Studio.Rect.prototype.buildTriangles=function(t,i){this._delta(i),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._world.z,this.bounds.left,this.bounds.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.bounds.right,this.bounds.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.bounds.left,this.bounds.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.bounds.right,this.bounds.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.bounds.left,this.bounds.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._world.z,this.bounds.right,this.bounds.bottom)},Studio.Rect.prototype.setStyle=function(t){this.color.dirty&&this.color._build_style(),this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Rect.prototype.prepAngled=function(t){(this._dx||this._dy)&&t.translate(this._dx,this._dy),this.skews||t.rotate(this._dAngle||0),1===this._world.scaleX&&1===this._world.scaleY||t.scale(this._world.scaleX,this._world.scaleY),this.skews&&t.rotate(this._dAngle||0)},Studio.Rect.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.fillRect(-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height),t.restore()},Studio.Rect.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.strokeStyle="#fff",this.angle?this.drawAngled(t):t.fillRect(this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)},Studio.Clip=function(t){t&&this.apply(t)},
Studio.inherit(Studio.Clip,Studio.Rect),Studio.Clip.prototype.draw=function(t){t.save(),t.beginPath(),this.angle?this.drawAngled(t):t.rect(this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),t.clip()},Studio.Clip.prototype.drawAngled=function(t){this.prepAngled(t),t.rect(-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height)},Studio.CircleClip=function(t){t&&this.apply(t)},Studio.inherit(Studio.CircleClip,Studio.Rect),Studio.CircleClip.prototype.draw=function(t){t.save(),t.beginPath(),t.arc(this._dx,this._dy,this._world.width/2,0,2*Math.PI),t.clip()},Studio.Restore=function(){},Studio.Restore.prototype=new Studio.Rect,Studio.Restore.prototype.constructor=Studio.Restore,Studio.Restore.prototype.draw=function(t){t.restore()},Studio.Circle=function(t){this.color=new Studio.Color(1,0,0,0),t&&this.apply(t),this.height=this.width},Studio.inherit(Studio.Circle,Studio.Rect),Studio.Circle.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.beginPath(),t.arc(this._world.x,this._world.y,this._world.width/2,0,2*Math.PI),t.fill()},Studio.Sprite=function(t){this.image=null,this.slice="Full",this.color=Studio.WHITE,t&&this.apply(t)},Studio.inherit(Studio.Sprite,Studio.Rect),Studio.Sprite.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height),t.restore()},Studio.Sprite.prototype.verts=function(t,i,e,s){this.addVert(i,t.TL,e.x,e.y,s),this.addVert(i,t.TR,e.width,e.y,s),this.addVert(i,t.BL,e.x,e.height,s),this.addVert(i,t.BR,e.width,e.height,s),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&(this._boundingBox.TL.x+=this.border.width,this._boundingBox.TR.x+=this.border.width,this._boundingBox.BR.x+=this.border.width,this._boundingBox.BL.x+=this.border.width),this._dx+this._world.width>this.border.width&&(this._boundingBox.TL.x-=this.border.width,this._boundingBox.TR.x-=this.border.width,this._boundingBox.BR.x-=this.border.width,this._boundingBox.BL.x-=this.border.width),this.addVert(i,t.TL,e.x,e.y,s),this.addVert(i,t.TR,e.width,e.y,s),this.addVert(i,t.BL,e.x,e.height,s),this.addVert(i,t.BR,e.width,e.height,s))},Studio.Sprite.prototype.buildElement=function(t,i,e){t.buffers[this.image.path]||(t.buffers[this.image.path]=new Studio.BufferGL(this.image,0,t)),t.draws++,e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.verts(this._boundingBox,t.buffers[this.image.path],this.image.sliceGL[this.slice],t)},Studio.Sprite.prototype.draw=function t(i){this.image&&this.image.ready&&(this.setAlpha(i),this.angle?this.drawAngled(i):(i.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&i.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this.border.width+this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this._dx+this._world.width>this.border.width&&i.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this._dx-this._dwidth*this.anchorX-this.border.width,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight))))},Studio.SpriteAnimation=function(t){this.image=null,this.loop=[[0,0]],this.fps=12,this.frame=0,this.sliceX=0,this.sliceY=0,this.offsetY=0,this.offsetX=0,this.repeat=!0,this.startTime=0,t&&this.apply(t),this.setStartingFrame(this.frame)},Studio.inherit(Studio.SpriteAnimation,Studio.Sprite),Studio.SpriteAnimation.prototype.setStartingFrame=function(t){this.frame=t,this.startTime=Studio.time,this.myTime=this.startTime+t*(1e3/this.fps)},Studio.SpriteAnimation.prototype.draw=function(t){this.image&&this.image.ready&&(this.setAlpha(t),t.drawImage(this.image.bitmap,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorX,this._dwidth,this._dheight),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&t.drawImage(this.image.bitmap,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this.border.width+this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this._dx+this._world.width>this.border.width&&t.drawImage(this.image.bitmap,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this._dx-this._dwidth*this.anchorX-this.border.width,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)),this.loop.length&&this.updateFrame())},Studio.SpriteAnimation.prototype.setSlice=function(){this.sliceX=this.loop[this.frame][0]+this.offsetX,this.sliceY=this.loop[this.frame][1]+this.offsetY},Studio.SpriteAnimation.prototype.updateFrame=function(){this.myTime+=Studio.delta,this.frame=(this.myTime-this.startTime)*this._world.speed/(1e3/this.fps)|0,this.frame>=this.loop.length&&(this.startTime=this.myTime,this.frame=0,this.onLoopComplete&&this.onLoopComplete.call(this)),this.setSlice()},Studio.SpriteAnimation.prototype.verts=function(t,i,e,s){var h=this.rect.width/this.image.width,o=this.rect.height/this.image.height,n=this.sliceX*h,r=this.sliceY*o;this.addVert(i,t.TL,n,r,s),this.addVert(i,t.TR,n+h,r,s),this.addVert(i,t.BL,n,r+o,s),this.addVert(i,t.BR,n+h,r+o,s),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&(this._boundingBox.TL.x+=this.border.width,this._boundingBox.TR.x+=this.border.width,this._boundingBox.BR.x+=this.border.width,this._boundingBox.BL.x+=this.border.width),this._dx+this._world.width>this.border.width&&(this._boundingBox.TL.x-=this.border.width,this._boundingBox.TR.x-=this.border.width,this._boundingBox.BR.x-=this.border.width,this._boundingBox.BL.x-=this.border.width),this.addVert(i,t.TL,n,r,s),this.addVert(i,t.TR,n+h,r,s),this.addVert(i,t.BL,n,r+o,s),this.addVert(i,t.BR,n+h,r+o,s)),this.loop.length&&this.updateFrame()},Studio.Camera=function(t){this.stage={width:t.width,height:t.height},this.tracking=null,this.focus={x:0,y:0},this.bound=null,this.active=!0,this.matrix=new Float32Array([1,0,0,0,1,0,0,0,1])},Studio.inherit(Studio.Camera,Studio.DisplayObject),Studio.Camera.prototype.updateRect=function(){this.left=this.bound._dx*this.scaleX+this.focus.x,this.top=this.bound._dy*this.scaleY+this.focus.y,this.right=this.bound._dwidth*this.scaleX-this.focus.x,this.bottom=this.bound._dheight*this.scaleY-this.focus.y},Studio.Camera.prototype.update_visbile_area=function(){this.tracking?(this.visibleArea.x=this.x,this.visibleArea.y=this.y):(this.visibleArea.x=this.x+stage.width/2,this.visibleArea.y=this.y+stage.height/2),this.visibleArea.width=this.stage.width/this.scaleX-10,this.visibleArea.height=this.stage.height/this.scaleY-10},Studio.Camera.prototype.update=function(t,i,e){this.tracking&&(e||this.tracking._delta(i),this.x=this.tracking._dx,this.y=this.tracking._dy),this.bound&&(this.updateRect(),this.x<this.left?this.x=this.left:this.x>this.right&&(this.x=this.right),this.y<this.top?this.y=this.top:this.y>this.bottom&&(this.y=this.bottom)),this.visibleArea&&this.update_visbile_area()},Studio.Camera.prototype.render=function(t,i,e){this.update(t,i,e),this.matrix[0]=this.scaleX,this.matrix[4]=this.scaleY,this.matrix[6]=this.focus.x-this.x*this.scaleX,this.matrix[7]=this.focus.y-this.y*this.scaleY,e||t.ctx.setTransform(this.matrix[0]*t.resolution,0,0,this.matrix[4]*t.resolution,this.matrix[6]*t.resolution,this.matrix[7]*t.resolution),e&&t.ctx.uniformMatrix3fv(t.ctx.matrixLocation,!1,this.matrix)},Studio.Camera.prototype.track=function(t){this.tracking=t,this.focus.x=stage.width/2,this.focus.y=stage.height/2},Studio.Camera.prototype.bindTo=function(t){this.bound=t},Studio.Camera.prototype.unBind=function(){this.bindTo(null)},Studio.Camera.prototype.stopTracking=function(){this.track(null),this.focus.x=0,this.focus.y=0,this.matrix[6]=this.x*this.scaleX,this.matrix[7]=this.y*this.scaleY},Studio.Scene=function(t){this.color=new Studio.Color(0,1,0,.5),this.active=!1,this.image=null,this.loader=null,this.assets=[],this.children=[],this.buttons=[],this.tweens=Object.create(null),this.tween_length=0,this.trails=!0,this.anchorX=0,this.anchorY=0,t&&this.apply(t),this.build&&this.build.call(this,this),this.init&&this.init.call(this,this)},Studio.inherit(Studio.Scene,Studio.Rect),Studio.Scene.prototype.loadAssets=function(){for(var t=0;t!==arguments.length;t++)this.assets.push(new Studio.Image(arguments[t]))},Studio.Scene.prototype.addButton=function(t){this.buttons.unshift(t)},Studio.Scene.prototype.render_children=function(t,i){for(this.i=0;this.i<this._hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].render(t,i,t.interpolate)},Studio.Scene.prototype.close=function(t){this.active=!1},Studio.Scene.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Scene.prototype.draw=function(t){return this.setAlpha(t),this.image?void t.drawImage(this.image.image,this._dx,this._dy,this.width,this.height):this.color?0===this.color.a?void t.clearRect(this._dx,this._dy,this.width,this.height):(this.color.a<1&&!this.trails&&t.clearRect(this._dx,this._dy,this.width,this.height),this.setStyle(t),void t.fillRect(this._dx,this._dy,this.width,this.height)):void 0},Studio.Stage=function(t,i){return this.webgl=!!window.WebGLRenderingContext,this.fullscreen=0,this.color=new Studio.Color(0,0,0,1),this.snap=!1,i&&this.apply(i),this.tweens=Object.create(null),this._getCanvasElement(t),this._count=0,this._maxCount=16383,this.dur=1e3/60,this._d=this.dur/2,this.resolution=window.devicePixelRatio,this.interpolate=!0,this.smoothing=!0,i&&this.apply(i),this._sizeCanvas(this.fullscreen),this.setPixelRatio(),this.webgl&&Studio.browser_info.webGL?this.engine=Studio.Stage.prototype.WEBGL:this.webgl=!1,this.allowPlugins(),this.engine.getContext.call(this),this.engine.init.call(this,this.ctx),this.engine.prep.call(this,this.ctx),Studio.stages.push(this),this.render=this.engine.render,this._init(),console.log("%cStudio3 v"+Studio.version+"%c"+this.engine.type,Studio.infoStyle,Studio.engineStyle),this.verts=0,this},Studio.inherit(Studio.Stage,Studio.Scene),Studio.Stage.prototype._getCanvasElement=function(t){if(t){if("build"===t.toLowerCase())return this.bitmap=document.createElement("canvas"),void document.body.appendChild(this.bitmap);this.bitmap=document.getElementById(t)}else{var i=document.body.getElementsByTagName("canvas");i[0]?this.bitmap=i[0]:(this.bitmap=document.createElement("canvas"),document.body.appendChild(this.bitmap))}},Studio.Stage.prototype.setColor=function(t,i,e,s){this.color.set(t,i,e,s),this.ctx.clearColor&&this.ctx.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)},Studio.Stage.prototype._init=function(){return this.ready=!1,this.autoPause=!1,this._watching=!1,this.children=[],this.buttons=[],this.activeScene=null,this.previousScene=null,this.camera=new Studio.Camera(this),this.nextID=0,this.anchorX=0,this.anchorY=0,this.active=!0,this._pause_buttons=!1,Studio.stage=this,this},Studio.Scene.prototype.allowPlugins=function(){this.plugins=Object.create(null),this.plugins.input=[],this.plugins.effect=[],this._effects=0,this._inputs=0},Studio.Stage.prototype._sizeCanvas=function(t){if(this.height=this.bitmap.height||this.height,this.width=this.bitmap.width||this.width,this.bitmap.style.height=this.height+"px",this.bitmap.style.width=this.width+"px",this._scaleRatio=1,1==t&&(this.width=window.innerWidth,this.height=window.innerHeight,this.bitmap.style.height="100%",this.bitmap.style.width="100%"),t>=2){var i=window.innerWidth;this.maxwidth&&i>this.maxwidth&&(i=this.maxwidth),this.bitmap.style.width=i+"px",this.bitmap.style.height="auto",this._scaleRatio=i/this.width,3==t&&(this.bitmap.style.height=window.innerHeight+"px")}},Studio.Stage.prototype.pauseButtons=function(t){this._pause_buttons=t},Studio.Stage.prototype.setPixelRatio=function(){this.bitmap.width=this.width*this.resolution,this.bitmap.height=this.height*this.resolution},Studio.Stage.prototype.fillScreen=function(){},Studio.Stage.prototype.addInput=function(t,i){i&&t._options(i),t.init(this),this.plugins.input.push(t),this._inputs++},Studio.Stage.prototype.addEffect=function(t,i){i&&t._options(i),t.init(this),this.plugins.effect.push(t),this._effects++},Studio.Stage.prototype.checkDataAttributes=function(){},Studio.Stage.prototype.setScene=function(t){t._parent=this,this.activeScene&&2===Studio.progress&&this.activeScene.onDeactivate&&this.activeScene.onDeactivate(this),this.previousScene=this.activeScene,this.activeScene=t,this.activeScene.active=!0,t.onActivate&&t.onActivate(this)},Studio.Stage.prototype.clearScene=function(){this.activeScene&&(this.previousScene=this.activeScene,this.activeScene=null,this.previousScene.onDeactivate?this.previousScene.onDeactivate(this):this.previousScene.active=!1)},Studio.Stage.prototype.watch=function(t){this._watching=t},Studio.Stage.prototype.update_visibility=function(){this._alpha=this.alpha},Studio.Stage.prototype._timebased_updates=function(t){this.activeScene&&this.activeScene.update_tweens(t),this.update_tweens(t)},Studio.Stage.prototype.update=function(t,i){this.onEnterFrame&&this.onEnterFrame(),this._width=this.width,this._height=this.height,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._speed=this.camera.speed,this.update_visibility(),2===Studio.progress&&(this._inputs&&this.runInputs(i),this.updateScenes(),this.beforeDraw&&this.beforeDraw()),this._logic()},Studio.Stage.prototype._update_scene=function(t){t&&t.active&&t.update(this.interpolate)},Studio.Stage.prototype.updateScenes=function(){this._update_scene(this.activeScene),this._update_scene(this.previousScene),this._hasChildren&&this.update_children(this.interpolate)},Studio.Stage.prototype.runEffects=function(){for(this.i=0;this.i!==this._effects;this.i++)this.plugins.effect[this.i].active&&this.plugins.effect[this.i].action(this)},Studio.Stage.prototype.runInputs=function(){for(this.i=0;this.i!==this._inputs;this.i++)this.plugins.input[this.i].active&&this.plugins.input[this.i].action(this)},Studio.Stage.prototype.loading=function(t){!0===Studio.loaded&&(this.loop=this.activeloop)},Studio.Stage.prototype.activeloop=function(t){if(2===Studio.progress)return void this.timeStep(t);if(this.webgl||this.drawProgress(this.ctx,t),1===Studio.progress){if(this.onReady&&this.onReady(t),Studio.progress=2,!this.activeScene)return;this.activeScene.onActivate&&this.activeScene.onActivate(this)}},Studio.Stage.prototype.loop=Studio.Stage.prototype.loading,Studio.Scene.prototype.drawProgress=function(t){this.progressBar(t,Studio.progress),t.restore()},Studio.Scene.prototype.progressBar=function(t,i){t.fillStyle="rgba(255,255,255,.8)",t.fillRect((this.width-202)/2,(this.height-22)/2,202,22),t.fillStyle="rgba(0,0,0,1)",t.fillRect(2+(this.width-202)/2,2+(this.height-22)/2,198*i,18)},Studio.Font=function(t,i,e,s,h){this.size=i||16,this.family=t||"Arial",this.weight=e||"",this.style=s||"",this.varient=h||"",this.lineHeight=20,this.color="#fff",this.shadow=0},Studio.Font.prototype={constructor:Studio.Font,build:function(){return this.varient+" "+this.style+" "+this.weight+" "+this.size+"px "+this.family},set:Studio.apply,modify:function(t){return t?(t.varient||this.varient)+" "+(t.style||this.style)+" "+(t.weight||this.weight)+" "+(t.size||this.size)+"px "+(t.family||this.family):this.build()}},Studio.TextBox=function(t,i,e,s){return this.height=i,this.width=t,this.font=new Studio.Font,this._lastfont=this.font.build(),this.shadow=1,this.offsetY=0,this._offsetY=this.offsetY,this.shadowColor="rgba(0,0,0,0.5)",this.image=s||new Studio.Cache(t,i,e.resolution),this.image.ctx.textBaseline="top",this.text="",this._wrap_height=this.lineHeight,this.horizontal_align=Studio.LEFT,this.justify=!1,this.vertical_align=Studio.TOP,this._vertical_align=0,this.columns=1,this.gutter=20,this.live=!1,this.styles={b:{color:"#FFD000",weight:"bold"},i:{style:"italic",color:"green"},h1:{height:"bold",size:32,lineHeight:40},h2:{height:"bold",size:24,lineHeight:30}},this},Studio.inherit(Studio.TextBox,Studio.Sprite),Studio.TextBox.prototype.setFont=function(t){return this.font=t,this},Studio.TextBox.prototype.setText=function(t){return this.text=t,this},Studio.TextBox.prototype.setColor=function(t){return this},Studio.TextBox.prototype.setFont=function(t){return this.image.ctx.font=this.font=t,this},Studio.TextBox.prototype.finish=function(){this.reset(),this.wrapText(),this.image.ready=!0,this.image.dirty=!0},Studio.TextBox.prototype.reset=function(){var t=this.image.slice[this.slice];this.image.ctx.clearRect(t.x,t.y,t.width,t.height),this.image.ctx.font=this.font},Studio.TextBox.prototype.writeLine=function(t,i,e,s){var h=t.split(" "),o=0,s=s||0;this.image.ctx.font=this._lastfont;for(var n=0;n!=h.length;n++){var r=h[n];if("<"===r[0]&&">"===r[r.length-1])if("</>"==r)this._lastfont=this.font.build(),this.image.ctx.font=this._lastfont,this.image.ctx.fillStyle=this.font.color,this._offsetY=this.offsetY;else{var a=this.styles[r.slice(1,r.length-1)];a&&(this._lastfont=this.font.modify(a),this.image.ctx.font=this._lastfont,this.image.ctx.fillStyle=a.color,a.offsetY&&(this._offsetY=a.offsetY))}else{if(this.shadow){var d=this.image.ctx.fillStyle;this.image.ctx.fillStyle=this.shadowColor;for(var u=1;u<=this.shadow;u+=.5)this.image.ctx.globalAlpha=this.shadow/u,this.image.ctx.fillText(r,o+i+1+u+s*n,e+u+this._offsetY);this.image.ctx.fillStyle=d}this.image.ctx.fillText(r,o+i+s*n,e+this._offsetY),o+=this.image.ctx.measureText(r+" ").width}}},Studio.TextBox.prototype.wrapText=function(){this.image.ctx.fillStyle=this.font.color,this._lastfont=this.font.build(),this.image.ctx.font=this._lastfont;for(var t=this.image.slice[this.slice],i=(this.width-this.gutter*(this.columns-1))/this.columns,e=t.x+1,s=this.text.split("\n"),h=t.y,o=0;o!==s.length;o++){for(var n=s[o].split(" "),r="",a="",d=0,u=0,c=this.font.lineHeight,l=t.x,p=0;p<n.length;p++){var _=n[p];if("<"===_[0]&&">"===_[_.length-1]){if("</>"==_)this.image.ctx.font=this.font.build();else{var g=this.styles[_.slice(1,_.length-1)];g&&(this.image.ctx.font=this.font.modify(g),g.lineHeight&&(c=g.lineHeight))}u=0}else u=this.image.ctx.measureText(_+" ").width;if((d+=u)>i&&p>0){if(d-=u,h+c>=t.height/this.image.resolution&&(h=t.y,(e+=i+this.gutter)>=t.width))return;1==this.justify?this.writeLine(a,e,h,(i-d)/l):this.writeLine(a,e+(i-d)*this.horizontal_align|0,h,0),l=t.x,a=_+" ",h+=c,d=u}else a=a+_+" ",l++}h+c>=t.height/this.image.resolution&&(h=t.y,e+=i+this.gutter,console.log("move me over outside")),this.writeLine(a,e+(i-d)*this.horizontal_align|0,h,.25),this._wrap_height=h+c,o!==s.length-1&&(h+=c)}this._wrap_height>this.height&&(this._wrap_height=this.height),this._vertical_align=this._wrap_height*this.vertical_align-this.height*this.vertical_align|0},Studio.TextBox.prototype.fit=function(){this.image.height=this._wrap_height,this.wrapText()},Studio.TextBox.prototype.update_xy=function(){this.orbits&&this._parent.angle?this.update_orbit_xy():(this._world.x=this.x*this._parent.scaleX+this._parent.x,this._world.y=this.y*this._parent.scaleY+this._parent.y-this._vertical_align),this.live&&this.finish()},Studio.Scene.prototype.update_tweens=function(t){var i,e=0,s,h,o;for(i in this.tweens)if(s=this.tweens[i],s.actor._world?s.cur+=t*s.actor._world.speed:s.cur+=t,!s.active&&s.onStart&&(s.onStart.call(s.actor),s.active=1),(o=s.dir?1-s.cur/s.duration:s.cur/s.duration)<1&&o>0)for(e=0;e!==s.keys.length;e++)h=s.keys[e],this.update_property(s,h,o);else if(s.next)s.next._snapshot(),s.next.cur=s.cur-s.duration,this.tweens[i]=s.next;else{if(s._loop)return s.cur=0,s.onEnd&&s.onEnd.call(s.actor),void(s._reflect?s.dir?s.dir=0:s.dir=1:(s.actor.apply(s.original),s.active=0));if(s.reset)s.actor.apply(s.original);else for(e=0;e!==s.keys.length;e++)h=s.keys[e],s.actor[h]=s.to[h];s.onEnd&&s.onEnd.call(s.actor),s=null,this.tweens[i]=null,delete this.tweens[i]}},Studio.Scene.prototype.update_property=function(t,i,e){t.actor[i]=t.original[i]+Studio.Ease[t.ease](e)*(t.to[i]-t.original[i])},Studio._tween_object=function(t,i,e,s,h,o){this.actor=t,this.ease=i,this.original={},this.to=e,this.cur=0,this.duration=s,this.onStart=o,this.onEnd=h,this._loop=!1,this._reflect=!0,this.reset=!1,this.dir=0,this.active=0,this.id=null,this.keys=Object.keys(e),this.next=null,this.prev=null},Studio._tween_object.prototype.constructor=Studio._tween_object,Studio._tween_object.prototype.loop=function(){return this._loop=!0,this},Studio._tween_object.prototype.apply=function(t){for(var i in t)this[i]=t[i];return this},Studio._tween_object.prototype.reflect=function(t){return this._reflect=t,this},Studio._tween_object.prototype.setActor=function(t){return this.actor=t,this},Studio.Scene.prototype.createTween=function(t,i,e,s,h,o){var n=new Studio._tween_object(t,i,e,s,h,o);n.id=this.nextID;for(var r in e)n.original[r]=t[r];return this.nextID++,n},Studio._tween_object.prototype._snapshot=function(){for(var t in this.to)this.original[t]=this.actor[t]},Studio._tween_object.prototype.then=function(t,i,e,s,h){return this.next=new Studio._tween_object(this.actor,t,i,e,s,h),this.next.prev=this,this.next},Studio._tween_object.prototype.last=function(){for(var t=this.next,i=this;null!==t;)i=t,t=t.next;return i},Studio._tween_object.prototype.completeLoop=function(t){return this.next=t,t.prev=this,this.next},Studio.Scene.prototype.createLoop=function(t,i,e,s,h){return this.tweens[this.nextID]=this.createTween(t,i,e,s,h),this.tweens[this.nextID-1].loop=!0,this.tweens[this.nextID-1]},Studio.Scene.prototype.addTween=function(t,i,e,s,h){return this.tweens[this.nextID]=this.createTween(t,i,e,s,h),this.tweens[this.nextID-1]},Studio.Scene.prototype.playTween=function(t){t.cur=0;for(var i=0;i!==t.keys.length;i++)t.original[t.keys[i]]=t.actor[t.keys[i]];this.tweens[t.id]=t},Studio.Scene.prototype.stopTween=function(t,i,e){if(this.tweens[t.id]){if(t.cur=0,t.dir=0,i){var s;if(e)for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.original[t.keys[s]];else for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.to[t.keys[s]]}this.tweens[t.id]=null,delete this.tweens[t.id]}},Studio.Pattern=function(t){return this.height=512,this.width=512,this.overflowX=0,this.overflowY=0,this.resolution=1,this.image=null,this.offsetX=0,this.offsetY=0,this.stretchY=!1,t&&this.apply(t),this.base_image=this.image,this.base_image.addListenerTo("ready","onImageReady",this),this.width=this.width+this.overflowX,this.height=this.height+this.overflowY,this.image=new Studio.Cache(this.width,this.height,this.resolution),this._imaged=!1,this},Studio.inherit(Studio.Pattern,Studio.Sprite),Studio.Pattern.prototype.setPattern=function(){var t=this.base_image.slice[this.slice],i=t.width*this.scaleX||0,e=t.height*this.scaleY||0,s=0,h=0;if(this.stretchX||this.stretchY)if(this.stretchY)for(s=0;s<this.width;s+=i)this.offsetX+i>i&&(this.offsetX-=i),this.image.ctx.drawImage(this.base_image.bitmap,t.x,t.y,t.width,t.height,s+this.offsetX,h+this.offsetY,i,this.height);else for(h=0;h<this.height;h+=e)this.offsetY+e>e&&(this.offsetY-=e),this.image.ctx.drawImage(this.base_image.bitmap,t.x,t.y,t.width,t.height,s+this.offsetX,h+this.offsetY,this.width,e);else for(s=0;s<this.width;s+=i)for(h=0;h<this.height;h+=e)this.offsetX+i>i&&(this.offsetX-=i),this.offsetY+e>e&&(this.offsetY-=e),this.image.ctx.drawImage(this.base_image.bitmap,t.x,t.y,t.width,t.height,s+this.offsetX,h+this.offsetY,i,e);return this},Studio.Pattern.prototype.checkOverflow=function(){this.x>0&&(this.x-=this.overflowX),this.y>0&&(this.y-=this.overflowY),this.x<-this.overflowX&&(this.x+=this.overflowX),this.y<-this.overflowY&&(this.y+=this.overflowY)},Studio.Pattern.prototype.onImageReady=function(t){t&&this.setPattern()},Studio.Pattern.prototype.debugDraw=function(t){t.strokeRect(this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY-this._vertical_align,this._world.width,this._wrap_height)},Studio.Pattern.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.bitmap,0,0,this.image.bitmap.width,this.image.bitmap.height,-this._dwidth*this.anchorX,-this._dheight*this.anchorY,this._dwidth,this._dheight),t.restore()},Studio.Pattern.prototype.draw=function(t){this.setAlpha(t),this.angle?this.drawAngled(t):t.drawImage(this.image.bitmap,0,0,this.image.bitmap.width,this.image.bitmap.height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)},Studio.Pattern.prototype.buildElement=function(t,i,e){t.buffers[this.image.path]||(t.buffers[this.image.path]=new Studio.BufferGL(this.image,0,t)),t.draws++,e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.verts(this._boundingBox,t.buffers[this.image.path],this.base_image.sliceGL.Full,t)},Studio.load=function(t,i,e,s){var h=new XMLHttpRequest;h.onload=function o(){var n=null;h.status>=200&&h.status<400||0==h.status?(console.log("%cStudio loaded file : "+t,Studio.statStyle),"json"==i.toLowerCase()&&(n=JSON.parse(h.responseText)),e&&(s?e.call(s,n):e(n))):this.onerror()},h.onerror=function(){console.log("%cStudio failed to load file : "+t,Studio.errorStyle)},h.open("GET",t,!0),h.send()},Studio.TileMap=function(t,i,e,s){this.cache=new Studio.Cache(t,i,e),this.buffer=new Studio.Cache(t,i,e),this.offsetX=0,this.offsetY=0,this.maxWidth=0,this.resolution=e||1,this.repeat=this.data=null,s&&this.apply(s)},Studio.TileMap.prototype={apply:Studio.apply,constructor:Studio.TileMap,build:function(t,i,e,s,h,o){var n=t,r=this.cache.ctx,a=i.tileWidth,d=i.tileHeight;this.maxWidth=Math.floor(this.cache.width/a)/this.resolution;var e=e||0,s=s||0,u=h||this.maxWidth,c=o||n.height-s;if(n.data)for(var l=0;l!=c;l++)for(var p=0;p!=u;p++){var _=0,g=0,f=n.data[parseInt((l+s)*n.width)+(p+e)]-i.firstgid,a=i.tileWidth,d=i.tileHeight;f>2147483648&&(f-=2147483648,_=-1),f>1073741824&&(f-=1073741824,g=-1),f>536870912&&(f-=536870912);var S=parseInt(f/i.across),w=f-S*i.across;r.drawImage(i.set.bitmap,w*i.tileWidth+i.tileWidth*_,S*i.tileHeight+i.tileHeight*g,a,d,p*i.tileWidth,l*i.tileHeight,i.tileWidth,i.tileHeight)}this.buffer.ctx.clearRect(0,0,this.cache.width,this.cache.height),this.buffer.ctx.drawImage(this.cache.bitmap,0,0),this.cache.ready=!0},offsetMap:function(t,i){this.offsetX+=t,this.offsetX<0&&(this.offsetX=0),this.offsetX+this.maxWidth>this.data.width&&(this.offsetX=this.data.width-this.maxWidth),this.cache.ctx.clearRect(0,0,this.cache.width,this.cache.height);for(var e in this.data.layers)this.build(this.data.layers[e],this.tileset,this.offsetX,this.offsetY,this.maxWidth)},_onLoad:function t(i){if(console.log(i),!i)return void console.log("The image isn't ready so we need to wait.");1==i&&(console.log("The Image is ready, we can now create the tileset from the information provided, and then build the map from the data layer."),this.offsetMap(0,0))},onMapLoad:function(t){this.data=t,this.set=t.tilesets[0];var i=new Studio.Image("assets/"+this.set.image);this.tileset=new Studio.TileSet(i,this.set.tilewidth,this.set.tileheight,this.set.imagewidth),i.addListenerTo("ready","_onLoad",this)},load:function(t,i){Studio.load(t,i,this.onMapLoad,this)}},Studio.TileSet=function(t,i,e,s){this.firstgid=1,this.tileWidth=i||32,this.tileHeight=e||32,this.across=s/i|0,this.set=t||null},Studio.TileSet.prototype={constructor:Studio.TileSet,onLoadComplete:function(t){t.across=t.set.width/t.tileWidth}},Studio.Effect={},Studio.Effect.BillAtkinsonDither_BW=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1,this.active=!0},action:function(t){for(var i=t.ctx.getImageData(0,0,t.bitmap.width,t.bitmap.height),e=i.data,s=parseInt(4*t.bitmap.width),h=e.length,o=0;o<h;o+=4)this.oldpixel=e[o],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[o]=e[o+1]=e[o+2]=this.newpixel,e[o+3]>20?e[o+3]=255:e[o+3]=0,this.qerror=.15*(this.oldpixel-this.newpixel),o%s==0&&o+4%s===0&&o+8%s===0||(e[o+5]=e[o+6]=e[o+4]+=this.qerror,e[o+9]=e[o+10]=e[o+8]+=this.qerror,e[o+5+s]=e[o+6+s]=e[o+4+s]+=this.qerror,e[o+1+s]=e[o+2+s]=e[o+s]+=this.qerror,e[o+s-3]=e[o+s-2]=e[o+s-4]+=this.qerror,e[o+2*s]=e[o+2*s]=e[o+2*s]+=this.qerror);t.ctx.putImageData(i,0,0)}}),Studio.Effect.Posterize=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1,this.active=!0},action:function(t){for(var i=t.ctx.getImageData(0,0,t.bitmap.width,t.bitmap.height),e=i.data,s=4*t.bitmap.width,h=e.length,o=0;o<h;o++)this.oldpixel=e[o],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[o]=this.newpixel;t.ctx.putImageData(i,0,0)}}),Studio.Effect.Replicator=new Studio.Plugin({options:{x:3,y:3},init:function(t){this.cache=new Studio.Cache},action:function(t){var i=t.canvas.width/this.options.x,e=t.canvas.height/this.options.y;this.cache.image.width=i,this.cache.image.height=e,this.cache.buffer.drawImage(t.canvas,0,0,i,e);for(var s=0;s!=this.options.x;s++)for(var h=0;h!=this.options.y;h++)t.ctx.drawImage(this.cache.image,s*i,h*e,i,e)}}),Studio.Effect.Blur=new Studio.Plugin({options:{x:3,y:3},init:function(t){this.cache=new Studio.Cache,this.active=!0},action:function(t){var i=t.bitmap.width/2,e=t.bitmap.height/2;console.log(this.cache),this.cache.bitmap.width=i,this.cache.bitmap.height=e,this.cache.ctx.drawImage(t.bitmap,0,0,i,e),t.ctx.drawImage(this.cache.bitmap,0,0,t.width,t.height)}}),Studio.Effect.Cursor=new Studio.Plugin({options:{},init:function(t){this.cursor=new Studio.Image("assets/cursor.png"),t.bitmap.style.cursor="none"},action:function(t){t.ctx.drawImage(this.cursor.image,t.mouse.x-8,t.mouse.y-8,48,48)}}),Studio.Effect.Red=new Studio.Plugin({options:{},init:function(t){this.active=!0},action:function(t){for(var i=t.ctx.getImageData(0,0,t.bitmap.width,t.bitmap.height),e=i.data.buffer,s=new Uint8Array(e),h=new Uint32Array(e),o=h.length,n=0;n!=o;n++){var r=i.data[4*n+1];h[n]=255<<24|255-r<<16|r<<8|255-r}i.data.set(s),t.ctx.putImageData(i,0,0)}}),Studio.timeStep={fixed:function(t){this.fixedStep(t),this.step(t),this._timebased_updates(t),this.render(this._lag),this.onExitFrame&&this.onExitFrame()},simple:function(t){this.update(this.interpolate),this._timebased_updates(t),this.render(1),this.onExitFrame&&this.onExitFrame()},static_fixed:function(t){this.step(t),this._d>=this.dur&&(this._d-=this.dur,this.update(!1),this._timebased_updates(t),this.render(1)),this._d<1&&(this._d=1.5)}},Studio.Stage.prototype.timeStep=Studio.timeStep.fixed,Studio.Stage.prototype.fixedStep=function(){for(;this._d>=this.dur;)this._d-=this.dur,this.update(this.interpolate);this._d<1&&(this._d=1.5)};Studio.Stage.prototype.step=function(t){this._d+=t,this._lag=this._d/this.dur,this._lag>1&&(this._lag=1),this._lag<0&&(this._lag=0)};var FRAGMENTSHADER=["precision lowp float;","uniform sampler2D u_image;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","\tgl_FragColor = texture2D(u_image, v_texture) * v_color;","}"].join("\n"),VERTEXSHADER=["attribute vec3 a_position;","attribute vec4 a_color;","attribute vec2 a_texture;","uniform vec2 u_resolution;","uniform mat3 u_matrix;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","   vec2 canvas_coords = (u_matrix * vec3(a_position.xy,1)).xy;","   vec2 clipSpace = ((canvas_coords / u_resolution)*2.0) - 1.0;","\tgl_Position = vec4(clipSpace * vec2(1, -1), a_position.z, 1);","\tv_color = a_color;","\tv_texture = a_texture;","}"].join("\n");Studio.Stage.prototype.loadShader=function(t,i){
this.ctx.shaderSource(t,i)},Studio.Stage.prototype.WEBGL={type:"webgl",antialias:!1,premultipliedAlpha:!1,stencil:!0,getContext:function(){Studio.browser_info.iOS?this.WEBGL.antialias=!0:this.WEBGL.antialias=!1,this.ctx=this.bitmap.getContext(Studio.browser_info.webGL,{antialias:this.WEBGL.antialias,premultipliedAlpha:this.WEBGL.premultipliedAlpha,stencil:this.WEBGL.stencil})},newBatch:function(t,i){},init:function(t){this._max_textures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._count=0,this.rect_buffer=new Studio.BufferGL(null,0,this),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.vertexShader=t.createShader(t.VERTEX_SHADER),this.loadShader(this.vertexShader,VERTEXSHADER),this.fragmentShader=t.createShader(t.FRAGMENT_SHADER),this.loadShader(this.fragmentShader,FRAGMENTSHADER),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.compileShader(this.vertexShader),t.compileShader(this.fragmentShader),t.linkProgram(this.program),t.useProgram(this.program)},prep:function(t){this.buffers={},t.resolutionLocation=t.getUniformLocation(this.program,"u_resolution"),t.matrixLocation=t.getUniformLocation(this.program,"u_matrix"),t.enableVertexAttribArray(0),t.positionLocation=t.getAttribLocation(this.program,"a_position"),t.bindAttribLocation(this.program,0,"a_position"),t.colorLocation=t.getAttribLocation(this.program,"a_color"),t.textureLocation=t.getAttribLocation(this.program,"a_texture"),t.uniform2f(t.resolutionLocation,this.width,this.height),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(t.positionLocation),t.enableVertexAttribArray(t.colorLocation),t.enableVertexAttribArray(t.textureLocation),t.vertexAttribPointer(t.positionLocation,3,t.FLOAT,!1,36,0),t.vertexAttribPointer(t.colorLocation,4,t.FLOAT,!1,36,12),t.vertexAttribPointer(t.textureLocation,2,t.FLOAT,!1,36,28),this._rect_index_buffer=t.createBuffer(),this._rect_index=new Uint16Array(7*this._maxCount);for(var i=0,e=0;i<7*this._maxCount;i+=6,e+=4)this._rect_index[i+0]=e+0,this._rect_index[i+1]=e+1,this._rect_index[i+2]=e+2,this._rect_index[i+3]=e+1,this._rect_index[i+4]=e+2,this._rect_index[i+5]=e+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._rect_index,t.STATIC_DRAW)},render:function(t){this._count=0,this.draws=0,this.ctx.clearColor(this.color.r,this.color.g,this.color.b,this.color.a),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT),this.previousScene&&(this.previousScene.buildElement(this,t,this.interpolate),this.previousScene.vertex_children(this,t,this.interpolate)),this.activeScene&&(this.activeScene.buildElement(this,t,this.interpolate),this.activeScene.vertex_children(this,t,this.interpolate)),this.vertex_children(this,t,this.interpolate),this.rect_buffer.draw(this.ctx),this.camera.render(this,t,1);for(var i in this.buffers)this.buffers[i].draw(this.ctx);this._effects&&this.runEffects()}},Studio.Stage.prototype.CANVAS={type:"2dContext",getContext:function(){this.ctx=this.bitmap.getContext("2d")},init:function(){this.ctx.webkitImageSmoothingEnabled=this.smoothing,this.ctx.mozImageSmoothingEnabled=this.smoothing,this.ctx.imageSmoothingEnabled=this.smoothing},prep:function(){},render:function(t){if(this.ctx.setTransform(this.resolution,0,0,this.resolution,0,0),this.draw(this.ctx),this.camera.render(this,t),this.previousScene&&this._renderScene(this.previousScene,t),this.activeScene&&this._renderScene(this.activeScene,t),this._hasChildren)return this.render_children(this,t),void(this._effects&&this.runEffects());this._watching&&(this._watching.render_children(this,t),this._effects&&this.runEffects())}},Studio.Stage.prototype._renderScene=function(t,i){t.active&&t.render(this,i,this.interpolate)},Studio.Stage.prototype.engine=Studio.Stage.prototype.CANVAS,Studio.Stage.prototype.enableKeyboardInput=function(){if(this.keys)return void console.warn("Keyboard events are already enabled.");var t=this;this.keys={},this.keys.onScreen={};var i=function(i){i.preventDefault(),t.keys[i.keyCode]=1,t.keys.onScreen[i.keyCode]&&t.keys.onScreen[i.keyCode].keydown()},e=function(i){i.preventDefault(),t.keys[i.keyCode]=0,t.keys.onScreen[i.keyCode]&&t.keys.onScreen[i.keyCode].keyup()};document.addEventListener("keydown",i,!1),document.addEventListener("keyup",e,!1)},Studio.Stage.prototype.enableTouchEvents=function(){var t=this,i={x:0,y:0,dx:0,dy:0,id:0};this.mouse_onDown=function(t,i){if(i.buttons&&!i._pause_buttons)for(var e=0;e!=i.buttons.length;e++)if(i.buttons[e]._touchID);else if(i.buttons[e].hitTestPoint(t.x,t.y)){if(i.buttons[e]._touchID=t.id,i.buttons[e].onTap&&i.buttons[e].onTap(t),i.buttons[e].preventBubble)return}else i.buttons[e].onTapOutside&&i.buttons[e].onTapOutside(t)},this.mouse_onMove=function(t,i){if(i.buttons&&!i._pause_buttons)for(var e=0;e!=i.buttons.length;e++)i.buttons[e].hitTestPoint(t.x,t.y)?(i.buttons[e].draggable&&t.id&&i.buttons[e]._touchID==t.id&&(i.buttons[e]._activeDrag?i.buttons[e].onDrag&&i.buttons[e].onDrag(t):(i.buttons[e].onDragStart&&i.buttons[e].onDragStart(t),i.buttons[e]._activeDrag=!0)),i.buttons[e].onHoverStart&&!i.buttons[e].hovering?i.buttons[e].onHoverStart(t):i.buttons[e].onHover&&i.buttons[e].onHover(t),i.buttons[e].hovering=!0):i.buttons[e].hovering&&(i.buttons[e].hovering=!1,i.buttons[e].onHoverEnd&&i.buttons[e].onHoverEnd()),i.buttons[e].draggable&&i.buttons[e]._activeDrag&&i.buttons[e]._touchID==t.id&&(i.relativeX=t.dx,i.relativeY=t.dy,i.buttons[e].angle&&(i.buttons[e].orbits||i.buttons[e].inheritRotation)&&(i.relativeX=t.dx*Math.cos(-i.buttons[e].angle)-t.dy*Math.sin(-i.buttons[e].angle),i.relativeY=t.dx*Math.sin(-i.buttons[e].angle)+t.dy*Math.cos(-i.buttons[e].angle),t.dx=i.relativeX,t.dy=i.relativeY),i.buttons[e].onDrag&&i.buttons[e].onDrag(t)),i.buttons[e].onTouchMove&&i.buttons[e].onTouchMove(t)},this.mouse_onUp=function(t,i){if(i.buttons)for(var e=0;e!=i.buttons.length;e++)i.buttons[e]._touchID==t.id&&(i.buttons[e]._activeDrag&&i.buttons[e].onDragEnd&&i.buttons[e].onDragEnd(t),i.buttons[e].hitTestPoint(t.x,t.y)?i.buttons[e].onRelease&&i.buttons[e].onRelease(t):i.buttons[e].onReleaseOutside&&i.buttons[e].onReleaseOutside(t),i.buttons[e]._activeDrag=!1,i.buttons[e]._touchID=0)};var e={clientX:0,clientY:0},s=function(i){e.clientX=(i.clientX-t.bitmap.getBoundingClientRect().left)/t._scaleRatio,e.clientY=(i.clientY-t.bitmap.getBoundingClientRect().top)/t._scaleRatio},h=function(h){s(h),i.id=1,i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,i.dx=i.dy=0,t.mouse_onDown(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onDown(i,t.activeScene)},o=function(h){s(h),i.dx=i.x-(e.clientX+t.camera.x),i.dy=i.y-(e.clientY+t.camera.y),i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,t.mouse_onMove(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onMove(i,t.activeScene)},n=function(e){t.mouse_onUp(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onUp(i,t.activeScene),i.id=0};this._mouseWindow?(document.addEventListener("mousedown",h,!1),document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",n,!1),document.addEventListener("mouseout",n,!1)):(this.bitmap.addEventListener("mousedown",h,!1),this.bitmap.addEventListener("mousemove",o,!1),this.bitmap.addEventListener("mouseup",n,!1),this.bitmap.addEventListener("mouseout",n,!1));var r={},a=0,d=[],u={},c=0,l=function(i){i.preventDefault(),c=i.targetTouches.length;for(var h=0;h!=c;h++)a=i.targetTouches[h].identifier,s(i.targetTouches[h]),r[a]={},r[a].id=a,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,r[a].dx=0,r[a].dy=0,t.mouse_onDown(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onDown(r[a],t.activeScene)},p=function(i){i.preventDefault(),c=i.targetTouches.length;for(var h=0;h!=c;h++)a=i.targetTouches[h].identifier,s(i.targetTouches[h]),r[a].dx=r[a].x-e.clientX,r[a].dy=r[a].y-e.clientY,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,t.mouse_onMove(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onMove(r[a],t.activeScene)},_=function(i){i.preventDefault(),c=i.changedTouches.length;for(var e=0;e!=c;e++)a=i.changedTouches[e].identifier,t.mouse_onUp(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onUp(r[a],t.activeScene),delete r[a]};window.ejecta?(document.addEventListener("touchstart",l,!1),document.addEventListener("touchmove",p,!1),document.addEventListener("touchend",_,!1),document.addEventListener("touchcancel",_,!1)):(this.bitmap.addEventListener("touchstart",l,!1),this.bitmap.addEventListener("touchmove",p,!1),this.bitmap.addEventListener("touchend",_,!1),this.bitmap.addEventListener("touchcancel",_,!1),this.bitmap.addEventListener("pointerdown",h,!1),this.bitmap.addEventListener("pointermove",o,!1),this.bitmap.addEventListener("pointerup",n,!1),this.bitmap.setAttribute("tabindex","0"),this.bitmap.focus())},Studio.getAudioContext=function(){return"undefined"!=typeof AudioContext?new AudioContext:"undefined"!=typeof webkitAudioContext&&new webkitAudioContext},Studio.Sounds={source:null,context:Studio.getAudioContext(),soundGraph:function t(i){i._time!=Studio.now&&(i._time=Studio.now,this.source=this.context.createBufferSource(),this.source.loop=i.loop,this.source.buffer=i.data,this.source.connect(i._volume),i._volume.connect(this._volume),this._volume.connect(this.context.destination),this.source.start(0))},init:function(){this.context?(this._volume=this.context.createGain(),this.volume=this._volume.gain,this.setVolume=function(t){this.volume.value=t},this._filter=this.context.createBiquadFilter()):this.setVolume=function(t){t>1&&(t=1),t<0&&(t=0);for(var i in this.assets)this.assets[i].volume=t};var t=document.createElement("div");t.innerHTML="Enable Sound",t.ontouchend=function(){song.play()}}},Studio.Sounds.init(),Studio.Sound=function(t){this.snd={_time:0,data:null,loop:!1,volume:1},this.ready=!1,t&&this.load(t)},Studio.inherit(Studio.Sound,Studio.Messenger),Studio.Sound.prototype.load=function(t){var i=this;if(Studio.assets[t])i.snd.data=Studio.assets[t];else if(Studio.Sounds.context){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){Studio.assets[t]=e.response,i.snd._data=Studio.assets[t],i.snd._volume=Studio.Sounds.context.createGain(),i.snd.volume=i.snd._volume.gain,i.snd.volume.value=1,Studio.Sounds.context.decodeAudioData(i.snd._data,function(t){i.snd.data=t,Studio._loadedAsset(),i.ready=!0,i.sendMessage("ready",i.ready)})},Studio._addingAsset(),e.send()}else{var s=document.createElement("audio");s.src=t,s.load(),Studio.assets[t]=s,i.snd.data=Studio.assets[t]}},Studio.Sound.prototype.play=function(){this.snd.data?Studio.Sounds.context?Studio.Sounds.soundGraph(this.snd):(this.snd.data.play(),this.snd.data.loop=this.snd.loop):console.log("Sound file not ready.")},Studio.Sound.prototype.volume=function(t){},Studio.Sound.prototype.loop=function(t){this.snd.loop=t};var GAMEPAD=new Studio.Plugin({options:{},init:function t(i){this.gamepad=null;for(var e=0;e<=3;e++)i["GAMEPAD_"+e]={active:!1,AXES1:{X:0,Y:0},AXES2:{X:0,Y:0}};navigator.getGamepads&&(this.gamepads=navigator.getGamepads(),this.active=!0)},action:function(t){this.gamepads=navigator.getGamepads();for(var i=null,e=0;e!=this.gamepads.length;e++)this.gamepads[e]?(t["GAMEPAD_"+e].active||(t["GAMEPAD_"+e].active=!0,t["GAMEPAD_"+e].id=this.gamepads[e].id,t.gamepadconnected&&t.gamepadconnected(e,this.gamepads[e])),this.gamepad=this.gamepads[e],i=t["GAMEPAD_"+(e+1)],i.A=this.gamepad.buttons[0].value,i.B=this.gamepad.buttons[1].value,i.X=this.gamepad.buttons[2].value,i.Y=this.gamepad.buttons[3].value,i.L1=this.gamepad.buttons[4].value,i.R1=this.gamepad.buttons[5].value,i.L2=this.gamepad.buttons[6].value,i.R2=this.gamepad.buttons[7].value,i.UP=this.gamepad.buttons[12].value,i.DOWN=this.gamepad.buttons[13].value,i.LEFT=this.gamepad.buttons[14].value,i.RIGHT=this.gamepad.buttons[15].value,i.MENU=this.gamepad.buttons[9].value,this.gamepad.axes&&(i.AXES1.X=this.gamepad.axes[0],i.AXES1.Y=this.gamepad.axes[1],i.AXES2.X=this.gamepad.axes[2],i.AXES2.Y=this.gamepad.axes[3])):t["GAMEPAD_"+e].active&&(t["GAMEPAD_"+e].active=!1,t.gamepaddisconnected&&t.gamepaddisconnected(e,this.gamepads[e]))}});if(Studio.DOMElement=function(t,i){this.element=document.getElementById(t),this.id=t;var e=this.element.style;e.position="absolute",this.width=this._width=0,this.height=this._height=0,e.top=this.y=parseFloat(e.top)||0,e.top=this.x=parseFloat(e.left)||0,e.transformOrigin="0 0 0",this.alpha=e.opacity||1,this.stage=i},Studio.inherit(Studio.DOMElement,Studio.DisplayObject),Studio.DOMElement.prototype.hide=function(){this.element.style.display="none"},Studio.DOMElement.prototype.show=function(){this.element.style.display="block"},Studio.DOMElement.prototype.draw=Studio.DOMElement.prototype.vertex_children=function(){this.active&&(this.__alpha&&(this.element.style.opacity=this.alpha),this.__x&&(this.element.style.left="0",this.element.style.transform="translate("+((this.__x-this.stage.camera.x)*this.stage.camera.scaleX+this.stage.camera.focus.x)+"px, "+((this.__y-this.stage.camera.y)*this.stage.camera.scaleY+this.stage.camera.focus.y)+"px) rotate("+this._world.rotation+"deg) scale("+this.scaleX*this.stage.camera.scaleX+")"),this.__z&&(this.element.style.z_index=this.__z))},!window.console)var console={log:function(){},warn:function(){}};Object.keys||(console.warn("This browser does not support Object.keys() . Using polyfill instead."),Object.keys=function(){var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=e.length;return function(h){if("object"!=typeof h&&("function"!=typeof h||null===h))throw new TypeError("Object.keys called on non-object");var o=[],n,r;for(n in h)t.call(h,n)&&o.push(n);if(i)for(r=0;r<s;r++)t.call(h,e[r])&&o.push(e[r]);return o}}()),"function"!=typeof Object.create&&(console.warn("This browser does not support Object.create() . Using polyfill instead."),Object.create=function(){var t=function(){};return function(i){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof i)throw new TypeError("Argument must be an object");t.prototype=i;var e=new t;return t.prototype=null,e}}()),function(){for(var t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.warn("This browser does not support requestAnimationFrame() . Using setTimeout() instead."),window.requestAnimationFrame=function(t){return window.setTimeout(function(){t(performance.now())},1e3/60)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),Object.defineProperty?Object.defineProperty(Function.prototype,"setupPool",{value:setupPool}):Function.prototype.setupPool=setupPool,window.Studio||(window.Studio={stages:[],stage:null,tko:null,assets:{length:0},queue:0,progress:0,sin:Math.sin,cos:Math.cos,random:Math.random,abs:Math.abs,my:{ratio:1},temp:{},info:{displayObjects:0},active:!0,cap:50,draws:0,loaded:!0,version:"0.5.1",now:0,delta:0},Studio.time=1,Studio.interval=null,Studio.browser=navigator.userAgent.toLowerCase(),Studio.disableRAF=!1,Studio.RAF),Studio.updateProgress=function(){this.progress=this.queue/this.assets.length},Studio.addAsset=function(t,i){return this.assets[t]?(console.warn("Already loaded : ",t,Studio.assets[i]),!1):(this.assets.length+=1,this.assets[t]=new i,this.updateProgress(),!0)},Studio.start=function(t){Studio.queue===Studio.assets.length&&(Studio.progress=1),t?(Studio.now=t,Studio.time=t,Studio.RAF=requestAnimationFrame(Studio.loop)):Studio.RAF=requestAnimationFrame(Studio.start)},Studio.loop=function(t){Studio.tick(t),Studio.draws=0,Studio.stage.loop(Studio.delta),Studio.RAF=requestAnimationFrame(Studio.loop)},Studio.console=function(t){this.delta=16.6666666,this.now+=this.delta},Studio.capped=function(t){this.delta=t-this.now,this.now=t,this.delta=this.cap>this.delta?this.delta:this.cap},Studio.uncapped=function(t){this.delta=t-this.now,this.now=t},Studio.tick=Studio.capped,Studio.stopTime=function(){},Studio.resetTime=function(){},Studio.handleVisibilityChange=function(){document.hidden?(console.log("%cStudio Paused (visibilitychange)",Studio.statStyle),cancelAnimationFrame(Studio.RAF)):(console.log("%cStudio Play (visibilitychange)",Studio.statStyle),Studio.RAF=requestAnimationFrame(Studio.start))},document.addEventListener("visibilitychange",Studio.handleVisibilityChange,!1),Studio.z_index=function(t,i){return t.z<i.z?-1:t.z>i.z?1:0},Studio.round=function(t){return t+.5|0},Studio.apply=function(t){for(Studio.temp.keys=Object.keys(t),Studio.temp.keys_i=Studio.temp.keys.length;Studio.temp.keys_i;)"color_hex"==Studio.temp.key&&this.color.setFromHex(t[Studio.temp.key]),Studio.temp.key=Studio.temp.keys[Studio.temp.keys_i-1],this[Studio.temp.key]=t[Studio.temp.key],Studio.temp.keys_i--;return this},Studio.addTo=function(t,i){for(var e in i)i.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=i[e])},Studio.extend=function(t,i){t.prototype=new i,t.prototype.constructor=t},Studio.Messenger=function(){this.listeners=[],this.status=0},Studio.Messenger.prototype.addListener=function(t,i){this.listeners.push({callback:t,who:i}),i?i[t].call(i,this.status):t(this.status)},Studio.Messenger.prototype.setStatus=function(t){this.status=t;for(var i=null,e=0;e<this.listeners.length;e++)i=this.listeners[e].who,i?i[this.listeners[e].callback].call(i,this.status):this.listeners[e].callback(this.status)},Studio.TOP=Studio.LEFT=0,Studio.MIDDLE=Studio.CENTER=.5,Studio.BOTTOM=Studio.RIGHT=1,Studio.infoStyle="background-color: #3af; padding: 2px 4px; color: #fff",Studio.errorStyle="background-color: #c01; padding: 2px 4px;",Studio.warningStyle="background-color: #fd2; padding: 2px 4px;",Studio.statStyle="background-color: #eee; padding: 2px 4px; color: #555; font-size: 10px",Studio.engineStyle="background-color: #eee; color: #3af; padding: 1px 4px; border: 1px solid #3af",Studio.Box=function(t,i,e,s){return this.left=t||0,this.top=i||0,this.right=t+e||1,this.bottom=i+s||1,this},Studio.Box.prototype={constructor:Studio.Box,set:function(t,i,e,s){this.left=t||this.left,this.top=i||this.top,this.right=t+e||this.right,this.bottom=i+s||this.bottom},get_bounds:function(t){this.get_straight_bounds(t)},get_straight_bounds:function(t){this.left=t._dx-t._world.width*t.anchorX,this.right=this.left+t._world.width,this.top=t._dy-t._world.height*t.anchorY,this.bottom=this.top+t._world.height},get_rotated_bounds:function(t){this.left=t._world.x-t._world.width*t.anchorX*2,this.right=this.left+3*t._world.width,this.top=t._world.y-t._world.height*t.anchorY*3,this.bottom=this.top+2*t._world.height}},Studio.Color=function(t,i,e,s){return this.r=t/255||0,this.g=i/255||0,this.b=e/255||0,this.a=s||1,this.style="rgba(255,255,255,1)",this._build_style(),this},Studio.Color.prototype={constructor:Studio.Color,set:function(t,i,e,s){return this.r=t/255,this.g=i/255,this.b=e/255,this.a=s,this._build_style(),this},red:function(t){return this.r=t,this},green:function(t){return this.g=t,this},blue:function(t){return this.b=t,this},alpha:function(t){return this.a=t,this},build:function(){return this._build_style(),this},setFromHex:function(t){return 4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff"),7===t.length&&(t+="ff"),this.set("0x"+t[1]+t[2]|0,"0x"+t[3]+t[4]|0,"0x"+t[5]+t[6]|0,("0x"+t[7]+t[8]|0)/255),this},_build_style:function(){this.style="rgba("+parseInt(255*this.r)+","+parseInt(255*this.g)+","+parseInt(255*this.b)+","+this.a+")"}},Studio.RED=new Studio.Color(204,0,17,1),Studio.YELLOW=new Studio.Color(255,221,34,1),Studio.BLUE=new Studio.Color(51,170,255,1),Studio.DisplayProperty=function(){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.angle=0,this.alpha=1,this.speed=1},Studio.DisplayProperty.prototype={constructor:Studio.DisplayProperty,apply:Studio.apply};var LinkedList=function(){this.first=null,this.last=null,this.length=0};LinkedList.prototype={add:function(t){return++this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},addItems:function(t){for(var i=0;i!==arguments.length;i++)this.add(arguments[i])},insert:function(t,i){this.length++,t.prev=i,i!==this.last?i.next=t:(this.last=t,t.next=this.first)},init:function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.length=0},remove:function(t){if(1===this.length)return this.init(),t.next=null,void(t.prev=null);this.first===t?this.first=this.first.next:this.last===t&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=null,t.prev=null,null===this.first&&(this.last=null),this.length--},update:function(t,i){for(var e=this.first;e;)this.next=e.next,e.update(t,i),e=e.next||this.next},render:function(t,i){for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},action:function(t){for(var i=this.first;i;)this.next=i.next,i[t](),i=i.next||this.next},removeAll:function(t){for(var i=this.first;i;)this.next=i.next,this.pdispose&&this.pdispose(),this.remove(i),i=i.next||this.next;i=null,t&&this.add(t)},toString:function(){for(var t=this.first,i="linked list : [";t;)i+=t,t=t.next;i+="];"},constructor:LinkedList},Studio.Plugin=function(t){this.init=null,this.options={},this.action=null,this.apply(t)},Studio.Plugin.constructor=Studio.Plugin,Studio.Plugin.prototype.apply=Studio.apply,Studio.Plugin.prototype._options=function(t){for(var i in t)this.options[i]=t[i]},Studio.Image=function t(i,e){return this.path=i,this.image=null,this.width=1,this.height=1,this.slice={Full:{x:0,y:0,width:1,height:1}},this.sliceGL={},this.status=new Studio.Messenger,e&&this.addSlice(e),i&&this.loadImage(i),this},Studio.Image.prototype.constructor=Studio.Image,Studio.Image.prototype.ready=!1,Studio.Image.prototype.height=1,Studio.Image.prototype.width=1,Studio.Image.prototype.loadImage=function t(i){if(Studio.assets[i])return console.warn("Already loaded : ",i,Studio.assets[i]),this.image=Studio.assets[i],this.ready=!0,this.status.setStatus(this.ready),this;Studio.assets[i]=new Image,Studio.assets.length++;var e=this;Studio.assets[i].onload=function t(){return Studio.queue++,Studio.progress=Studio.queue/Studio.assets.length,e.slice.Full.height=this.height,e.slice.Full.width=this.width,e.width=this.width,e.height=this.height,Studio.queue===Studio.assets.length&&(Studio.loaded=!0),e.addSlice(e.slice),e.ready=!0,e.status.setStatus(e.ready),e},Studio.assets[i].src=i,this.image=Studio.assets[i]},Studio.Image.prototype.buildSliceForGL=function t(i){var e=i.x/this.width,s=i.y/this.height;return{x:e,y:s,width:i.width/this.width+e,height:i.height/this.height+s}},Studio.Image.prototype.addSlice=function t(i){for(var e in i)this.slice[e]=i[e],this.sliceGL[e]=this.buildSliceForGL(i[e])},Studio.Cache=function(t,i,e){var e=e||1;this.image=document.createElement("canvas"),this.image.width=t*e||512,this.image.height=i*e||512,this.width=t,this.height=i,this.ready=!1,this.ctx=this.image.getContext("2d"),this.ctx.scale(e,e),this.slice.Full={x:0,y:0,width:this.image.width,height:this.image.height}},Studio.extend(Studio.Cache,Studio.Image),Studio.Ease={},Studio.Ease.linear=function(t){return t},Studio.Ease.snap=function(t){return t+.5|0},Studio.Ease.chillInOut=function(t){var i=.75;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},Studio.Ease.backOut=function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},Studio.Ease.bounceOut=function(t){return t<.363636?7.5625*t*t:t<.727272?7.5625*(t-=.545454)*t+.75:t<.90909?7.5625*(t-=.818181)*t+.9375:7.5625*(t-=.959595)*t+.984375},Studio.Ease.elasticOut=function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/6.283,e*Math.pow(2,-10*t)*Math.sin(6.283*(t-i)/s)+1)},Studio.Ease.linearRandom=function(t){return Math.random()*t},Studio.Ease.random=function(){return Math.random()},Studio.Ease.shake=function(){return Math.random()-.5},Studio.Ease.quadIn=function(t){return t*t},Studio.Ease.quadOut=function(t){return t*(2-t)},Studio.Ease.quadInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Studio.DisplayObject=function(t){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.anchorX=.5,this.anchorY=.5,this.rotation=0,this.alpha=1,this.visible=1,this.speed=1,this.active=1,this.orbits=!0,this.orbit=0,this.inheritRotation=!0,this.orbit_speed=1,t&&this.apply(t),this._boundingBox=new Studio.Box,this._alpha=this.alpha,this._visible=this.alpha*this.visible,this.parent=null,this.hasChildren=0,this.__x=this._world.x,this.__y=this._world.y,this._dx=this._world.x,this._dy=this._world.y},Studio.difference={},Studio.DisplayObject.prototype={constructor:Studio.DisplayObject,_world:new Studio.DisplayProperty,blendmode:"source-over",apply:Studio.apply,__update_XY:!0,__update_SCALE:!0,__update_DIMENSIONS:!0,__update_SPEED:!0,__update_ALPHA:!0,__update_ROTATION:!0,addChild:function(t){return this.hasOwnProperty("children")||(this.children=[]),this.hasOwnProperty("_world")||(this._world=new Studio.DisplayProperty,this._initWorld()),t.hasOwnProperty("_world")||(t._world=new Studio.DisplayProperty),t.parent=this._world,this.children[this.hasChildren]=t,this.hasChildren++,t.force_update(),t._dset(),t.hasChildren&&t.force_update_children(),this},_initWorld:function(){this._world.x=this.x,this._world.y=this.y,this._world.y=this.y,this._world.z=this.z,this._world.height=this.height,this._world.width=this.width,this._world.scaleX=this.scaleX,this._world.scaleY=this.scaleY,this._world.rotation=this.rotation,this._world.angle=this.angle,this._world.alpha=this.alpha,this._world.speed=this.speed},addChildren:function(){for(var t=0;t!==arguments.length;t++)this.addChild(arguments[t]);return this},getChildByName:function(t){for(var i=0;i!==this.hasChildren;i++)if(this.children[i].name===t)return this.children[i];return null},_destroy:function(){for(var t in this)this.hasOwnProperty(t)||delete this[t]},_order:function(){this.children.sort(Studio.z_index)},draw:function(){},snapPixels:function(){this._dx=this._dx+0|0,this._dy=this._dy+0|0,this._world.height=this._world.height+0|0,this._world.width=this._world.width+0|0},hitTestPoint:function(t,i){return this._relativeX=t-this._world.x,this._relativeY=i-this._world.y,this.anchoredX=this.anchorX*this._world.width,this.anchoredY=this.anchorY*this._world.height,!(this._relativeX<-this.anchoredX&&this._relativeY<-this.anchoredY)&&(!(this._relativeX>this.width&&this._relativeY>this.height)&&(this._world.rotation&&(t=this._relativeX*Math.cos(-this.angle)-this._relativeY*Math.sin(-this.angle),i=this._relativeX*Math.sin(-this.angle)+this._relativeY*Math.cos(-this.angle),this._relativeX=t,this._relativeY=i),this._relativeX>-this.anchoredX&&this._relativeY>-this.anchoredY&&this._relativeX<this._world.width-this.anchoredX&&this._relativeY<this._world.height-this.anchoredY))},hitTestRect:function(t){return Studio.difference.height=this._world.height+t._world.height,Studio.difference.width=this._world.width+t._world.width,Studio.difference.x=this._world.x-this._world.width*this.anchorX-t._world.x-t._world.width*t.anchorX,Studio.difference.y=this._world.y-this._world.height*this.anchorY-t._world.y-t._world.height*t.anchorY,Studio.difference.x<0&&Studio.difference.y<=0&&Studio.difference.height+Studio.difference.y>=0&&Studio.difference.width+Studio.difference.x>=0},vertex_children:function(t,i,e){if(this.hasChildren)for(var s=0;s!==this.hasChildren;s++)this.children[s].buildElement(t,i,e)},render_children:function(t,i,e){if(this.hasChildren)for(var s=0;s!==this.hasChildren;s++)this.children[s].render(t,i,e)},render:function(t,i,e){this._visible&&(e?this._delta(i):this._dset(),t.snap&&this.snapPixels(),this.draw(t.ctx),this.render_children(t,i,e)),this.onExitFrame&&this.onExitFrame()},update_visibility:function(){this._world.alpha=this.alpha*this.parent.alpha,this._visible=this._world.alpha*this.visible},setAlpha:function(t){this._world.alpha!==t.globalAlpha&&this._visible&&(t.globalAlpha=this._world.alpha),this.blendmode!==t.globalCompositeOperation&&this._visible&&(t.globalCompositeOperation=this.blendmode)},update_scale:function(){this._world.scaleX=this.parent.scaleX*this.scaleX,this._world.scaleY=this.parent.scaleY*this.scaleY},update_dimensions:function(){this._world.width=this.width*this._world.scaleX,this._world.height=this.height*this._world.scaleY},update_angle:function(){this.angle=this._world.rotation/180*3.14159265},update_speed:function(){this._world.speed=this.speed*this.parent.speed},orbitXY:function(){var t=this.x*this._world.scaleX,i=this.y*this._world.scaleY,e=Studio.sin((this.parent.angle+this.orbit)*this.orbit_speed),s=Studio.cos((this.parent.angle+this.orbit)*this.orbit_speed);this._orbitX=t*s-i*e,this._orbitY=t*e+i*s},update_rotation:function(){this.inheritRotation?this._world.rotation=this.parent.rotation+this.rotation:this._world.rotation=this.rotation,this._world.rotation?this.update_angle():this.angle=0},update_orbit_xy:function(){this.orbitXY(),this._world.x=this._orbitX+this.parent.x,this._world.y=this._orbitY+this.parent.y},update_xy:function(){this.orbits&&this.parent.angle?this.update_orbit_xy():(this._world.x=this.x*this.parent.scaleX+this.parent.x,this._world.y=this.y*this.parent.scaleY+this.parent.y)},snapshot:function(){this.__x=this._world.x,this.__y=this._world.y,this.__update_DIMENSIONS&&(this.__width=this._world.width,this.__height=this._world.height),this._world.rotation&&(this._world.angle=this.angle)},__deltaXY:function(t){this.__update_XY&&(this._dx=this.__delta(this.__x,this._world.x,t),this._dy=this.__delta(this.__y,this._world.y,t))},__deltaHW:function(t){this.__update_DIMENSIONS&&(this._dwidth=this.__delta(this.__width,this._world.width,t),this._dheight=this.__delta(this.__height,this._world.height,t))},__deltaRotation:function(t){this._world.rotation&&(this._dAngle=this.__delta(this._world.angle,this.angle,t))},__delta:function(t,i,e){return t+(i-t)*e},_delta:function(t){this.__deltaXY(t),this.__deltaHW(t),this.__deltaRotation(t)},__dsetXY:function(){this.__update_XY&&(this._dx=this._world.x,this._dy=this._world.y)},__dsetHW:function(){this._dwidth=this._world.width,this._dheight=this._world.height},__dsetRotation:function(){this._world.rotation&&(this._dAngle=this.parent.angle+this.angle)},_dset:function(){this.__dsetXY(),this.__dsetHW(),this.__dsetRotation()},_snapback:function(){this.force_update()},force_update:function(){this.update_visibility(),this.update_scale(),this.update_speed(),this.update_dimensions(),this.update_rotation(),this.update_xy(),this.snapshot()},force_update_children:function(t){for(var i=0;i!==this.hasChildren;i++)this.children[i].force_update();for(var i=0;i!==this.hasChildren;i++)this.children[i]._dset()},_update:function(t){this.__update_ALPHA&&this.update_visibility(),this._visible&&(this.__update_SCALE&&this.update_scale(),this.__update_SPEED&&this.update_speed(),this.__update_DIMENSIONS&&this.update_dimensions(),this.__update_ROTATION&&this.update_rotation(),this.__update_XY&&this.update_xy(),this.update_children(t))},update_children:function(t){if(this.hasChildren)for(var i=0;i!==this.hasChildren;i++)this.children[i].update(t)},logic_children:function(){this.hasChildren},_logic:function(){this.logic&&this.logic(),this.logic_children(),this.onEnterFrame&&this.onEnterFrame()},setAnchor:function(t,i){this.anchorX=t,this.anchorY=i||t},update:function(t){t&&this.snapshot(),this._logic(),this._update(t)}},Studio.DisplayList=function(t){this.cache=null,
this.ctx=null,this.cached=!1,this.first=null,this.last=null,this.length=0,this.marked=[],this.autoCache=!0,t&&this.apply(t)},Studio.extend(Studio.DisplayList,Studio.DisplayObject),Studio.DisplayList.prototype.cacheAsBitmap=function(t){this.cache=document.createElement("canvas"),this.cache.height=this.height*t.resolution,this.cache.width=this.width*t.resolution,this.ctx=this.cache.getContext("2d"),this.ctx.scale(t.resolution,t.resolution)},Studio.DisplayList.prototype.updateCache=function(){this.cached=!1,this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1),this.cached=!0},Studio.DisplayList.prototype._cacheIt=function(){this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1)},Studio.DisplayList.prototype.updateElement=function(t){t.render(this)},Studio.DisplayList.prototype.clearCachedElement=function(t){this.ctx.clearRect(t._world.x-t.width/2,t._world.y-t.height/2,t.width,t.height)},Studio.DisplayList.prototype.markedForRemoval=function(t){this.marked[this.marked.length]=t},Studio.DisplayList.prototype.removeMarked=function(){for(var t=0;t!==this.marked.length;t++)this.marked[t]&&this.clearCachedElement(this.marked[t]),this.marked[t]=null;this.marked.lengh=0},Studio.DisplayList.prototype.deactivateCache=function(){this.cached=!1},Studio.DisplayList.prototype.update=function(){this.marked.length&&this.removeMarked(),this.update_visibility(),this.update_scale(),this.update_dimensions(),this.update_xy(),this.update_speed();for(var t=this.first;t;)this.next=t.next,t.update(),t=t.next||this.next;!this.cached&&this.autoCache&&this.ctx&&this.updateCache()},Studio.DisplayList.prototype.render=function(t,i){if(this.cached)this._world.alpha!==t.ctx.globalAlpha&&(t.ctx.globalAlpha=this._world.alpha),this.draw(t.ctx);else for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},Studio.DisplayList.prototype.add=function(t){return t.parent=this,++this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},Studio.DisplayList.prototype.draw=function(t){t.drawImage(this.cache,0,0,this.cache.width,this.cache.height,this._world.x,this._world.y,this._world.width,this._world.height)},Studio.addTo(Studio.DisplayList.prototype,LinkedList.prototype),Studio.Rect=function(t){this.color=new Studio.Color(1,0,0,0),this.bounds=new Studio.Box(10,0,0,0),t&&this.apply(t)},Studio.extend(Studio.Rect,Studio.DisplayObject),Studio.Rect.prototype.addVert=function(t,i,e,s,h,o){t._batch[t._count++]=i,t._batch[t._count++]=e,t._batch[t._count++]=this.color.r,t._batch[t._count++]=this.color.g,t._batch[t._count++]=this.color.b,t._batch[t._count++]=this.color.a,t._batch[t._count++]=h,t._batch[t._count++]=o},Studio.Rect.prototype.buildElement=function(t,i,e){e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._world.z,this.bounds.left,this.bounds.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.bounds.right,this.bounds.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.bounds.left,this.bounds.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._world.z,this.bounds.right,this.bounds.bottom)},Studio.Rect.prototype.buildTriangles=function(t,i){this._delta(i),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._world.z,this.bounds.left,this.bounds.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.bounds.right,this.bounds.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.bounds.left,this.bounds.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.bounds.right,this.bounds.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.bounds.left,this.bounds.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._world.z,this.bounds.right,this.bounds.bottom)},Studio.Rect.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Rect.prototype.prepAngled=function(t){(this._dx||this._dy)&&t.translate(this._dx,this._dy),t.rotate(this._dAngle||0),1===this._world.scaleX&&1===this._world.scaleY||t.scale(this._world.scaleX,this._world.scaleY)},Studio.Rect.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.fillRect(-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height),t.restore()},Studio.Rect.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.strokeStyle="#fff",this.angle?this.drawAngled(t):t.fillRect(this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)},Studio.Clip=function(t){t&&this.apply(t)},Studio.extend(Studio.Clip,Studio.Rect),Studio.Clip.prototype.draw=function(t){t.save(),t.beginPath(),this.angle?this.drawAngled(t):t.rect(this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),t.clip()},Studio.Clip.prototype.drawAngled=function(t){this.prepAngled(t),t.rect(-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height)},Studio.CircleClip=function(t){t&&this.apply(t)},Studio.extend(Studio.CircleClip,Studio.Rect),Studio.CircleClip.prototype.draw=function(t){t.save(),t.beginPath(),t.arc(this._dx,this._dy,this._world.width/2,0,2*Math.PI),t.clip()},Studio.Restore=function(){},Studio.Restore.prototype=new Studio.Rect,Studio.Restore.prototype.constructor=Studio.Restore,Studio.Restore.prototype.draw=function(t){t.restore()},Studio.Circle=function(t){this.color=new Studio.Color(1,0,0,0),t&&this.apply(t)},Studio.extend(Studio.Circle,Studio.Rect),Studio.Circle.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.beginPath(),t.arc(this._world.x,this._world.y,this._world.width,0,2*Math.PI),t.fill()},Studio.Sprite=function(t){this.image=null,this.slice="Full",this.color=new Studio.Color(1,1,1,1),t&&this.apply(t)},Studio.extend(Studio.Sprite,Studio.Rect),Studio.Sprite.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.image,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height),t.restore()},Studio.Sprite.prototype.buildElement=function(t,i,e){e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._world.z,this.image.sliceGL[this.slice].x,this.image.sliceGL[this.slice].y),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.image.sliceGL[this.slice].width,this.image.sliceGL[this.slice].y),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.image.sliceGL[this.slice].x,this.image.sliceGL[this.slice].height),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._world.z,this.image.sliceGL[this.slice].width,this.image.sliceGL[this.slice].height)},Studio.Sprite.prototype.draw=function t(i){this.image&&this.image.ready&&(this.setAlpha(i),this.angle?this.drawAngled(i):(i.drawImage(this.image.image,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&i.drawImage(this.image.image,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this.border.width+this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this._dx+this._world.width>this.border.width&&i.drawImage(this.image.image,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this._dx-this._dwidth*this.anchorX-this.border.width,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight))))},Studio.SpriteAnimation=function(t){this.sheet=null,this.loop=[[0,0]],this.fps=12,this.frame=0,this.sliceX=0,this.sliceY=0,this.offsetY=0,this.offsetX=0,this.repeat=!0,this.startTime=0,t&&this.apply(t),this.setStartingFrame(this.frame)},Studio.extend(Studio.SpriteAnimation,Studio.Rect),Studio.SpriteAnimation.prototype.setStartingFrame=function(t){this.frame=t,this.startTime=Studio.time,this.myTime=this.startTime+t*(1e3/this.fps)},Studio.SpriteAnimation.prototype.draw=function(t){this.sheet&&this.sheet.ready&&(this.setAlpha(t),t.drawImage(this.sheet.image,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorX,this._dwidth,this._dheight),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&t.drawImage(this.sheet.image,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this.border.width+this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this._dx+this._world.width>this.border.width&&t.drawImage(this.sheet.image,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this._dx-this._dwidth*this.anchorX-this.border.width,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)),this.loop.length&&this.updateFrame())},Studio.SpriteAnimation.prototype.setSlice=function(){this.sliceX=this.loop[this.frame][0]+this.offsetX,this.sliceY=this.loop[this.frame][1]+this.offsetY},Studio.SpriteAnimation.prototype.updateFrame=function(){this.myTime+=Studio.delta,this.frame=(this.myTime-this.startTime)*this._world.speed/(1e3/this.fps)|0,this.frame>=this.loop.length&&(this.startTime=this.myTime,this.frame=0,this.onLoopComplete&&this.onLoopComplete.call(this)),this.setSlice()},Studio.Camera=function(t){this.stage={width:t.width,height:t.height},this.tracking=null,this.bound=null,this.active=!0},Studio.extend(Studio.Camera,Studio.DisplayObject),Studio.Camera.prototype.updateRect=function(){this.left=-this.bound._world.x*this.scaleX,this.top=-this.bound._world.y*this.scaleY,this.right=this.left+(this.bound._world.width*this.scaleX-this.stage.width),this.bottom=this.top+(this.bound._world.height*this.scaleY-this.stage.height)},Studio.Camera.prototype.update=function(t,i){this.tracking&&(this.tracking._delta(i),this.x=this.tracking._dx*this.scaleX-this.stage.width/2,this.y=this.tracking._dy*this.scaleY-this.stage.height/2),this.bound&&(this.updateRect(),this.x<this.left?this.x=this.left:this.x>this.right&&(this.x=this.right),this.y<this.top?this.y=this.top:this.y>this.bottom&&(this.y=this.bottom))},Studio.Camera.prototype.render=function(t,i){this.update(t,i),(this.x||this.y||1!==this.scaleX||1!==this.scaleY)&&t.ctx.setTransform(t.resolution*this.scaleX,0,0,t.resolution*this.scaleY,-this.x*t.resolution,-this.y*t.resolution)},Studio.Camera.prototype.track=function(t){this.tracking=t},Studio.Camera.prototype.bindTo=function(t){this.bound=t},Studio.Camera.prototype.unBind=function(){this.bindTo(null)},Studio.Camera.prototype.stopTracking=function(){this.track(null)},Studio.Scene=function(t){this.color=new Studio.Color(0,0,0,0),this.active=!1,this.image=null,this.loader=null,this.assets=[],this.children=[],this.buttons=[],this.tweens=Object.create(null),this.tween_length=0,t&&this.apply(t),this.build&&this.build.call(this,this),this.init&&this.init.call(this,this)},Studio.extend(Studio.Scene,Studio.DisplayObject),Studio.Scene.prototype.loadAssets=function(){for(var t=0;t!==arguments.length;t++)this.assets.push(new Studio.Image(arguments[t]))},Studio.Scene.prototype.addButton=function(t){this.buttons.unshift(t)},Studio.Scene.prototype.render_children=function(t,i){for(this.i=0;this.i!==this.hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].render(t,i,t.interpolate)},Studio.Scene.prototype.close=function(t){this.active=!1},Studio.Scene.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Scene.prototype.draw=function(t){return this.setAlpha(t),this.image?void t.drawImage(this.image.image,this._dx,this._dy,this.width,this.height):this.color?0===this.color.a?void t.clearRect(this._dx,this._dy,this.width,this.height):(this.setStyle(t),void t.fillRect(this._dx,this._dy,this.width,this.height)):void 0},Studio.Stage=function(t,i){return this.webgl=!1,this.fullscreen=!1,this.color=new Studio.Color(0,0,0,1),this.snap=!1,i&&this.apply(i),this._getCanvasElement(t),this._count=0,this._maxCount=16333,this.dur=1e3/60,this._d=this.dur/2,this.resolution=window.devicePixelRatio,this.interpolate=!0,this.smoothing=!0,i&&this.apply(i),this._sizeCanvas(this.fullscreen),this.setPixelRatio(),this.webgl&&(this.engine=Studio.Stage.prototype.WEBGL),this.allowPlugins(),this.engine.getContext.call(this),this.engine.init.call(this,this.ctx),this.engine.prep.call(this,this.ctx),this.render=this.engine.render,this._init(),console.log("%cStudio3 v"+Studio.version+"%c"+this.engine.type,Studio.infoStyle,Studio.engineStyle),this.verts=0,this},Studio.extend(Studio.Stage,Studio.Scene),Studio.Stage.prototype._getCanvasElement=function(t){if(t)this.canvas=document.getElementById(t);else{var i=document.body.getElementsByTagName("canvas");i[0]?this.canvas=i[0]:(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas))}},Studio.Stage.prototype.setColor=function(t,i,e,s){this.color.set(t,i,e,s),this.ctx.clearColor&&this.ctx.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)},Studio.Stage.prototype._init=function(){return this.ready=!1,this.autoPause=!1,this._watching=!1,this.children=[],this.buttons=[],this.activeScene=null,this.previousScene=null,this.camera=new Studio.Camera(this),this.nextID=0,this.anchorX=0,this.anchorY=0,this.active=!0,this._pause_buttons=!1,Studio.stage=this,this},Studio.Scene.prototype.allowPlugins=function(){this.plugins=Object.create(null),this.plugins.input=[],this.plugins.effect=[],this._effects=0,this._inputs=0},Studio.Stage.prototype._sizeCanvas=function(t){if(this.height=this.canvas.height||this.height,this.width=this.canvas.width||this.width,this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this._scaleRatio=1,1==t&&(this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.style.height="100%",this.canvas.style.width="100%"),t>=2){var i=window.innerWidth;this.maxwidth&&i>this.maxwidth&&(i=this.maxwidth),this.canvas.style.width=i+"px",this.canvas.style.height="auto",this._scaleRatio=i/this.width,3==t&&(this.canvas.style.height=window.innerHeight+"px")}},Studio.Stage.prototype.pauseButtons=function(t){this._pause_buttons=t},Studio.Stage.prototype.setPixelRatio=function(){this.canvas.width=this.width*this.resolution,this.canvas.height=this.height*this.resolution},Studio.Stage.prototype.fillScreen=function(){},Studio.Stage.prototype.addInput=function(t,i){i&&t._options(i),t.init(this),this.plugins.input.push(t),this._inputs++},Studio.Stage.prototype.addEffect=function(t,i){i&&t._options(i),t.init(this),this.plugins.effect.push(t),this._effects++},Studio.Stage.prototype.checkDataAttributes=function(){},Studio.Stage.prototype.setScene=function(t){t.parent=this,this.activeScene&&2===Studio.progress&&this.activeScene.onDeactivate&&this.activeScene.onDeactivate(this),this.previousScene=this.activeScene,this.activeScene=t,this.activeScene.active=!0,t.onActivate&&t.onActivate(this)},Studio.Stage.prototype.clearScene=function(){this.activeScene&&(this.previousScene=this.activeScene,this.activeScene=null,this.previousScene.onDeactivate?this.previousScene.onDeactivate(this):this.previousScene.active=!1)},Studio.Stage.prototype.watch=function(t){this._watching=t,this.children=t.children,this.hasChildren=t.hasChildren},Studio.Stage.prototype.update_children=function(t,i,e){for(this.i=0;this.i!==this.hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].update(t,i,e)},Studio.Stage.prototype.update_visibility=function(){this._alpha=this.alpha},Studio.Stage.prototype._timebased_updates=function(t){this.activeScene&&this.activeScene.update_tweens(t),this.update_tweens(t)},Studio.Stage.prototype.update=function(t,i){this.onEnterFrame&&this.onEnterFrame(),this._width=this.width,this._height=this.height,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._speed=this.camera.speed,this.update_visibility(),2===Studio.progress&&(this._inputs&&this.runInputs(i),this.updateScenes(),this.beforeDraw&&this.beforeDraw()),this._logic()},Studio.Stage.prototype._update_scene=function(t){t&&t.active&&t.update(this.interpolate)},Studio.Stage.prototype.updateScenes=function(){this._update_scene(this.activeScene),this._update_scene(this.previousScene),(this.hasChildren||this._watching)&&this.update_children(this.interpolate)},Studio.Stage.prototype.runEffects=function(){for(this.i=0;this.i!==this._effects;this.i++)this.plugins.effect[this.i].active&&this.plugins.effect[this.i].action(this)},Studio.Stage.prototype.runInputs=function(){for(this.i=0;this.i!==this._inputs;this.i++)this.plugins.input[this.i].active&&this.plugins.input[this.i].action(this)},Studio.Stage.prototype.loading=function(t){!0===Studio.loaded&&(this.onReady&&this.onReady(t),this.loop=this.activeloop)},Studio.Stage.prototype.activeloop=function(t){if(2===Studio.progress)return this.timeStep(t),void(this._effects&&this.runEffects(t));if(this.webgl||this.drawProgress(this.ctx,t),1===Studio.progress){if(this.onReady&&this.onReady(t),Studio.progress=2,!this.activeScene)return;this.activeScene.onActivate&&this.activeScene.onActivate(this)}},Studio.Stage.prototype.loop=Studio.Stage.prototype.loading,Studio.Stage.prototype.drawProgress=function(t){this.progressBar(t,Studio.progress),t.restore()},Studio.Stage.prototype.progressBar=function(t,i){t.fillStyle="rgba(255,255,255,.8)",t.fillRect((this.width-202)/2,(this.height-22)/2,202,22),t.fillStyle="rgba(0,0,0,1)",t.fillRect(2+(this.width-202)/2,2+(this.height-22)/2,198*i,18)},Studio.TextBox=function(t,i,e){return this.font="12px Arial",this.lineHeight=10,this.height=i,this.width=t,this.shadow=1,this.shadowColor="rgba(0,0,0,0.5)",this.cache=new Studio.Cache(t,i,e.resolution),this.cache.ctx.textBaseline="top",this.cache.ctx.font=this.font,this.text="",this.color="#fff",this._wrap_height=this.lineHeight,this.horizontal_align=Studio.LEFT,this.vertical_align=Studio.TOP,this._vertical_align=0,this},Studio.extend(Studio.TextBox,Studio.Rect),Studio.TextBox.prototype.setFont=function(t){return this.font=t,this},Studio.TextBox.prototype.setText=function(t){return this.text=t,this},Studio.TextBox.prototype.setColor=function(t){return this.color=t,this},Studio.TextBox.prototype.setFont=function(t){return this.cache.ctx.font=this.font=t,this},Studio.TextBox.prototype.finish=function(){this.reset(),this.wrapText()},Studio.TextBox.prototype.reset=function(){this.cache.ctx.clearRect(0,0,this.width,this.height),this.cache.ctx.font=this.font},Studio.TextBox.prototype.writeLine=function(t,i,e){this.shadow&&(this.cache.ctx.fillStyle=this.shadowColor,this.cache.ctx.fillText(t,i+1+this.shadow,e+this.shadow)),this.cache.ctx.fillStyle=this.color,this.cache.ctx.fillText(t,i+1,e)},Studio.TextBox.prototype.wrapText=function(){for(var t=this.text.split("\n"),i=0,e=0;e!==t.length;e++){for(var s=t[e].split(" "),h="",o=0;o<s.length;o++){var n=h+s[o]+" ",r=this.cache.ctx.measureText(n),a=r.width;a>this.width&&o>0?(a=this.cache.ctx.measureText(h).width,this.writeLine(h,2+(this.width-a)*this.horizontal_align|0,i),h=s[o]+" ",i+=this.lineHeight):h=n}this.writeLine(h,2+(this.width-this.cache.ctx.measureText(h).width)*this.horizontal_align|0,i),this._wrap_height=i+this.lineHeight,e!==t.length-1&&(i+=this.lineHeight)}this._wrap_height>this.height&&(this._wrap_height=this.height),this._vertical_align=this._wrap_height*this.vertical_align-this.height*this.vertical_align|0},Studio.TextBox.prototype.fit=function(){this.cache.height=this._wrap_height,this.wrapText()},Studio.TextBox.prototype.debugDraw=function(t){t.strokeRect(this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY-this._vertical_align,this._world.width,this._wrap_height)},Studio.TextBox.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.cache.image,0,0,this.cache.image.width,this.cache.image.height,-this.width*this.anchorX,-this.height*this.anchorY-this._vertical_align,this.width,this.height),t.restore()},Studio.TextBox.prototype.draw=function(t){this.setAlpha(t),this.angle?this.drawAngled(t):t.drawImage(this.cache.image,0,0,this.cache.image.width,this.cache.image.height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY-this._vertical_align,this._dwidth,this._dheight)},Studio.Scene.prototype.update_tweens=function(t){var i,e=0,s,h,o;for(i in this.tweens)if(s=this.tweens[i],s.actor._world?s.cur+=t*s.actor._world.speed:s.cur+=t,!s.active&&s.onStart&&(s.onStart.call(s.actor),s.active=1),(o=s.dir?1-s.cur/s.duration:s.cur/s.duration)<1&&o>0)for(e=0;e!==s.keys.length;e++)h=s.keys[e],this.update_property(s,h,o);else if(s.next)s.next._snapshot(),s.next.cur=s.cur-s.duration,this.tweens[i]=s.next;else{if(s._loop)return s.cur=0,s.onEnd&&s.onEnd.call(s.actor),void(s._reflect?s.dir?s.dir=0:s.dir=1:(s.actor.apply(s.original),s.active=0));s.reset?s.actor.apply(s.original):s.actor.apply(s.to),s.onEnd&&s.onEnd.call(s.actor),s=null,this.tweens[i]=null,delete this.tweens[i]}},Studio.Scene.prototype.update_property=function(t,i,e){t.actor[i]=t.original[i]+Studio.Ease[t.ease](e)*(t.to[i]-t.original[i])},Studio._tween_object=function(t,i,e,s,h,o){this.actor=t,this.ease=i,this.original={},this.to=e,this.cur=0,this.duration=s,this.onStart=o,this.onEnd=h,this._loop=!1,this._reflect=!0,this.reset=!1,this.dir=0,this.active=0,this.id=null,this.keys=Object.keys(e),this.next=null,this.prev=null},Studio._tween_object.prototype.constructor=Studio._tween_object,Studio._tween_object.prototype.loop=function(){return this._loop=!0,this},Studio._tween_object.prototype.apply=function(t){for(var i in t)this[i]=t[i];return this},Studio._tween_object.prototype.reflect=function(t){return this._reflect=t,this},Studio._tween_object.prototype.setActor=function(t){return this.actor=t,this},Studio.Scene.prototype.createTween=function(t,i,e,s,h,o){var n=new Studio._tween_object(t,i,e,s,h,o);n.id=this.nextID;for(var r in e)n.original[r]=t[r];return this.nextID++,n},Studio._tween_object.prototype._snapshot=function(){for(var t in this.to)this.original[t]=this.actor[t]},Studio._tween_object.prototype.then=function(t,i,e,s,h){return this.next=new Studio._tween_object(this.actor,t,i,e,s,h),this.next.prev=this,this.next},Studio._tween_object.prototype.last=function(){for(var t=this.next,i=this;null!==t;)i=t,t=t.next;return i},Studio._tween_object.prototype.completeLoop=function(t){return this.next=t,t.prev=this,this.next},Studio.Scene.prototype.createLoop=function(t,i,e,s,h){return this.tweens[this.nextID]=this.createTween(t,i,e,s,h),this.tweens[this.nextID-1].loop=!0,this.tweens[this.nextID-1]},Studio.Scene.prototype.addTween=function(t,i,e,s,h){return this.tweens[this.nextID]=this.createTween(t,i,e,s,h),this.tweens[this.nextID-1]},Studio.Scene.prototype.playTween=function(t){t.cur=0;for(var i=0;i!==t.keys.length;i++)t.original[t.keys[i]]=t.actor[t.keys[i]];this.tweens[t.id]=t},Studio.Scene.prototype.stopTween=function(t,i,e){if(this.tweens[t.id]){if(t.cur=0,t.dir=0,i){var s;if(e)for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.original[t.keys[s]];else for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.to[t.keys[s]]}this.tweens[t.id]=null,delete this.tweens[t.id]}},Studio.Pattern=function(t){return this.height=512,this.width=512,this.overflowX=0,this.overflowY=0,this.resolution=1,this.image=null,this.slice="Full",this.offsetX=0,this.offsetY=0,t&&this.apply(t),this.width=this.width+this.overflowX,this.height=this.height+this.overflowY,this.cache=new Studio.Cache(this.width,this.height,this.resolution),this._cached=!1,this.image.status.addListener("onImageReady",this),this},Studio.extend(Studio.Pattern,Studio.Rect),Studio.Pattern.prototype.setPattern=function(){for(var t=this.image.slice[this.slice],i=t.width*this.scaleX||0,e=t.height*this.scaleY||0,s=0;s<this.width;s+=i)for(var h=0;h<this.height;h+=e)this.offsetX+i>i&&(this.offsetX-=i),this.offsetY+e>e&&(this.offsetY-=e),this.cache.ctx.drawImage(this.image.image,t.x,t.y,t.width,t.height,s+this.offsetX,h+this.offsetY,i,e);return this},Studio.Pattern.prototype.checkOverflow=function(){this.x>0&&(this.x-=this.overflowX),this.y>0&&(this.y-=this.overflowY),this.x<-this.overflowX&&(this.x+=this.overflowX),this.y<-this.overflowY&&(this.y+=this.overflowY)},Studio.Pattern.prototype.onImageReady=function(t){t&&this.setPattern()},Studio.Pattern.prototype.debugDraw=function(t){t.strokeRect(this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY-this._vertical_align,this._world.width,this._wrap_height)},Studio.Pattern.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.cache.image,0,0,this.cache.image.width,this.cache.image.height,-this._dwidth*this.anchorX,-this._dheight*this.anchorY,this._dwidth,this._dheight),t.restore()},Studio.Pattern.prototype.draw=function(t){this.setAlpha(t),this.angle?this.drawAngled(t):t.drawImage(this.cache.image,0,0,this.cache.image.width,this.cache.image.height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)},Studio.load=function(t,i,e,s){var h=new XMLHttpRequest;h.onload=function o(){var n=null;h.status>=200&&h.status<400||0==h.status?(console.log("%cStudio loaded file : "+t,Studio.statStyle),"json"==i.toLowerCase()&&(n=JSON.parse(h.responseText)),e&&(s?(console.log(e,s),e.call(s,n)):e(n))):this.onerror()},h.onerror=function(){console.log("%cStudio failed to load file : "+t,Studio.errorStyle)},h.open("GET",t,!0),h.send()},Studio.TileMap=function(t,i,e,s){this.cache=new Studio.Cache(t,i,e),this.buffer=new Studio.Cache(t,i,e),this.offsetX=0,this.offsetY=0,this.maxWidth=0,this.resolution=e||1,this.data=null,s&&this.apply(s)},Studio.TileMap.prototype={apply:Studio.apply,constructor:Studio.TileMap,build:function(t,i,e,s,h,o){var n=t,r=this.cache.ctx,a=i.tileWidth,d=i.tileHeight;this.maxWidth=Math.floor(this.cache.width/a)/this.resolution;for(var e=e||0,s=s||0,u=h||this.maxWidth,c=o||n.height-s,l=0;l!=c;l++)for(var p=0;p!=u;p++){var _=n.data[(l+s)*n.width+(p+e)]-i.firstgid,g=_/i.across|0,f=_-g*i.across;r.drawImage(i.set.image,f*i.tileWidth,g*i.tileHeight,i.tileWidth,i.tileHeight,p*i.tileWidth,l*i.tileHeight,i.tileWidth,i.tileHeight)}this.buffer.ctx.clearRect(0,0,this.cache.width,this.cache.height),this.buffer.ctx.drawImage(this.cache.image,0,0),document.body.appendChild(this.buffer.image),this.cache.ready=!0},offsetMap:function(t,i){this.offsetX+=t,this.offsetX<0&&(this.offsetX=0),this.offsetX+this.maxWidth>this.data.width&&(this.offsetX=this.data.width-this.maxWidth),this.cache.ctx.clearRect(0,0,this.cache.width,this.cache.height);for(var e in this.data.layers)this.build(this.data.layers[e],this.tileset,this.offsetX,this.offsetY,this.maxWidth)},_onLoad:function t(i){if(!i)return void console.log("The image isn't ready so we need to wait.");1==i&&(console.log("The Image is ready, we can now create the tileset from the information provided, and then build the map from the data layer."),this.offsetMap(0,0))},onMapLoad:function(t){this.data=t,this.set=t.tilesets[0];var i=new Studio.Image("assets/"+this.set.image);this.tileset=new Studio.TileSet(i,this.set.tilewidth,this.set.tileheight,this.set.imagewidth),i.status.addListener("_onLoad",this)},load:function(t,i){Studio.load(t,i,this.onMapLoad,this)}},Studio.TileSet=function(t,i,e,s){this.firstgid=1,this.tileWidth=i||32,this.tileHeight=e||32,this.across=s/i|0,this.set=t||null},Studio.TileSet.prototype={constructor:Studio.TileSet,onLoadComplete:function(t){t.across=t.set.width/t.tileWidth}},Studio.Effect={},Studio.Effect.BillAtkinsonDither_BW=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1},action:function(t){for(var i=t.ctx.getImageData(0,0,t.canvas.width,t.canvas.height),e=i.data,s=parseInt(4*t.canvas.width),h=e.length,o=0;o<h;o+=4)this.oldpixel=e[o],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[o]=e[o+1]=e[o+2]=this.newpixel,this.qerror=.15*(this.oldpixel-this.newpixel),o%s==0&&o+4%s===0&&o+8%s===0||(e[o+5]=e[o+6]=e[o+4]+=this.qerror,e[o+9]=e[o+10]=e[o+8]+=this.qerror,e[o+5+s]=e[o+6+s]=e[o+4+s]+=this.qerror,e[o+1+s]=e[o+2+s]=e[o+s]+=this.qerror,e[o+s-3]=e[o+s-2]=e[o+s-4]+=this.qerror,e[o+2*s]=e[o+2*s]=e[o+2*s]+=this.qerror);t.ctx.putImageData(i,0,0)}}),Studio.Effect.Posterize=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1},action:function(t){for(var i=t.ctx.getImageData(0,0,t.canvas.width,t.canvas.height),e=i.data,s=4*t.canvas.width,h=e.length,o=0;o<h;o++)this.oldpixel=e[o],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[o]=this.newpixel;t.ctx.putImageData(i,0,0)}}),Studio.Effect.Replicator=new Studio.Plugin({options:{x:3,y:3},init:function(t){this.cache=new Studio.Cache},action:function(t){var i=t.canvas.width/this.options.x,e=t.canvas.height/this.options.y;this.cache.image.width=i,this.cache.image.height=e,this.cache.buffer.drawImage(t.canvas,0,0,i,e);for(var s=0;s!=this.options.x;s++)for(var h=0;h!=this.options.y;h++)t.ctx.drawImage(this.cache.image,s*i,h*e,i,e)}}),Studio.Effect.Bloom=new Studio.Plugin({options:{},init:function(t){this.height=t.canvas.height/2*t.resolution,this.width=t.canvas.width/2*t.resolution,this.cache=new Studio.Cache(this.width,this.height),this.cache.buffer.globalAlpha=.25},action:function(t){this.cache.buffer.globalCompositeOperation="source-over",this.cache.buffer.fillStyle="rgba(0,0,0,.35)",this.cache.buffer.fillRect(0,0,this.width,this.height),this.cache.buffer.globalCompositeOperation="lighten",this.cache.buffer.drawImage(t.canvas,0,0,t.width,t.height),t.ctx.globalCompositeOperation="lighten",t.ctx.drawImage(this.cache.image,0,0,t.canvas.width,t.canvas.height),t.ctx.globalCompositeOperation="source-over"}}),Studio.Effect.Cursor=new Studio.Plugin({options:{},init:function(t){this.cursor=new Studio.Image("assets/cursor.png"),t.canvas.style.cursor="none"},action:function(t){t.ctx.drawImage(this.cursor.image,t.mouse.x-8,t.mouse.y-8,48,48)}}),Studio.Effect.Red=new Studio.Plugin({options:{},init:function(t){},action:function(t){for(var i=t.ctx.getImageData(0,0,t.canvas.width,t.canvas.height),e=i.data.buffer,s=new Uint8Array(e),h=new Uint32Array(e),o=h.length,n=0;n!=o;n++){var r=i.data[4*n+1];h[n]=255<<24|255-r<<16|r<<8|255-r}i.data.set(s),t.ctx.putImageData(i,0,0)}}),Studio.Effect.Wave=new Studio.Plugin({action:function(t){this.cache.buffer.drawImage(t.canvas,0,0,t.width,t.height);for(var i=this.w.length,e=0;e!=i;e+=1)t.ctx.drawImage(this.cache.image,e*this.width,0,this.width,t.height,e*this.width,this.w[e],this.width,t.height),this.w[e]+=2*Math.cos(this.count),this.count+=.02},init:function(t){this.width=1,this.w=[];for(var i=Math.ceil(t.width/this.width),e=0;e<i;e+=1)this.w[e]=0;this.cache=new Studio.Cache(t.width,t.height),this.count=0}})
;var FRAGMENTSHADER=["precision lowp float;","uniform sampler2D u_image;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","   if(v_texture.x==10.0){","\t\tgl_FragColor = v_color;","\t}else{","\t\tgl_FragColor = texture2D(u_image, v_texture) * v_color;","\t}","}"].join("\n"),VERTEXSHADER=["attribute vec3 a_position;","attribute vec4 a_color;","attribute vec2 a_texture;","uniform vec2 u_resolution;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","\tvec2 canvas_coords = ((vec2(a_position.x,a_position.y)/ u_resolution)*2.0) - 1.0;","\tgl_Position = vec4(canvas_coords * vec2(1.0,-1.0), a_position.z, 1.0);","\tv_color = a_color;","\tv_texture = a_texture;","}"].join("\n");Studio.Stage.prototype.loadShader=function(t,i){this.ctx.shaderSource(t,i)},Studio.Stage.prototype.WEBGL={type:"webgl",antialias:!1,premultipliedAlpha:!1,stencil:!0,getContext:function(){this.ctx=this.canvas.getContext("webgl",{antialias:this.WEBGL.antialias,premultipliedAlpha:this.WEBGL.premultipliedAlpha,stencil:this.WEBGL.stencil})},init:function(t){t._count=0,t._batch=new Float32Array(524288),t.clearColor(this.color.r,this.color.g,this.color.b,this.color.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.vertexShader=t.createShader(t.VERTEX_SHADER),this.loadShader(this.vertexShader,VERTEXSHADER),t.compileShader(this.vertexShader),this.fragmentShader=t.createShader(t.FRAGMENT_SHADER),this.loadShader(this.fragmentShader,FRAGMENTSHADER),t.compileShader(this.fragmentShader),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),t.useProgram(this.program),this.buffer=t.createBuffer(),this.prepTexture=function t(i){this._texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,stage._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)},this.setTexture=function t(i,e){this._texture||this.prepTexture(this.ctx),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,i.image),e&&this.ctx.generateMipmap(this.ctx.TEXTURE_2D)}},prep:function(t){t.resolutionLocation=t.getUniformLocation(this.program,"u_resolution"),t.enableVertexAttribArray(0),t.positionLocation=t.getAttribLocation(this.program,"a_position"),t.bindAttribLocation(this.program,0,"a_position"),t.colorLocation=t.getAttribLocation(this.program,"a_color"),t.textureLocation=t.getAttribLocation(this.program,"a_texture"),t.uniform2f(t.resolutionLocation,this.width,this.height),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(t.positionLocation),t.enableVertexAttribArray(t.colorLocation),t.enableVertexAttribArray(t.textureLocation),t.vertexAttribPointer(t.positionLocation,2,t.FLOAT,!1,32,0),t.vertexAttribPointer(t.colorLocation,4,t.FLOAT,!1,32,8),t.vertexAttribPointer(t.textureLocation,2,t.FLOAT,!1,32,24),this._rect_index_buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),this._rect_index=new Uint16Array(6*this._maxCount);for(var i=0,e=0;i<6*this._maxCount;i+=6,e+=4)this._rect_index[i+0]=e+0,this._rect_index[i+1]=e+1,this._rect_index[i+2]=e+2,this._rect_index[i+3]=e+1,this._rect_index[i+4]=e+2,this._rect_index[i+5]=e+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._rect_index,t.STATIC_DRAW),this._r_count=0},render:function(t){this.ctx._count=0,this.vertex_children(this.ctx,t,this.interpolate),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,this.ctx._batch,this.ctx.DYNAMIC_DRAW),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT),this.ctx.drawElements(this.ctx.TRIANGLES,6*this.hasChildren,this.ctx.UNSIGNED_SHORT,0)}},Studio.Stage.prototype.CANVAS={type:"2dContext",getContext:function(){this.ctx=this.canvas.getContext("2d")},init:function(){this.ctx.webkitImageSmoothingEnabled=this.smoothing,this.ctx.mozImageSmoothingEnabled=this.smoothing,this.ctx.imageSmoothingEnabled=this.smoothing},prep:function(){},render:function(t){this.ctx.setTransform(this.resolution,0,0,this.resolution,0,0),this.draw(this.ctx),this.camera.render(this,t),this.previousScene&&this._renderScene(this.previousScene,t),this.activeScene&&this._renderScene(this.activeScene,t),this.hasChildren&&this.render_children(this,t)}},Studio.Stage.prototype._renderScene=function(t,i){t.active&&t.render(this,i,this.interpolate)},Studio.fixedTimeStep=function(t){this.fixedStep(t),this.step(t),this._timebased_updates(t),this.render(this._lag)},Studio.simple=function(t){this.update(this.interpolate),this._timebased_updates(t),this.render(1)},Studio.Stage.prototype.timeStep=Studio.fixedTimeStep,Studio.Stage.prototype.fixedStep=function(){for(;this._d>=this.dur;)this._d-=this.dur,this.update(this.interpolate);this._d<1&&(this._d=1.5)},Studio.Stage.prototype.step=function(t){this._d+=t,this._lag=this._d/this.dur,this._lag>1&&(this._lag=1),this._lag<0&&(this._lag=0)},Studio.Stage.prototype.engine=Studio.Stage.prototype.CANVAS,Studio.Stage.prototype.enableKeyboardInput=function(){if(this.keys)return void console.warn("Keyboard events are already enabled.");var t=this;this.keys={};var i=function(i){i.preventDefault(),t.keys[i.keyCode]=1},e=function(i){i.preventDefault(),t.keys[i.keyCode]=0};document.addEventListener("keydown",i,!1),document.addEventListener("keyup",e,!1)},Studio.Stage.prototype.enableTouchEvents=function(){var t=this,i={x:0,y:0,dx:0,dy:0,id:0};this.mouse_onDown=function(t,i){if(i.buttons&&!i._pause_buttons)for(var e=0;e!=i.buttons.length;e++)if(i.buttons[e]._touchID);else if(i.buttons[e].hitTestPoint(t.x,t.y)){if(i.buttons[e]._touchID=t.id,i.buttons[e].onTap&&i.buttons[e].onTap(t),i.buttons[e].preventBubble)return}else i.buttons[e].onTapOutside&&i.buttons[e].onTapOutside(t)},this.mouse_onMove=function(t,i){if(i.buttons&&!i._pause_buttons)for(var e=0;e!=i.buttons.length;e++)i.buttons[e].hitTestPoint(t.x,t.y)?(i.buttons[e].draggable&&t.id&&i.buttons[e]._touchID==t.id&&(i.buttons[e]._activeDrag?i.buttons[e].onDrag&&i.buttons[e].onDrag(t):(i.buttons[e].onDragStart&&i.buttons[e].onDragStart(t),i.buttons[e]._activeDrag=!0)),i.buttons[e].onHoverStart&&!i.buttons[e].hovering?i.buttons[e].onHoverStart(t):i.buttons[e].onHover&&i.buttons[e].onHover(t),i.buttons[e].hovering=!0):i.buttons[e].hovering&&(i.buttons[e].hovering=!1,i.buttons[e].onHoverEnd&&i.buttons[e].onHoverEnd()),i.buttons[e].draggable&&i.buttons[e]._activeDrag&&i.buttons[e]._touchID==t.id&&(i.relativeX=t.dx,i.relativeY=t.dy,i.buttons[e].angle&&(i.buttons[e].orbits||i.buttons[e].inheritRotation)&&(i.relativeX=t.dx*Math.cos(-i.buttons[e].angle)-t.dy*Math.sin(-i.buttons[e].angle),i.relativeY=t.dx*Math.sin(-i.buttons[e].angle)+t.dy*Math.cos(-i.buttons[e].angle),t.dx=i.relativeX,t.dy=i.relativeY),i.buttons[e].onDrag&&i.buttons[e].onDrag(t)),i.buttons[e].onTouchMove&&i.buttons[e].onTouchMove(t)},this.mouse_onUp=function(t,i){if(i.buttons)for(var e=0;e!=i.buttons.length;e++)i.buttons[e]._touchID==t.id&&(i.buttons[e]._activeDrag&&i.buttons[e].onDragEnd&&i.buttons[e].onDragEnd(t),i.buttons[e].hitTestPoint(t.x,t.y)?i.buttons[e].onRelease&&i.buttons[e].onRelease(t):i.buttons[e].onReleaseOutside&&i.buttons[e].onReleaseOutside(t),i.buttons[e]._activeDrag=!1,i.buttons[e]._touchID=0)};var e={clientX:0,clientY:0},s=function(i){e.clientX=(i.clientX-t.canvas.getBoundingClientRect().left)/t._scaleRatio,e.clientY=(i.clientY-t.canvas.getBoundingClientRect().top)/t._scaleRatio},h=function(h){s(h),i.id=1,i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,i.dx=i.dy=0,t.mouse_onDown(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onDown(i,t.activeScene)},o=function(h){s(h),i.dx=i.x-(e.clientX+t.camera.x),i.dy=i.y-(e.clientY+t.camera.y),i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,t.mouse_onMove(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onMove(i,t.activeScene)},n=function(e){t.mouse_onUp(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onUp(i,t.activeScene),i.id=0};this._mouseWindow?(document.addEventListener("mousedown",h,!1),document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",n,!1),document.addEventListener("mouseout",n,!1)):(this.canvas.addEventListener("mousedown",h,!1),this.canvas.addEventListener("mousemove",o,!1),this.canvas.addEventListener("mouseup",n,!1),this.canvas.addEventListener("mouseout",n,!1));var r={},a=0,d=[],u={},c=0,l=function(i){i.preventDefault(),c=i.targetTouches.length;for(var h=0;h!=c;h++)a=i.targetTouches[h].identifier,s(i.targetTouches[h]),r[a]={},r[a].id=a,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,r[a].dx=0,r[a].dy=0,t.mouse_onDown(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onDown(r[a],t.activeScene)},p=function(i){i.preventDefault(),c=i.targetTouches.length;for(var h=0;h!=c;h++)a=i.targetTouches[h].identifier,s(i.targetTouches[h]),r[a].dx=r[a].x-e.clientX,r[a].dy=r[a].y-e.clientY,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,t.mouse_onMove(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onMove(r[a],t.activeScene)},_=function(i){i.preventDefault(),c=i.changedTouches.length;for(var e=0;e!=c;e++)a=i.changedTouches[e].identifier,t.mouse_onUp(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onUp(r[a],t.activeScene),delete r[a]};window.ejecta?(document.addEventListener("touchstart",l,!1),document.addEventListener("touchmove",p,!1),document.addEventListener("touchend",_,!1),document.addEventListener("touchcancel",_,!1)):(this.canvas.addEventListener("touchstart",l,!1),this.canvas.addEventListener("touchmove",p,!1),this.canvas.addEventListener("touchend",_,!1),this.canvas.addEventListener("touchcancel",_,!1),this.canvas.setAttribute("tabindex","0"),this.canvas.focus())},Studio.Point=function(t,i){return this.x=t||0,this.y=i||0,this.temp=0,this},Studio.Point.prototype={constructor:Studio.Point,translate:function(t,i){this.x+=t,this.y+=i},scale:function(t,i){this.x*=t,this.y*=i},rotate:function(t,i){this.temp=this.x*i-this.y*t,this.y=this.x*t+this.y*i,this.x=this.temp},set:function(t,i){this.x=t,this.y=i}},Studio.Box=function(t,i,e,s){return this.TL=new Studio.Point(t,i),this.TR=new Studio.Point(t+e,i),this.BR=new Studio.Point(t,i+s),this.BL=new Studio.Point(t+e,i+s),this.left=0,this.right=0,this.top=0,this.bottom=0,this.sin=0,this.cos=0,this},Studio.Box.prototype={constructor:Studio.Box,set:function(t,i,e,s){this.TL.set(t,i),this.TR.set(t+e,i),this.BL.set(t,i+s),this.BR.set(t+e,i)},get_bounds:function(t){t._world.rotation?t.skews?this.get_rotated_bounds_w_skew(t):this.get_rotated_bounds(t):this.get_straight_bounds(t)},get_straight_bounds:function(t){this.TL.set(t._dx-t._world.width*t.anchorX,t._dy-t._world.height*t.anchorY),this.TR.set(this.TL.x+t._world.width,this.TL.y),this.BR.set(this.TR.x,this.TR.y+t._world.height),this.BL.set(this.TL.x,this.BR.y)},_shift:function(t,i){this.TL.translate(t,i),this.TR.translate(t,i),this.BR.translate(t,i),this.BL.translate(t,i)},_scale:function(t,i){this.TL.scale(t,i),this.TR.scale(t,i),this.BR.scale(t,i),this.BL.scale(t,i)},_set_orbit_xy:function(t,i){this.TL.x=this.left*i-this.top*t,this.TL.y=this.left*t+this.top*i,this.TR.x=this.right*i-this.top*t,this.TR.y=this.right*t+this.top*i,this.BR.x=this.right*i-this.bottom*t,this.BR.y=this.right*t+this.bottom*i,this.BL.x=this.left*i-this.bottom*t,this.BL.y=this.left*t+this.bottom*i},_set_bounds:function(t,i,e,s){this.left=-t,this.right=this.left+e,this.top=-i,this.bottom=this.top+s},get_rotated_bounds_w_skew:function(t){this.sin=Math.sin(t._dAngle),this.cos=Math.cos(t._dAngle),this._set_bounds(t.width*t.anchorX,t.height*t.anchorY,t.width,t.height),this._set_orbit_xy(this.sin,this.cos),this._scale(t._world.scaleX,t._world.scaleY),this._shift(t._dx,t._dy)},get_rotated_bounds:function(t){this.sin=Math.sin(t._dAngle),this.cos=Math.cos(t._dAngle),this._set_bounds(t._world.width*t.anchorX,t._world.height*t.anchorY,t._world.width,t._world.height),this._set_orbit_xy(this.sin,this.cos),this._shift(t._dx,t._dy)}},Studio.RECT_BOX=new Studio.Box(10,0,0,0),Studio.Color=function(t,i,e,s){return this.r=t/255||0,this.g=i/255||0,this.b=e/255||0,this.a=s||1,this.style="rgba(255,255,255,1)",this._build_style(),this},Studio.Color.prototype={constructor:Studio.Color,set:function(t,i,e,s){return this.r=t/255,this.g=i/255,this.b=e/255,this.a=s,this._build_style(),this},red:function(t){return this.r=t,this},green:function(t){return this.g=t,this},blue:function(t){return this.b=t,this},alpha:function(t){return this.a=t,this},build:function(){return this._build_style(),this},setFromHex:function(t){if(t)return 4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff"),7===t.length&&(t+="ff"),this.set("0x"+t[1]+t[2]|0,"0x"+t[3]+t[4]|0,"0x"+t[5]+t[6]|0,("0x"+t[7]+t[8]|0)/255),this},_build_style:function(){this.style="rgba("+parseInt(255*this.r)+","+parseInt(255*this.g)+","+parseInt(255*this.b)+","+this.a+")"},dirty:!1},Studio.RED=new Studio.Color(204,0,17,1),Studio.ORANGE=new Studio.Color(255,150,0),Studio.YELLOW=new Studio.Color(255,221,34,1),Studio.GREEN=new Studio.Color(0,200,0,1),Studio.BLUE=new Studio.Color(51,170,255,1),Studio.PURPLE=new Studio.Color(128,0,255,1),Studio.WHITE=new Studio.Color(255,255,255,1),Studio.BLACK=new Studio.Color(0,0,0,1),Studio.TRANSPARENT=Studio.TRANS=new Studio.Color(0,0,0,0),Studio.DisplayProperty=function(){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.angle=0,this.alpha=1,this.speed=1},Studio.DisplayProperty.prototype={constructor:Studio.DisplayProperty,apply:Studio.apply};var LinkedList=function(){this.first=null,this.last=null,this.length=0};LinkedList.prototype={add:function(t){return++this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},addItems:function(t){for(var i=0;i!==arguments.length;i++)this.add(arguments[i])},insert:function(t,i){this.length++,t.prev=i,i!==this.last?i.next=t:(this.last=t,t.next=this.first)},init:function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.length=0},remove:function(t){if(1===this.length)return this.init(),t.next=null,void(t.prev=null);this.first===t?this.first=this.first.next:this.last===t&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=null,t.prev=null,null===this.first&&(this.last=null),this.length--},update:function(t,i){for(var e=this.first;e;)this.next=e.next,e.update(t,i),e=e.next||this.next},render:function(t,i){for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},action:function(t){for(var i=this.first;i;)this.next=i.next,i[t](),i=i.next||this.next},removeAll:function(t){for(var i=this.first;i;)this.next=i.next,this.pdispose&&this.pdispose(),this.remove(i),i=i.next||this.next;i=null,t&&this.add(t)},toString:function(){for(var t=this.first,i="linked list : [";t;)i+=t,t=t.next;i+="];"},constructor:LinkedList},Studio.Plugin=function(t){this.init=null,this.options={},this.action=null,this.apply(t)},Studio.Plugin.constructor=Studio.Plugin,Studio.Plugin.prototype.apply=Studio.apply,Studio.Plugin.prototype._options=function(t){for(var i in t)this.options[i]=t[i]},Studio.Image=function t(i,e){return this.path=i+"_"+parseInt(1e5*Math.random()).toString(16),this.bitmap=null,this.width=1,this.height=1,this.slice={Full:{x:0,y:0,width:1,height:1}},this.sliceGL={},e&&this.addSlice(e),i&&this.loadImage(i),this},Studio.inherit(Studio.Image,Studio.Messenger),Studio.Image.prototype.ready=!1,Studio.Image.prototype.height=1,Studio.Image.prototype.width=1,Studio.Image.prototype._onImageLoad=function t(i){return Studio.progress=Studio.queue/Studio.assets.length,Studio._loadedAsset(),this._setWidthHeights(i),i},Studio.Image.prototype._setWidthHeights=function(t){this.slice.Full.height=t.height,this.slice.Full.width=t.width,this.width=t.width,this.height=t.height,this.addSlice(this.slice),this.ready=!0,this.sendMessage("ready",this.ready)},Studio.Image.prototype.loadImage=function t(i){var e=this;if(Studio.assets[i])return console.warn("Already loaded : ",i,Studio.assets[i]),this.bitmap=Studio.assets[i],Studio.assets.width?(this.ready=!0,this.sendMessage("ready",this.ready)):Studio.assets[i].addEventListener("load",function(t){e._setWidthHeights(t.target)}),this;Studio.assets[i]=new Image,Studio._addingAsset(),Studio.assets[i].addEventListener("load",function(t){e._onImageLoad(t.target)}),Studio.assets[i].src=i,this.bitmap=Studio.assets[i]},Studio.Image.prototype.buildSliceForGL=function t(i){var e=i.x/this.width,s=i.y/this.height;return{x:e,y:s,width:i.width/this.width+e,height:i.height/this.height+s}},Studio.Image.prototype.addSlice=function t(i){for(var e in i)this.slice[e]=i[e],this.sliceGL[e]=this.buildSliceForGL(i[e])},Studio.Image.prototype._rebuildGLSlices=function(){for(var t in this.slice)this.sliceGL[t]=this.buildSliceForGL(this.slice[t])},Studio.Cache=function(t,i,e){this.resolution=e||1,this.path="cache_"+parseInt(1e5*Math.random()).toString(16),this.bitmap=document.createElement("canvas"),this.bitmap.width=t*this.resolution||512,this.bitmap.height=i*this.resolution||512,this.width=t,this.height=i,this.ready=!1,this.ctx=this.bitmap.getContext("2d"),this.ctx.scale(e,e),this.slice.Full={x:0,y:0,width:this.bitmap.width,height:this.bitmap.height},this.sliceGL.Full={x:0,y:0,width:1,height:1},Studio.DEBUG&&document.body.appendChild(this.bitmap)},Studio.inherit(Studio.Cache,Studio.Image),Studio.Cache.prototype.applyEffect=function(t){t.action(this)},Studio.Ease={},Studio.Ease.linear=function(t){return t},Studio.Ease.snap=function(t){return t+.5|0},Studio.Ease.chillInOut=function(t){var i=.75;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},Studio.Ease.backOut=function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},Studio.Ease.bounceOut=function(t){return t<.363636?7.5625*t*t:t<.727272?7.5625*(t-=.545454)*t+.75:t<.90909?7.5625*(t-=.818181)*t+.9375:7.5625*(t-=.959595)*t+.984375},Studio.Ease.elasticOut=function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/6.283,e*Math.pow(2,-10*t)*Math.sin(6.283*(t-i)/s)+1)},Studio.Ease.linearRandom=function(t){return Math.random()*t},Studio.Ease.random=function(){return Math.random()},Studio.Ease.shake=function(){return Math.random()-.5},Studio.Ease.quadIn=function(t){return t*t},Studio.Ease.quadOut=function(t){return t*(2-t)},Studio.Ease.quadInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Studio.DisplayObject=function(t){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.anchorX=.5,this.anchorY=.5,this.rotation=0,this.skews=0,this.alpha=1,this.visible=1,this.speed=1,this.active=1,this.orbits=!0,this.orbit=0,this.inheritRotation=!0,this.inheritScale=!0,this.orbitSpeed=1,t&&this.apply(t),this._boundingBox=new Studio.Box,this._parent=null,this._hasChildren=0,this.__x=this._world.x,this.__y=this._world.y,this._dx=this._world.x,this._dy=this._world.y},Studio.difference={},Studio.DisplayObject.prototype={constructor:Studio.DisplayObject,_world:new Studio.DisplayProperty,blendmode:"source-over",apply:Studio.apply,__update_XY:!0,__update_SCALE:!0,__update_DIMENSIONS:!0,__update_SPEED:!0,__update_ALPHA:!0,__update_ROTATION:!0,addChild:function(t){return this.hasOwnProperty("children")||(this.children=[]),this.hasOwnProperty("_world")||(this._world=new Studio.DisplayProperty,this._initWorld()),t.hasOwnProperty("_world")||(t._world=new Studio.DisplayProperty),t._parent=this._world,t._parent_box=this._boundingBox,this.children[this._hasChildren]=t,this._hasChildren++,t.force_update(),t._dset(),t._hasChildren&&t.force_update_children(),this},removeChildAtIndex:function(t){for(var i=this.children.length-1,e=t;e<i;e++)this.children[e]=this.children[e+1];this.children.length=i,this._hasChildren=i},removeChild:function(t){for(var i=this.children.length-1,e=0;e<=i;e++)if(this.children[e]==t)return void this.removeChildAtIndex(e);console.log("child not found.")},_initWorld:function(){this._world.x=this.x,this._world.y=this.y,this._world.y=this.y,this._world.z=this.z,this._world.height=this.height,this._world.width=this.width,this._world.scaleX=this.scaleX,this._world.scaleY=this.scaleY,this._world.rotation=this.rotation,this._world.angle=this.angle,this._world.alpha=this.alpha,this._world.speed=this.speed},addChildren:function(){for(var t=0;t!==arguments.length;t++)this.addChild(arguments[t]);return this},getChildByName:function(t){for(var i=0;i!==this._hasChildren;i++)if(this.children[i].name===t)return this.children[i];return null},_destroy:function(){for(var t in this)this.hasOwnProperty(t)||delete this[t]},_order:function(){this.children.sort(Studio.z_index)},draw:function(){},snapPixels:function(){this._dx=this._dx+0|0,this._dy=this._dy+0|0,this._world.height=this._world.height+0|0,this._world.width=this._world.width+0|0},hitTestPoint:function(t,i){return this._relativeX=t-this._world.x,this._relativeY=i-this._world.y,this.anchoredX=this.anchorX*this._world.width,this.anchoredY=this.anchorY*this._world.height,!(this._relativeX<-this.anchoredX&&this._relativeY<-this.anchoredY)&&(!(this._relativeX>this.width&&this._relativeY>this.height)&&(this._world.rotation&&(t=this._relativeX*Math.cos(-this.angle)-this._relativeY*Math.sin(-this.angle),i=this._relativeX*Math.sin(-this.angle)+this._relativeY*Math.cos(-this.angle),this._relativeX=t,this._relativeY=i),this._relativeX>-this.anchoredX&&this._relativeY>-this.anchoredY&&this._relativeX<this._world.width-this.anchoredX&&this._relativeY<this._world.height-this.anchoredY))},hitTestRect:function(t){return Studio.difference.height=this._world.height+t._world.height,Studio.difference.width=this._world.width+t._world.width,Studio.difference.x=this._world.x-this._world.width*this.anchorX-t._world.x-t._world.width*t.anchorX,Studio.difference.y=this._world.y-this._world.height*this.anchorY-t._world.y-t._world.height*t.anchorY,Studio.difference.x<0&&Studio.difference.y<=0&&Studio.difference.height+Studio.difference.y>=0&&Studio.difference.width+Studio.difference.x>=0},vertex_children:function(t,i,e){if(this._hasChildren)for(var s=0;s<this._hasChildren;s++){if(!this.children[s].buildElement)return void console.log("no build",this.children[s]);this.children[s].buildElement(t,i,e),this.children[s]&&this.children[s].vertex_children(t,i,e)}},buildElement:function(t,i,e){},render_children:function(t,i,e){if(this._hasChildren)for(var s=0;s<this._hasChildren;s++)this.children[s].render(t,i,e)},render:function(t,i,e){this._visible&&(e?this._delta(i):this._dset(),t.snap&&this.snapPixels(),this.draw(t.ctx),this.render_children(t,i,e)),this.onExitFrame&&this.onExitFrame()},update_visibility:function(){this._world.alpha=this.alpha*this._parent.alpha,this._visible=this._world.alpha*this.visible},setAlpha:function(t){this._world.alpha!==t.globalAlpha&&this._visible&&(t.globalAlpha=this._world.alpha),this.blendmode!==t.globalCompositeOperation&&this._visible&&(t.globalCompositeOperation=this.blendmode)},update_scale:function(){this.inheritScale?(this._world.scaleX=this._parent.scaleX*this.scaleX,this._world.scaleY=this._parent.scaleY*this.scaleY):(this._world.scaleX=this.scaleX,this._world.scaleY=this.scaleY)},update_dimensions:function(){this._world.width=this.width*this._world.scaleX,this._world.height=this.height*this._world.scaleY},update_angle:function(){this.angle=this._world.rotation/180*3.14159265},update_speed:function(){this._world.speed=this.speed*this._parent.speed},orbitXY:function(){var t=this.x*this._world.scaleX,i=this.y*this._world.scaleY,e=Math.sin((this._parent.angle+this.orbit)*this.orbitSpeed),s=Math.cos((this._parent.angle+this.orbit)*this.orbitSpeed);this._orbitX=t*s-i*e,this._orbitY=t*e+i*s},update_rotation:function(){this.inheritRotation?this._world.rotation=this._parent.rotation+this.rotation:this._world.rotation=this.rotation,this._world.rotation?this.update_angle():this.angle=0},update_orbit_xy:function(){this.orbitXY(),this._world.x=this._orbitX+this._parent.x,this._world.y=this._orbitY+this._parent.y},update_xy:function(){this.orbits&&this._parent.angle?this.update_orbit_xy():(this._world.x=this.x*this._parent.scaleX+this._parent.x,this._world.y=this.y*this._parent.scaleY+this._parent.y)},snapshot:function(){this.__x=this._world.x,this.__y=this._world.y,this.__update_DIMENSIONS&&(this.__width=this._world.width,this.__height=this._world.height),this._world.rotation&&(this._world.angle=this.angle)},__deltaXY:function(t){this.__update_XY&&(this._dx=this.__delta(this.__x,this._world.x,t),this._dy=this.__delta(this.__y,this._world.y,t))},__deltaHW:function(t){this.__update_DIMENSIONS&&(this._dwidth=this.__delta(this.__width,this._world.width,t),this._dheight=this.__delta(this.__height,this._world.height,t))},__deltaRotation:function(t){this._world.rotation&&(this._dAngle=this.__delta(this._world.angle,this.angle,t))},__delta:function(t,i,e){return t+(i-t)*e},_delta:function(t){this.__deltaXY(t),this.__deltaHW(t),this.__deltaRotation(t)},__dsetXY:function(){this.__update_XY&&(this._dx=this._world.x,this._dy=this._world.y)},__dsetHW:function(){this._dwidth=this._world.width,this._dheight=this._world.height},__dsetRotation:function(){this._world.rotation&&(this._dAngle=this._world.angle+this.angle)},_dset:function(){this.__dsetXY(),this.__dsetHW(),this.__dsetRotation()},_snapback:function(){this.force_update()},force_update:function(){this.update_visibility(),this.update_scale(),this.update_speed(),this.update_dimensions(),this.update_rotation(),this.update_xy(),this.snapshot()},force_update_children:function(t){for(var i=0;i<this._hasChildren;i++)this.children[i].force_update();for(var i=0;i<this._hasChildren;i++)this.children[i]._dset()},_update:function(t){this.__update_ALPHA&&this.update_visibility(),this._visible&&(this.__update_SCALE&&this.update_scale(),this.__update_SPEED&&this.update_speed(),this.__update_DIMENSIONS&&this.update_dimensions(),this.__update_ROTATION&&this.update_rotation(),this.__update_XY&&this.update_xy(),this.update_children(t))},update_children:function(t){if(this._hasChildren)for(var i=0;i<this._hasChildren;i++)this.children[i].update(t)},_logic:function(){this.logic&&this.logic(),this.onEnterFrame&&this.onEnterFrame()},setAnchor:function(t,i){this.anchorX=t,this.anchorY=i||t},update:function(t){t&&this.snapshot(),this._logic(),this._update(t)}},Studio.DisplayList=function(t){this.cache=null,this.ctx=null,this.cached=!1,this.first=null,this.last=null,this.length=0,this.marked=[],this.autoCache=!0,t&&this.apply(t)},Studio.inherit(Studio.DisplayList,Studio.DisplayObject),Studio.DisplayList.prototype.cacheAsBitmap=function(t){this.cache=document.createElement("canvas"),this.cache.height=this.height*t.resolution,this.cache.width=this.width*t.resolution,this.ctx=this.cache.getContext("2d"),this.ctx.scale(t.resolution,t.resolution)},Studio.DisplayList.prototype.updateCache=function(){this.cached=!1,this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1),this.cached=!0},Studio.DisplayList.prototype._cacheIt=function(){this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1)},Studio.DisplayList.prototype.updateElement=function(t){t.render(this)},Studio.DisplayList.prototype.clearCachedElement=function(t){this.ctx.clearRect(t._world.x-t.width/2,t._world.y-t.height/2,t.width,t.height)},Studio.DisplayList.prototype.markedForRemoval=function(t){this.marked[this.marked.length]=t},Studio.DisplayList.prototype.removeMarked=function(){for(var t=0;t!==this.marked.length;t++)this.marked[t]&&this.clearCachedElement(this.marked[t]),this.marked[t]=null;this.marked.lengh=0},Studio.DisplayList.prototype.deactivateCache=function(){this.cached=!1},Studio.DisplayList.prototype.update=function(){this.marked.length&&this.removeMarked(),this.update_visibility(),this.update_scale(),this.update_dimensions(),this.update_xy(),this.update_speed();for(var t=this.first;t;)this.next=t.next,t.update(),t=t.next||this.next;!this.cached&&this.autoCache&&this.ctx&&this.updateCache()},Studio.DisplayList.prototype.render=function(t,i){if(this.cached)this._world.alpha!==t.ctx.globalAlpha&&(t.ctx.globalAlpha=this._world.alpha),this.draw(t.ctx);else for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},Studio.DisplayList.prototype.add=function(t){return t._parent=this,++this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},Studio.DisplayList.prototype.draw=function(t){t.drawImage(this.cache,0,0,this.cache.width,this.cache.height,this._world.x,this._world.y,this._world.width,this._world.height)},Studio.addTo(Studio.DisplayList.prototype,LinkedList.prototype),Studio.Rect=function(t){this.color=new Studio.Color(255,255,255,1),this.dirty=0,t&&this.apply(t)},Studio.inherit(Studio.Rect,Studio.DisplayObject),Studio.DefaultImage=new Studio.Cache(1,1,1),Studio.DefaultImage.ctx.fillStyle="#fff",Studio.DefaultImage.ctx.fillRect(0,0,1,1),Studio.BufferGL=function(t,i,e){this.bytes=36,this.size=i||e._maxCount,this.data=new Float32Array(this.size*this.bytes),this.count=0,this.texture=t||Studio.DefaultImage},Studio.BufferGL.prototype.constructor=Studio.BufferGL,Studio.BufferGL.prototype.draw=function(t){this.count&&(!this._texture&&this.texture&&this.setTexture(t,1),this.texture&&(t.bindTexture(t.TEXTURE_2D,this._texture),this.texture.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.texture.bitmap),this.texture.dirty=!1)),t.bufferData(t.ARRAY_BUFFER,this.data,t.DYNAMIC_DRAW),t.drawElements(t.TRIANGLES,this.count/6,t.UNSIGNED_SHORT,0),this.count=0)},Studio.BufferGL.prototype.prepTexture=function t(i){this._texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),this.buffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.vertexAttribPointer(i.positionLocation,3,i.FLOAT,i.FALSE,this.bytes,0),i.vertexAttribPointer(i.colorLocation,4,i.FLOAT,i.FALSE,this.bytes,12),i.vertexAttribPointer(i.textureLocation,2,i.FLOAT,i.FALSE,this.bytes,28),i.bufferData(i.ARRAY_BUFFER,this.data,i.DYNAMIC_DRAW)},Studio.BufferGL.prototype.setTexture=function t(i,e){this._texture||this.prepTexture(i),this.texture&&(this.texture.updateGlTexture&&this.texture.updateGlTexture(i),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this.texture.bitmap),e&&i.generateMipmap(i.TEXTURE_2D))},Studio.Rect.prototype.addXYZ=function(t,i,e){t.data[t.count++]=i.x,t.data[t.count++]=i.y,t.data[t.count++]=-1e-6*e.draws},Studio.Rect.prototype.addRGBA=function(t,i){t.data[t.count++]=i.r,t.data[t.count++]=i.g,t.data[t.count++]=i.b,t.data[t.count++]=i.a*this._world.alpha},Studio.Rect.prototype.addTX=function(t,i,e){t.data[t.count++]=i,t.data[t.count++]=e},Studio.Rect.prototype.addVert=function(t,i,e,s,h){this.addXYZ(t,i,h),this.addRGBA(t,this.color),this.addTX(t,e,s)},Studio.Rect.prototype.verts=function(t,i){var e=i.rect_buffer;this.addVert(e,t.TL,0,0,i),this.addVert(e,t.TR,0,0,i),this.addVert(e,t.BL,0,0,i),this.addVert(e,t.BR,0,0,i)},Studio.Rect.prototype.buildElement=function(t,i,e){t.draws++,e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.verts(this._boundingBox,t)},Studio.Rect.prototype.buildTriangles=function(t,i){this._delta(i),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._world.z,this.bounds.left,this.bounds.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.bounds.right,this.bounds.top),
this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.bounds.left,this.bounds.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.bounds.right,this.bounds.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.bounds.left,this.bounds.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._world.z,this.bounds.right,this.bounds.bottom)},Studio.Rect.prototype.setStyle=function(t){this.color.dirty&&this.color._build_style(),this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Rect.prototype.prepAngled=function(t){(this._dx||this._dy)&&t.translate(this._dx,this._dy),this.skews||t.rotate(this._dAngle||0),1===this._world.scaleX&&1===this._world.scaleY||t.scale(this._world.scaleX,this._world.scaleY),this.skews&&t.rotate(this._dAngle||0)},Studio.Rect.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.fillRect(-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height),t.restore()},Studio.Rect.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.strokeStyle="#fff",this.angle?this.drawAngled(t):t.fillRect(this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)},Studio.Clip=function(t){t&&this.apply(t)},Studio.inherit(Studio.Clip,Studio.Rect),Studio.Clip.prototype.draw=function(t){t.save(),t.beginPath(),this.angle?this.drawAngled(t):t.rect(this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),t.clip()},Studio.Clip.prototype.drawAngled=function(t){this.prepAngled(t),t.rect(-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height)},Studio.CircleClip=function(t){t&&this.apply(t)},Studio.inherit(Studio.CircleClip,Studio.Rect),Studio.CircleClip.prototype.draw=function(t){t.save(),t.beginPath(),t.arc(this._dx,this._dy,this._world.width/2,0,2*Math.PI),t.clip()},Studio.Restore=function(){},Studio.Restore.prototype=new Studio.Rect,Studio.Restore.prototype.constructor=Studio.Restore,Studio.Restore.prototype.draw=function(t){t.restore()},Studio.Circle=function(t){this.color=new Studio.Color(1,0,0,0),t&&this.apply(t),this.height=this.width},Studio.inherit(Studio.Circle,Studio.Rect),Studio.Circle.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.beginPath(),t.arc(this._world.x,this._world.y,this._world.width/2,0,2*Math.PI),t.fill()},Studio.Sprite=function(t){this.image=null,this.slice="Full",this.color=Studio.WHITE,t&&this.apply(t)},Studio.inherit(Studio.Sprite,Studio.Rect),Studio.Sprite.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,-this.width*this.anchorX,-this.height*this.anchorY,this.width,this.height),t.restore()},Studio.Sprite.prototype.verts=function(t,i,e,s){this.addVert(i,t.TL,e.x,e.y,s),this.addVert(i,t.TR,e.width,e.y,s),this.addVert(i,t.BL,e.x,e.height,s),this.addVert(i,t.BR,e.width,e.height,s),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&(this._boundingBox.TL.x+=this.border.width,this._boundingBox.TR.x+=this.border.width,this._boundingBox.BR.x+=this.border.width,this._boundingBox.BL.x+=this.border.width),this._dx+this._world.width>this.border.width&&(this._boundingBox.TL.x-=this.border.width,this._boundingBox.TR.x-=this.border.width,this._boundingBox.BR.x-=this.border.width,this._boundingBox.BL.x-=this.border.width),this.addVert(i,t.TL,e.x,e.y,s),this.addVert(i,t.TR,e.width,e.y,s),this.addVert(i,t.BL,e.x,e.height,s),this.addVert(i,t.BR,e.width,e.height,s))},Studio.Sprite.prototype.buildElement=function(t,i,e){t.buffers[this.image.path]||(t.buffers[this.image.path]=new Studio.BufferGL(this.image,0,t)),t.draws++,e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.verts(this._boundingBox,t.buffers[this.image.path],this.image.sliceGL[this.slice],t)},Studio.Sprite.prototype.draw=function t(i){this.image&&this.image.ready&&(this.setAlpha(i),this.angle?this.drawAngled(i):(i.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&i.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this.border.width+this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this._dx+this._world.width>this.border.width&&i.drawImage(this.image.bitmap,this.image.slice[this.slice].x,this.image.slice[this.slice].y,this.image.slice[this.slice].width,this.image.slice[this.slice].height,this._dx-this._dwidth*this.anchorX-this.border.width,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight))))},Studio.SpriteAnimation=function(t){this.image=null,this.loop=[[0,0]],this.fps=12,this.frame=0,this.sliceX=0,this.sliceY=0,this.offsetY=0,this.offsetX=0,this.repeat=!0,this.startTime=0,t&&this.apply(t),this.setStartingFrame(this.frame)},Studio.inherit(Studio.SpriteAnimation,Studio.Sprite),Studio.SpriteAnimation.prototype.setStartingFrame=function(t){this.frame=t,this.startTime=Studio.time,this.myTime=this.startTime+t*(1e3/this.fps)},Studio.SpriteAnimation.prototype.draw=function(t){this.image&&this.image.ready&&(this.setAlpha(t),t.drawImage(this.image.bitmap,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorX,this._dwidth,this._dheight),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&t.drawImage(this.image.bitmap,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this.border.width+this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight),this._dx+this._world.width>this.border.width&&t.drawImage(this.image.bitmap,this.rect.width*this.sliceX,this.rect.height*this.sliceY,this.rect.width,this.rect.height,this._dx-this._dwidth*this.anchorX-this.border.width,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)),this.loop.length&&this.updateFrame())},Studio.SpriteAnimation.prototype.setSlice=function(){this.sliceX=this.loop[this.frame][0]+this.offsetX,this.sliceY=this.loop[this.frame][1]+this.offsetY},Studio.SpriteAnimation.prototype.updateFrame=function(){this.myTime+=Studio.delta,this.frame=(this.myTime-this.startTime)*this._world.speed/(1e3/this.fps)|0,this.frame>=this.loop.length&&(this.startTime=this.myTime,this.frame=0,this.onLoopComplete&&this.onLoopComplete.call(this)),this.setSlice()},Studio.SpriteAnimation.prototype.verts=function(t,i,e,s){var h=this.rect.width/this.image.width,o=this.rect.height/this.image.height,n=this.sliceX*h,r=this.sliceY*o;this.addVert(i,t.TL,n,r,s),this.addVert(i,t.TR,n+h,r,s),this.addVert(i,t.BL,n,r+o,s),this.addVert(i,t.BR,n+h,r+o,s),this.borderlap&&this.border&&(this._dx-this._dwidth*this.anchorX<this.border.x&&(this._boundingBox.TL.x+=this.border.width,this._boundingBox.TR.x+=this.border.width,this._boundingBox.BR.x+=this.border.width,this._boundingBox.BL.x+=this.border.width),this._dx+this._world.width>this.border.width&&(this._boundingBox.TL.x-=this.border.width,this._boundingBox.TR.x-=this.border.width,this._boundingBox.BR.x-=this.border.width,this._boundingBox.BL.x-=this.border.width),this.addVert(i,t.TL,n,r,s),this.addVert(i,t.TR,n+h,r,s),this.addVert(i,t.BL,n,r+o,s),this.addVert(i,t.BR,n+h,r+o,s)),this.loop.length&&this.updateFrame()},Studio.Camera=function(t){this.stage={width:t.width,height:t.height},this.tracking=null,this.focus={x:0,y:0},this.bound=null,this.active=!0,this.matrix=new Float32Array([1,0,0,0,1,0,0,0,1])},Studio.inherit(Studio.Camera,Studio.DisplayObject),Studio.Camera.prototype.updateRect=function(){this.left=this.bound._dx*this.scaleX+this.focus.x,this.top=this.bound._dy*this.scaleY+this.focus.y,this.right=this.bound._dwidth*this.scaleX-this.focus.x,this.bottom=this.bound._dheight*this.scaleY-this.focus.y},Studio.Camera.prototype.update_visbile_area=function(){this.tracking?(this.visibleArea.x=this.x,this.visibleArea.y=this.y):(this.visibleArea.x=this.x+stage.width/2,this.visibleArea.y=this.y+stage.height/2),this.visibleArea.width=this.stage.width/this.scaleX-10,this.visibleArea.height=this.stage.height/this.scaleY-10},Studio.Camera.prototype.update=function(t,i,e){this.tracking&&(e||this.tracking._delta(i),this.x=this.tracking._dx,this.y=this.tracking._dy),this.bound&&(this.updateRect(),this.x<this.left?this.x=this.left:this.x>this.right&&(this.x=this.right),this.y<this.top?this.y=this.top:this.y>this.bottom&&(this.y=this.bottom)),this.visibleArea&&this.update_visbile_area()},Studio.Camera.prototype.render=function(t,i,e){this.update(t,i,e),this.matrix[0]=this.scaleX,this.matrix[4]=this.scaleY,this.matrix[6]=this.focus.x-this.x*this.scaleX,this.matrix[7]=this.focus.y-this.y*this.scaleY,e||t.ctx.setTransform(this.matrix[0]*t.resolution,0,0,this.matrix[4]*t.resolution,this.matrix[6]*t.resolution,this.matrix[7]*t.resolution),e&&t.ctx.uniformMatrix3fv(t.ctx.matrixLocation,!1,this.matrix)},Studio.Camera.prototype.track=function(t){this.tracking=t,this.focus.x=stage.width/2,this.focus.y=stage.height/2},Studio.Camera.prototype.bindTo=function(t){this.bound=t},Studio.Camera.prototype.unBind=function(){this.bindTo(null)},Studio.Camera.prototype.stopTracking=function(){this.track(null),this.focus.x=0,this.focus.y=0,this.matrix[6]=this.x*this.scaleX,this.matrix[7]=this.y*this.scaleY},Studio.Scene=function(t){this.color=new Studio.Color(0,1,0,.5),this.active=!1,this.image=null,this.loader=null,this.assets=[],this.children=[],this.buttons=[],this.tweens=Object.create(null),this.tween_length=0,this.trails=!0,this.anchorX=0,this.anchorY=0,t&&this.apply(t),this.build&&this.build.call(this,this),this.init&&this.init.call(this,this)},Studio.inherit(Studio.Scene,Studio.Rect),Studio.Scene.prototype.loadAssets=function(){for(var t=0;t!==arguments.length;t++)this.assets.push(new Studio.Image(arguments[t]))},Studio.Scene.prototype.addButton=function(t){this.buttons.unshift(t)},Studio.Scene.prototype.render_children=function(t,i){for(this.i=0;this.i<this._hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].render(t,i,t.interpolate)},Studio.Scene.prototype.close=function(t){this.active=!1},Studio.Scene.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Scene.prototype.draw=function(t){return this.setAlpha(t),this.image?void t.drawImage(this.image.image,this._dx,this._dy,this.width,this.height):this.color?0===this.color.a?void t.clearRect(this._dx,this._dy,this.width,this.height):(this.color.a<1&&!this.trails&&t.clearRect(this._dx,this._dy,this.width,this.height),this.setStyle(t),void t.fillRect(this._dx,this._dy,this.width,this.height)):void 0},Studio.Stage=function(t,i){return this.webgl=!!window.WebGLRenderingContext,this.fullscreen=0,this.color=new Studio.Color(0,0,0,1),this.snap=!1,i&&this.apply(i),this.tweens=Object.create(null),this._getCanvasElement(t),this._count=0,this._maxCount=16383,this.dur=1e3/60,this._d=this.dur/2,this.resolution=window.devicePixelRatio,this.interpolate=!0,this.smoothing=!0,i&&this.apply(i),this._sizeCanvas(this.fullscreen),this.setPixelRatio(),this.webgl&&Studio.browser_info.webGL?this.engine=Studio.Stage.prototype.WEBGL:this.webgl=!1,this.allowPlugins(),this.engine.getContext.call(this),this.engine.init.call(this,this.ctx),this.engine.prep.call(this,this.ctx),Studio.stages.push(this),this.render=this.engine.render,this._init(),console.log("%cStudio3 v"+Studio.version+"%c"+this.engine.type,Studio.infoStyle,Studio.engineStyle),this.verts=0,this},Studio.inherit(Studio.Stage,Studio.Scene),Studio.Stage.prototype._getCanvasElement=function(t){if(t){if("build"===t.toLowerCase())return this.bitmap=document.createElement("canvas"),void document.body.appendChild(this.bitmap);this.bitmap=document.getElementById(t)}else{var i=document.body.getElementsByTagName("canvas");i[0]?this.bitmap=i[0]:(this.bitmap=document.createElement("canvas"),document.body.appendChild(this.bitmap))}},Studio.Stage.prototype.setColor=function(t,i,e,s){this.color.set(t,i,e,s),this.ctx.clearColor&&this.ctx.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)},Studio.Stage.prototype._init=function(){return this.ready=!1,this.autoPause=!1,this._watching=!1,this.children=[],this.buttons=[],this.activeScene=null,this.previousScene=null,this.camera=new Studio.Camera(this),this.nextID=0,this.anchorX=0,this.anchorY=0,this.active=!0,this._pause_buttons=!1,Studio.stage=this,this},Studio.Scene.prototype.allowPlugins=function(){this.plugins=Object.create(null),this.plugins.input=[],this.plugins.effect=[],this._effects=0,this._inputs=0},Studio.Stage.prototype._sizeCanvas=function(t){if(this.height=this.bitmap.height||this.height,this.width=this.bitmap.width||this.width,this.bitmap.style.height=this.height+"px",this.bitmap.style.width=this.width+"px",this._scaleRatio=1,1==t&&(this.width=window.innerWidth,this.height=window.innerHeight,this.bitmap.style.height="100%",this.bitmap.style.width="100%"),t>=2){var i=window.innerWidth;this.maxwidth&&i>this.maxwidth&&(i=this.maxwidth),this.bitmap.style.width=i+"px",this.bitmap.style.height="auto",this._scaleRatio=i/this.width,3==t&&(this.bitmap.style.height=window.innerHeight+"px")}},Studio.Stage.prototype.pauseButtons=function(t){this._pause_buttons=t},Studio.Stage.prototype.setPixelRatio=function(){this.bitmap.width=this.width*this.resolution,this.bitmap.height=this.height*this.resolution},Studio.Stage.prototype.fillScreen=function(){},Studio.Stage.prototype.addInput=function(t,i){i&&t._options(i),t.init(this),this.plugins.input.push(t),this._inputs++},Studio.Stage.prototype.addEffect=function(t,i){i&&t._options(i),t.init(this),this.plugins.effect.push(t),this._effects++},Studio.Stage.prototype.checkDataAttributes=function(){},Studio.Stage.prototype.setScene=function(t){t._parent=this,this.activeScene&&2===Studio.progress&&this.activeScene.onDeactivate&&this.activeScene.onDeactivate(this),this.previousScene=this.activeScene,this.activeScene=t,this.activeScene.active=!0,t.onActivate&&t.onActivate(this)},Studio.Stage.prototype.clearScene=function(){this.activeScene&&(this.previousScene=this.activeScene,this.activeScene=null,this.previousScene.onDeactivate?this.previousScene.onDeactivate(this):this.previousScene.active=!1)},Studio.Stage.prototype.watch=function(t){this._watching=t},Studio.Stage.prototype.update_visibility=function(){this._alpha=this.alpha},Studio.Stage.prototype._timebased_updates=function(t){this.activeScene&&this.activeScene.update_tweens(t),this.update_tweens(t)},Studio.Stage.prototype.update=function(t,i){this.onEnterFrame&&this.onEnterFrame(),this._width=this.width,this._height=this.height,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._speed=this.camera.speed,this.update_visibility(),2===Studio.progress&&(this._inputs&&this.runInputs(i),this.updateScenes(),this.beforeDraw&&this.beforeDraw()),this._logic()},Studio.Stage.prototype._update_scene=function(t){t&&t.active&&t.update(this.interpolate)},Studio.Stage.prototype.updateScenes=function(){this._update_scene(this.activeScene),this._update_scene(this.previousScene),this._hasChildren&&this.update_children(this.interpolate)},Studio.Stage.prototype.runEffects=function(){for(this.i=0;this.i!==this._effects;this.i++)this.plugins.effect[this.i].active&&this.plugins.effect[this.i].action(this)},Studio.Stage.prototype.runInputs=function(){for(this.i=0;this.i!==this._inputs;this.i++)this.plugins.input[this.i].active&&this.plugins.input[this.i].action(this)},Studio.Stage.prototype.loading=function(t){!0===Studio.loaded&&(this.loop=this.activeloop)},Studio.Stage.prototype.activeloop=function(t){if(2===Studio.progress)return void this.timeStep(t);if(this.webgl||this.drawProgress(this.ctx,t),1===Studio.progress){if(this.onReady&&this.onReady(t),Studio.progress=2,!this.activeScene)return;this.activeScene.onActivate&&this.activeScene.onActivate(this)}},Studio.Stage.prototype.loop=Studio.Stage.prototype.loading,Studio.Scene.prototype.drawProgress=function(t){this.progressBar(t,Studio.progress),t.restore()},Studio.Scene.prototype.progressBar=function(t,i){t.fillStyle="rgba(255,255,255,.8)",t.fillRect((this.width-202)/2,(this.height-22)/2,202,22),t.fillStyle="rgba(0,0,0,1)",t.fillRect(2+(this.width-202)/2,2+(this.height-22)/2,198*i,18)},Studio.Font=function(t,i,e,s,h){this.size=i||16,this.family=t||"Arial",this.weight=e||"",this.style=s||"",this.varient=h||"",this.lineHeight=20,this.color="#fff",this.shadow=0},Studio.Font.prototype={constructor:Studio.Font,build:function(){return this.varient+" "+this.style+" "+this.weight+" "+this.size+"px "+this.family},set:Studio.apply,modify:function(t){return t?(t.varient||this.varient)+" "+(t.style||this.style)+" "+(t.weight||this.weight)+" "+(t.size||this.size)+"px "+(t.family||this.family):this.build()}},Studio.TextBox=function(t,i,e,s){return this.height=i,this.width=t,this.font=new Studio.Font,this._lastfont=this.font.build(),this.shadow=1,this.offsetY=0,this._offsetY=this.offsetY,this.shadowColor="rgba(0,0,0,0.5)",this.image=s||new Studio.Cache(t,i,e.resolution),this.image.ctx.textBaseline="top",this.text="",this._wrap_height=this.lineHeight,this.horizontal_align=Studio.LEFT,this.justify=!1,this.vertical_align=Studio.TOP,this._vertical_align=0,this.columns=1,this.gutter=20,this.live=!1,this.styles={b:{color:"#FFD000",weight:"bold"},i:{style:"italic",color:"green"},h1:{height:"bold",size:32,lineHeight:40},h2:{height:"bold",size:24,lineHeight:30}},this},Studio.inherit(Studio.TextBox,Studio.Sprite),Studio.TextBox.prototype.setFont=function(t){return this.font=t,this},Studio.TextBox.prototype.setText=function(t){return this.text=t,this},Studio.TextBox.prototype.setColor=function(t){return this},Studio.TextBox.prototype.setFont=function(t){return this.image.ctx.font=this.font=t,this},Studio.TextBox.prototype.finish=function(){this.reset(),this.wrapText(),this.image.ready=!0,this.image.dirty=!0},Studio.TextBox.prototype.reset=function(){var t=this.image.slice[this.slice];this.image.ctx.clearRect(t.x,t.y,t.width,t.height),this.image.ctx.font=this.font},Studio.TextBox.prototype.writeLine=function(t,i,e,s){var h=t.split(" "),o=0,s=s||0;this.image.ctx.font=this._lastfont;for(var n=0;n!=h.length;n++){var r=h[n];if("<"===r[0]&&">"===r[r.length-1])if("</>"==r)this._lastfont=this.font.build(),this.image.ctx.font=this._lastfont,this.image.ctx.fillStyle=this.font.color,this._offsetY=this.offsetY;else{var a=this.styles[r.slice(1,r.length-1)];a&&(this._lastfont=this.font.modify(a),this.image.ctx.font=this._lastfont,this.image.ctx.fillStyle=a.color,a.offsetY&&(this._offsetY=a.offsetY))}else{if(this.shadow){var d=this.image.ctx.fillStyle;this.image.ctx.fillStyle=this.shadowColor;for(var u=1;u<=this.shadow;u+=.5)this.image.ctx.globalAlpha=this.shadow/u,this.image.ctx.fillText(r,o+i+1+u+s*n,e+u+this._offsetY);this.image.ctx.fillStyle=d}this.image.ctx.fillText(r,o+i+s*n,e+this._offsetY),o+=this.image.ctx.measureText(r+" ").width}}},Studio.TextBox.prototype.wrapText=function(){this.image.ctx.fillStyle=this.font.color,this._lastfont=this.font.build(),this.image.ctx.font=this._lastfont;for(var t=this.image.slice[this.slice],i=(this.width-this.gutter*(this.columns-1))/this.columns,e=t.x+1,s=this.text.split("\n"),h=t.y,o=0;o!==s.length;o++){for(var n=s[o].split(" "),r="",a="",d=0,u=0,c=this.font.lineHeight,l=t.x,p=0;p<n.length;p++){var _=n[p];if("<"===_[0]&&">"===_[_.length-1]){if("</>"==_)this.image.ctx.font=this.font.build();else{var g=this.styles[_.slice(1,_.length-1)];g&&(this.image.ctx.font=this.font.modify(g),g.lineHeight&&(c=g.lineHeight))}u=0}else u=this.image.ctx.measureText(_+" ").width;if((d+=u)>i&&p>0){if(d-=u,h+c>=t.height/this.image.resolution&&(h=t.y,(e+=i+this.gutter)>=t.width))return;1==this.justify?this.writeLine(a,e,h,(i-d)/l):this.writeLine(a,e+(i-d)*this.horizontal_align|0,h,0),l=t.x,a=_+" ",h+=c,d=u}else a=a+_+" ",l++}h+c>=t.height/this.image.resolution&&(h=t.y,e+=i+this.gutter,console.log("move me over outside")),this.writeLine(a,e+(i-d)*this.horizontal_align|0,h,.25),this._wrap_height=h+c,o!==s.length-1&&(h+=c)}this._wrap_height>this.height&&(this._wrap_height=this.height),this._vertical_align=this._wrap_height*this.vertical_align-this.height*this.vertical_align|0},Studio.TextBox.prototype.fit=function(){this.image.height=this._wrap_height,this.wrapText()},Studio.TextBox.prototype.update_xy=function(){this.orbits&&this._parent.angle?this.update_orbit_xy():(this._world.x=this.x*this._parent.scaleX+this._parent.x,this._world.y=this.y*this._parent.scaleY+this._parent.y-this._vertical_align),this.live&&this.finish()},Studio.Scene.prototype.update_tweens=function(t){var i,e=0,s,h,o;for(i in this.tweens)if(s=this.tweens[i],s.actor._world?s.cur+=t*s.actor._world.speed:s.cur+=t,!s.active&&s.onStart&&(s.onStart.call(s.actor),s.active=1),(o=s.dir?1-s.cur/s.duration:s.cur/s.duration)<1&&o>0)for(e=0;e!==s.keys.length;e++)h=s.keys[e],this.update_property(s,h,o);else if(s.next)s.next._snapshot(),s.next.cur=s.cur-s.duration,this.tweens[i]=s.next;else{if(s._loop)return s.cur=0,s.onEnd&&s.onEnd.call(s.actor),void(s._reflect?s.dir?s.dir=0:s.dir=1:(s.actor.apply(s.original),s.active=0));if(s.reset)s.actor.apply(s.original);else for(e=0;e!==s.keys.length;e++)h=s.keys[e],s.actor[h]=s.to[h];s.onEnd&&s.onEnd.call(s.actor),s=null,this.tweens[i]=null,delete this.tweens[i]}},Studio.Scene.prototype.update_property=function(t,i,e){t.actor[i]=t.original[i]+Studio.Ease[t.ease](e)*(t.to[i]-t.original[i])},Studio._tween_object=function(t,i,e,s,h,o){this.actor=t,this.ease=i,this.original={},this.to=e,this.cur=0,this.duration=s,this.onStart=o,this.onEnd=h,this._loop=!1,this._reflect=!0,this.reset=!1,this.dir=0,this.active=0,this.id=null,this.keys=Object.keys(e),this.next=null,this.prev=null},Studio._tween_object.prototype.constructor=Studio._tween_object,Studio._tween_object.prototype.loop=function(){return this._loop=!0,this},Studio._tween_object.prototype.apply=function(t){for(var i in t)this[i]=t[i];return this},Studio._tween_object.prototype.reflect=function(t){return this._reflect=t,this},Studio._tween_object.prototype.setActor=function(t){return this.actor=t,this},Studio.Scene.prototype.createTween=function(t,i,e,s,h,o){var n=new Studio._tween_object(t,i,e,s,h,o);n.id=this.nextID;for(var r in e)n.original[r]=t[r];return this.nextID++,n},Studio._tween_object.prototype._snapshot=function(){for(var t in this.to)this.original[t]=this.actor[t]},Studio._tween_object.prototype.then=function(t,i,e,s,h){return this.next=new Studio._tween_object(this.actor,t,i,e,s,h),this.next.prev=this,this.next},Studio._tween_object.prototype.last=function(){for(var t=this.next,i=this;null!==t;)i=t,t=t.next;return i},Studio._tween_object.prototype.completeLoop=function(t){return this.next=t,t.prev=this,this.next},Studio.Scene.prototype.createLoop=function(t,i,e,s,h){return this.tweens[this.nextID]=this.createTween(t,i,e,s,h),this.tweens[this.nextID-1].loop=!0,this.tweens[this.nextID-1]},Studio.Scene.prototype.addTween=function(t,i,e,s,h){return this.tweens[this.nextID]=this.createTween(t,i,e,s,h),this.tweens[this.nextID-1]},Studio.Scene.prototype.playTween=function(t){t.cur=0;for(var i=0;i!==t.keys.length;i++)t.original[t.keys[i]]=t.actor[t.keys[i]];this.tweens[t.id]=t},Studio.Scene.prototype.stopTween=function(t,i,e){if(this.tweens[t.id]){if(t.cur=0,t.dir=0,i){var s;if(e)for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.original[t.keys[s]];else for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.to[t.keys[s]]}this.tweens[t.id]=null,delete this.tweens[t.id]}},Studio.Pattern=function(t){return this.height=512,this.width=512,this.overflowX=0,this.overflowY=0,this.resolution=1,this.image=null,this.offsetX=0,this.offsetY=0,this.stretchY=!1,t&&this.apply(t),this.base_image=this.image,this.base_image.addListenerTo("ready","onImageReady",this),this.width=this.width+this.overflowX,this.height=this.height+this.overflowY,this.image=new Studio.Cache(this.width,this.height,this.resolution),this._imaged=!1,this},Studio.inherit(Studio.Pattern,Studio.Sprite),Studio.Pattern.prototype.setPattern=function(){var t=this.base_image.slice[this.slice],i=t.width*this.scaleX||0,e=t.height*this.scaleY||0,s=0,h=0;if(this.stretchX||this.stretchY)if(this.stretchY)for(s=0;s<this.width;s+=i)this.offsetX+i>i&&(this.offsetX-=i),this.image.ctx.drawImage(this.base_image.bitmap,t.x,t.y,t.width,t.height,s+this.offsetX,h+this.offsetY,i,this.height);else for(h=0;h<this.height;h+=e)this.offsetY+e>e&&(this.offsetY-=e),this.image.ctx.drawImage(this.base_image.bitmap,t.x,t.y,t.width,t.height,s+this.offsetX,h+this.offsetY,this.width,e);else for(s=0;s<this.width;s+=i)for(h=0;h<this.height;h+=e)this.offsetX+i>i&&(this.offsetX-=i),this.offsetY+e>e&&(this.offsetY-=e),this.image.ctx.drawImage(this.base_image.bitmap,t.x,t.y,t.width,t.height,s+this.offsetX,h+this.offsetY,i,e);return this},Studio.Pattern.prototype.checkOverflow=function(){this.x>0&&(this.x-=this.overflowX),this.y>0&&(this.y-=this.overflowY),this.x<-this.overflowX&&(this.x+=this.overflowX),this.y<-this.overflowY&&(this.y+=this.overflowY)},Studio.Pattern.prototype.onImageReady=function(t){t&&this.setPattern()},Studio.Pattern.prototype.debugDraw=function(t){t.strokeRect(this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY-this._vertical_align,this._world.width,this._wrap_height)},Studio.Pattern.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.bitmap,0,0,this.image.bitmap.width,this.image.bitmap.height,-this._dwidth*this.anchorX,-this._dheight*this.anchorY,this._dwidth,this._dheight),t.restore()},Studio.Pattern.prototype.draw=function(t){this.setAlpha(t),this.angle?this.drawAngled(t):t.drawImage(this.image.bitmap,0,0,this.image.bitmap.width,this.image.bitmap.height,this._dx-this._dwidth*this.anchorX,this._dy-this._dheight*this.anchorY,this._dwidth,this._dheight)},Studio.Pattern.prototype.buildElement=function(t,i,e){t.buffers[this.image.path]||(t.buffers[this.image.path]=new Studio.BufferGL(this.image,0,t)),t.draws++,e?this._delta(i):this._dset(),this._boundingBox.get_bounds(this),this.verts(this._boundingBox,t.buffers[this.image.path],this.base_image.sliceGL.Full,t)},Studio.load=function(t,i,e,s){var h=new XMLHttpRequest;h.onload=function o(){var n=null;h.status>=200&&h.status<400||0==h.status?(console.log("%cStudio loaded file : "+t,Studio.statStyle),"json"==i.toLowerCase()&&(n=JSON.parse(h.responseText)),e&&(s?e.call(s,n):e(n))):this.onerror()},h.onerror=function(){console.log("%cStudio failed to load file : "+t,Studio.errorStyle)},h.open("GET",t,!0),h.send()},Studio.TileMap=function(t,i,e,s){this.cache=new Studio.Cache(t,i,e),this.buffer=new Studio.Cache(t,i,e),this.offsetX=0,this.offsetY=0,this.maxWidth=0,this.resolution=e||1,this.repeat=this.data=null,s&&this.apply(s)},Studio.TileMap.prototype={apply:Studio.apply,constructor:Studio.TileMap,build:function(t,i,e,s,h,o){var n=t,r=this.cache.ctx,a=i.tileWidth,d=i.tileHeight;this.maxWidth=Math.floor(this.cache.width/a)/this.resolution;var e=e||0,s=s||0,u=h||this.maxWidth,c=o||n.height-s;if(n.data)for(var l=0;l!=c;l++)for(var p=0;p!=u;p++){var _=0,g=0,f=n.data[parseInt((l+s)*n.width)+(p+e)]-i.firstgid,a=i.tileWidth,d=i.tileHeight;f>2147483648&&(f-=2147483648,_=-1),f>1073741824&&(f-=1073741824,g=-1),f>536870912&&(f-=536870912);var S=parseInt(f/i.across),w=f-S*i.across;r.drawImage(i.set.bitmap,w*i.tileWidth+i.tileWidth*_,S*i.tileHeight+i.tileHeight*g,a,d,p*i.tileWidth,l*i.tileHeight,i.tileWidth,i.tileHeight)}this.buffer.ctx.clearRect(0,0,this.cache.width,this.cache.height),this.buffer.ctx.drawImage(this.cache.bitmap,0,0),this.cache.ready=!0},offsetMap:function(t,i){this.offsetX+=t,this.offsetX<0&&(this.offsetX=0),this.offsetX+this.maxWidth>this.data.width&&(this.offsetX=this.data.width-this.maxWidth),this.cache.ctx.clearRect(0,0,this.cache.width,this.cache.height);for(var e in this.data.layers)this.build(this.data.layers[e],this.tileset,this.offsetX,this.offsetY,this.maxWidth)},_onLoad:function t(i){if(console.log(i),!i)return void console.log("The image isn't ready so we need to wait.");1==i&&(console.log("The Image is ready, we can now create the tileset from the information provided, and then build the map from the data layer."),this.offsetMap(0,0))},onMapLoad:function(t){this.data=t,this.set=t.tilesets[0];var i=new Studio.Image("assets/"+this.set.image);this.tileset=new Studio.TileSet(i,this.set.tilewidth,this.set.tileheight,this.set.imagewidth),i.addListenerTo("ready","_onLoad",this)},load:function(t,i){Studio.load(t,i,this.onMapLoad,this)}},Studio.TileSet=function(t,i,e,s){this.firstgid=1,this.tileWidth=i||32,this.tileHeight=e||32,this.across=s/i|0,this.set=t||null},Studio.TileSet.prototype={constructor:Studio.TileSet,onLoadComplete:function(t){t.across=t.set.width/t.tileWidth}},Studio.Effect={},Studio.Effect.BillAtkinsonDither_BW=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1,this.active=!0},action:function(t){for(var i=t.ctx.getImageData(0,0,t.bitmap.width,t.bitmap.height),e=i.data,s=parseInt(4*t.bitmap.width),h=e.length,o=0;o<h;o+=4)this.oldpixel=e[o],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[o]=e[o+1]=e[o+2]=this.newpixel,e[o+3]>20?e[o+3]=255:e[o+3]=0,this.qerror=.15*(this.oldpixel-this.newpixel),o%s==0&&o+4%s===0&&o+8%s===0||(e[o+5]=e[o+6]=e[o+4]+=this.qerror,e[o+9]=e[o+10]=e[o+8]+=this.qerror,e[o+5+s]=e[o+6+s]=e[o+4+s]+=this.qerror,e[o+1+s]=e[o+2+s]=e[o+s]+=this.qerror,e[o+s-3]=e[o+s-2]=e[o+s-4]+=this.qerror,e[o+2*s]=e[o+2*s]=e[o+2*s]+=this.qerror);t.ctx.putImageData(i,0,0)}}),Studio.Effect.Posterize=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1,this.active=!0},action:function(t){for(var i=t.ctx.getImageData(0,0,t.bitmap.width,t.bitmap.height),e=i.data,s=4*t.bitmap.width,h=e.length,o=0;o<h;o++)this.oldpixel=e[o],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[o]=this.newpixel;t.ctx.putImageData(i,0,0)}}),Studio.Effect.Replicator=new Studio.Plugin({options:{x:3,y:3},init:function(t){this.cache=new Studio.Cache},action:function(t){var i=t.canvas.width/this.options.x,e=t.canvas.height/this.options.y;this.cache.image.width=i,this.cache.image.height=e,this.cache.buffer.drawImage(t.canvas,0,0,i,e);for(var s=0;s!=this.options.x;s++)for(var h=0;h!=this.options.y;h++)t.ctx.drawImage(this.cache.image,s*i,h*e,i,e)}}),Studio.Effect.Blur=new Studio.Plugin({options:{x:3,y:3},init:function(t){this.cache=new Studio.Cache,this.active=!0},action:function(t){var i=t.bitmap.width/2,e=t.bitmap.height/2;console.log(this.cache),this.cache.bitmap.width=i,this.cache.bitmap.height=e,this.cache.ctx.drawImage(t.bitmap,0,0,i,e),t.ctx.drawImage(this.cache.bitmap,0,0,t.width,t.height)}}),Studio.Effect.Cursor=new Studio.Plugin({options:{},init:function(t){this.cursor=new Studio.Image("assets/cursor.png"),t.bitmap.style.cursor="none"},action:function(t){t.ctx.drawImage(this.cursor.image,t.mouse.x-8,t.mouse.y-8,48,48)}}),Studio.Effect.Red=new Studio.Plugin({options:{},init:function(t){this.active=!0},action:function(t){for(var i=t.ctx.getImageData(0,0,t.bitmap.width,t.bitmap.height),e=i.data.buffer,s=new Uint8Array(e),h=new Uint32Array(e),o=h.length,n=0;n!=o;n++){var r=i.data[4*n+1];h[n]=255<<24|255-r<<16|r<<8|255-r}i.data.set(s),t.ctx.putImageData(i,0,0)}})
;var FRAGMENTSHADER=["precision lowp float;","uniform sampler2D u_image;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","\tgl_FragColor = texture2D(u_image, v_texture) * v_color;","}"].join("\n"),VERTEXSHADER=["attribute vec3 a_position;","attribute vec4 a_color;","attribute vec2 a_texture;","uniform vec2 u_resolution;","uniform mat3 u_matrix;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","   vec2 canvas_coords = (u_matrix * vec3(a_position.xy,1)).xy;","   vec2 clipSpace = ((canvas_coords / u_resolution)*2.0) - 1.0;","\tgl_Position = vec4(clipSpace * vec2(1, -1), a_position.z, 1);","\tv_color = a_color;","\tv_texture = a_texture;","}"].join("\n");Studio.Stage.prototype.loadShader=function(t,i){this.ctx.shaderSource(t,i)},Studio.Stage.prototype.WEBGL={type:"webgl",antialias:!1,premultipliedAlpha:!1,stencil:!0,getContext:function(){Studio.browser_info.iOS?this.WEBGL.antialias=!0:this.WEBGL.antialias=!1,this.ctx=this.bitmap.getContext(Studio.browser_info.webGL,{antialias:this.WEBGL.antialias,premultipliedAlpha:this.WEBGL.premultipliedAlpha,stencil:this.WEBGL.stencil})},newBatch:function(t,i){},init:function(t){this._max_textures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this._count=0,this.rect_buffer=new Studio.BufferGL(null,0,this),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.vertexShader=t.createShader(t.VERTEX_SHADER),this.loadShader(this.vertexShader,VERTEXSHADER),this.fragmentShader=t.createShader(t.FRAGMENT_SHADER),this.loadShader(this.fragmentShader,FRAGMENTSHADER),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.compileShader(this.vertexShader),t.compileShader(this.fragmentShader),t.linkProgram(this.program),t.useProgram(this.program)},prep:function(t){this.buffers={},t.resolutionLocation=t.getUniformLocation(this.program,"u_resolution"),t.matrixLocation=t.getUniformLocation(this.program,"u_matrix"),t.enableVertexAttribArray(0),t.positionLocation=t.getAttribLocation(this.program,"a_position"),t.bindAttribLocation(this.program,0,"a_position"),t.colorLocation=t.getAttribLocation(this.program,"a_color"),t.textureLocation=t.getAttribLocation(this.program,"a_texture"),t.uniform2f(t.resolutionLocation,this.width,this.height),this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(t.positionLocation),t.enableVertexAttribArray(t.colorLocation),t.enableVertexAttribArray(t.textureLocation),t.vertexAttribPointer(t.positionLocation,3,t.FLOAT,!1,36,0),t.vertexAttribPointer(t.colorLocation,4,t.FLOAT,!1,36,12),t.vertexAttribPointer(t.textureLocation,2,t.FLOAT,!1,36,28),this._rect_index_buffer=t.createBuffer(),this._rect_index=new Uint16Array(7*this._maxCount);for(var i=0,e=0;i<7*this._maxCount;i+=6,e+=4)this._rect_index[i+0]=e+0,this._rect_index[i+1]=e+1,this._rect_index[i+2]=e+2,this._rect_index[i+3]=e+1,this._rect_index[i+4]=e+2,this._rect_index[i+5]=e+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._rect_index,t.STATIC_DRAW)},render:function(t){this._count=0,this.draws=0,this.ctx.clearColor(this.color.r,this.color.g,this.color.b,this.color.a),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT),this.previousScene&&(this.previousScene.buildElement(this,t,this.interpolate),this.previousScene.vertex_children(this,t,this.interpolate)),this.activeScene&&(this.activeScene.buildElement(this,t,this.interpolate),this.activeScene.vertex_children(this,t,this.interpolate)),this.vertex_children(this,t,this.interpolate),this.rect_buffer.draw(this.ctx),this.camera.render(this,t,1);for(var i in this.buffers)this.buffers[i].draw(this.ctx);this._effects&&this.runEffects()}},Studio.Stage.prototype.CANVAS={type:"2dContext",getContext:function(){this.ctx=this.bitmap.getContext("2d")},init:function(){this.ctx.webkitImageSmoothingEnabled=this.smoothing,this.ctx.mozImageSmoothingEnabled=this.smoothing,this.ctx.imageSmoothingEnabled=this.smoothing},prep:function(){},render:function(t){if(this.ctx.setTransform(this.resolution,0,0,this.resolution,0,0),this.draw(this.ctx),this.camera.render(this,t),this.previousScene&&this._renderScene(this.previousScene,t),this.activeScene&&this._renderScene(this.activeScene,t),this._hasChildren)return this.render_children(this,t),void(this._effects&&this.runEffects());this._watching&&(this._watching.render_children(this,t),this._effects&&this.runEffects())}},Studio.Stage.prototype._renderScene=function(t,i){t.active&&t.render(this,i,this.interpolate)},Studio.Stage.prototype.engine=Studio.Stage.prototype.CANVAS,Studio.Stage.prototype.enableKeyboardInput=function(){if(this.keys)return void console.warn("Keyboard events are already enabled.");var t=this;this.keys={},this.keys.onScreen={};var i=function(i){i.preventDefault(),t.keys[i.keyCode]=1,t.keys.onScreen[i.keyCode]&&t.keys.onScreen[i.keyCode].keydown()},e=function(i){i.preventDefault(),t.keys[i.keyCode]=0,t.keys.onScreen[i.keyCode]&&t.keys.onScreen[i.keyCode].keyup()};document.addEventListener("keydown",i,!1),document.addEventListener("keyup",e,!1)},Studio.Stage.prototype.enableTouchEvents=function(){var t=this,i={x:0,y:0,dx:0,dy:0,id:0};this.mouse_onDown=function(t,i){if(i.buttons&&!i._pause_buttons)for(var e=0;e!=i.buttons.length;e++)if(i.buttons[e]._touchID);else if(i.buttons[e].hitTestPoint(t.x,t.y)){if(i.buttons[e]._touchID=t.id,i.buttons[e].onTap&&i.buttons[e].onTap(t),i.buttons[e].preventBubble)return}else i.buttons[e].onTapOutside&&i.buttons[e].onTapOutside(t)},this.mouse_onMove=function(t,i){if(i.buttons&&!i._pause_buttons)for(var e=0;e!=i.buttons.length;e++)i.buttons[e].hitTestPoint(t.x,t.y)?(i.buttons[e].draggable&&t.id&&i.buttons[e]._touchID==t.id&&(i.buttons[e]._activeDrag?i.buttons[e].onDrag&&i.buttons[e].onDrag(t):(i.buttons[e].onDragStart&&i.buttons[e].onDragStart(t),i.buttons[e]._activeDrag=!0)),i.buttons[e].onHoverStart&&!i.buttons[e].hovering?i.buttons[e].onHoverStart(t):i.buttons[e].onHover&&i.buttons[e].onHover(t),i.buttons[e].hovering=!0):i.buttons[e].hovering&&(i.buttons[e].hovering=!1,i.buttons[e].onHoverEnd&&i.buttons[e].onHoverEnd()),i.buttons[e].draggable&&i.buttons[e]._activeDrag&&i.buttons[e]._touchID==t.id&&(i.relativeX=t.dx,i.relativeY=t.dy,i.buttons[e].angle&&(i.buttons[e].orbits||i.buttons[e].inheritRotation)&&(i.relativeX=t.dx*Math.cos(-i.buttons[e].angle)-t.dy*Math.sin(-i.buttons[e].angle),i.relativeY=t.dx*Math.sin(-i.buttons[e].angle)+t.dy*Math.cos(-i.buttons[e].angle),t.dx=i.relativeX,t.dy=i.relativeY),i.buttons[e].onDrag&&i.buttons[e].onDrag(t)),i.buttons[e].onTouchMove&&i.buttons[e].onTouchMove(t)},this.mouse_onUp=function(t,i){if(i.buttons)for(var e=0;e!=i.buttons.length;e++)i.buttons[e]._touchID==t.id&&(i.buttons[e]._activeDrag&&i.buttons[e].onDragEnd&&i.buttons[e].onDragEnd(t),i.buttons[e].hitTestPoint(t.x,t.y)?i.buttons[e].onRelease&&i.buttons[e].onRelease(t):i.buttons[e].onReleaseOutside&&i.buttons[e].onReleaseOutside(t),i.buttons[e]._activeDrag=!1,i.buttons[e]._touchID=0)};var e={clientX:0,clientY:0},s=function(i){e.clientX=(i.clientX-t.bitmap.getBoundingClientRect().left)/t._scaleRatio,e.clientY=(i.clientY-t.bitmap.getBoundingClientRect().top)/t._scaleRatio},h=function(h){s(h),i.id=1,i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,i.dx=i.dy=0,t.mouse_onDown(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onDown(i,t.activeScene)},o=function(h){s(h),i.dx=i.x-(e.clientX+t.camera.x),i.dy=i.y-(e.clientY+t.camera.y),i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,t.mouse_onMove(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onMove(i,t.activeScene)},n=function(e){t.mouse_onUp(i,t),t.activeScene&&t.activeScene.active&&t.mouse_onUp(i,t.activeScene),i.id=0};this._mouseWindow?(document.addEventListener("mousedown",h,!1),document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",n,!1),document.addEventListener("mouseout",n,!1)):(this.bitmap.addEventListener("mousedown",h,!1),this.bitmap.addEventListener("mousemove",o,!1),this.bitmap.addEventListener("mouseup",n,!1),this.bitmap.addEventListener("mouseout",n,!1));var r={},a=0,d=[],u={},c=0,l=function(i){i.preventDefault(),c=i.targetTouches.length;for(var h=0;h!=c;h++)a=i.targetTouches[h].identifier,s(i.targetTouches[h]),r[a]={},r[a].id=a,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,r[a].dx=0,r[a].dy=0,t.mouse_onDown(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onDown(r[a],t.activeScene)},p=function(i){i.preventDefault(),c=i.targetTouches.length;for(var h=0;h!=c;h++)a=i.targetTouches[h].identifier,s(i.targetTouches[h]),r[a].dx=r[a].x-e.clientX,r[a].dy=r[a].y-e.clientY,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,t.mouse_onMove(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onMove(r[a],t.activeScene)},_=function(i){i.preventDefault(),c=i.changedTouches.length;for(var e=0;e!=c;e++)a=i.changedTouches[e].identifier,t.mouse_onUp(r[a],t),t.activeScene&&t.activeScene.active&&t.mouse_onUp(r[a],t.activeScene),delete r[a]};window.ejecta?(document.addEventListener("touchstart",l,!1),document.addEventListener("touchmove",p,!1),document.addEventListener("touchend",_,!1),document.addEventListener("touchcancel",_,!1)):(this.bitmap.addEventListener("touchstart",l,!1),this.bitmap.addEventListener("touchmove",p,!1),this.bitmap.addEventListener("touchend",_,!1),this.bitmap.addEventListener("touchcancel",_,!1),this.bitmap.addEventListener("pointerdown",h,!1),this.bitmap.addEventListener("pointermove",o,!1),this.bitmap.addEventListener("pointerup",n,!1),this.bitmap.setAttribute("tabindex","0"),this.bitmap.focus())};