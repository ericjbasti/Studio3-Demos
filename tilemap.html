<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
	<head>
	    <title>Studio3</title>
		<meta name="viewport" content="width=device-width, user-scalable=0, maximum-scale=1"/>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="apple-touch-icon" href="icon.png" />
		<link rel="stylesheet" href="assets/debug.css" />
	</head>
<body style="margin:0;background: #333">
	<canvas id="canvas" width="480" height="320" style="cursor:pointer;display: block;outline:1px solid #BBFF00; image-rendering: -webkit-optimize-contrast;"></canvas>
</body>
<script src="studio-compiled.js"></script>
<script src="stats.js"></script>
<script>

var stage = new Studio.Stage('canvas',{webgl:0, dur:1000/60, fullscreen:0, color: Studio.BLUE, resolution: 2})

var map = new Studio.TileMap(320,320,1,{offsetX: 0, offsetY: 0});

map.load('assets/dorm-lobby.json','json');

var tt = new Studio.Sprite({width: 480, height: 400, anchorX: 0, anchorY: 0, image: map.cache})
stage.addChild(tt);









var jane = new Studio.Image('assets/char.png');

var box = new Studio.Sprite({x:-100, y:-100, height: 42, width: 24, image: jane})
stage.addChild(box)
box.onEnterFrame = function(){
	if(stage.keys[38] || stage.keys["UP"]){
		this.y -= 4;
	}
	if(stage.keys[37] || stage.keys["LEFT"]){
		this.x -= 4;
	}
	if(stage.keys[40] || stage.keys["DOWN"]){
		this.y += 4;
	}
	if(stage.keys[39] || stage.keys["RIGHT"]){
		this.x += 4;
	}
	if(stage.keys["L1"]){
		stage.camera.scaleX = stage.camera.scaleY -= .01;
	}
	if(stage.keys["R1"]){
		stage.camera.scaleX = stage.camera.scaleY += .01;
	}
}

stage.enableKeyboardInput();

var GAMEPAD = new Studio.Plugin({
	options: {
	},
	init: function(a) {
		this.gamepads = navigator.getGamepads();
		this.gamepad = null;
	    this.remote = null;
	},
	action: function(a) {
		this.gamepads = navigator.getGamepads();
		this.gamepad = null;
	    this.remote = null;

	    for(var z = 0; z!=this.gamepads.length;z++){
	        if(this.gamepads[z]){
	        	if(this.gamepads[z].id=='Remote'){
	            	this.remote = this.gamepads[z]
	            }else{
	            	this.gamepad = this.gamepads[z]
	            }
	        }
	    }
	    for(var i = 0; i != this.gamepads.length; i ++){
	        if(this.gamepads[i]){
	            this.gamepad = this.gamepads[i];
	            stage.keys['A'] = this.gamepad.buttons[0].value; // A
	            stage.keys['B'] = this.gamepad.buttons[1].value; // B
	            stage.keys['X'] = this.gamepad.buttons[2].value; // X
	            stage.keys['Y'] = this.gamepad.buttons[3].value; // Y

	            stage.keys['L1'] = this.gamepad.buttons[4].value; // L1
	            stage.keys['R1'] = this.gamepad.buttons[5].value; // R1
	            stage.keys['L2'] = this.gamepad.buttons[6].value; // L2
	            stage.keys['R2'] = this.gamepad.buttons[7].value; // R2

	            stage.keys['UP'] = this.gamepad.buttons[12].value; // Up
	            stage.keys['DOWN'] = this.gamepad.buttons[13].value; // Down
	            stage.keys['LEFT'] = this.gamepad.buttons[14].value; // Left
	            stage.keys['RIGHT'] = this.gamepad.buttons[15].value; // Right

	            //stage.keys['MENU'] = this.gamepad.buttons[16].value; // Menu

	            // drawAnalogStick(gamepad.axes[0], gamepad.axes[1], 540, 416); // left stick
	            // drawAnalogStick(gamepad.axes[2], gamepad.axes[3], 736, 416); // right stick
	            // ctx.translate(1200,0)
	        }
	    }
	}
})

if(navigator.getGamepads){
	stage.addEffect(GAMEPAD);
}

stage.camera.bindTo(tt)
stage.camera.track(box)
stage.addEffect(STATS,{
	external: true, 
	height: 50,
	width: stage.width,
	position: 0,
	clear_mode:'cover'}
);
Studio.start();

</script>
</html>