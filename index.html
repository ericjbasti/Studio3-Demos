<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
    <title>Studio3</title>
	<meta name="viewport" content="width=320, user-scalable=0, maximum-scale=1"/>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="apple-touch-icon" href="icon.png" />
</head>

<body style="margin:0;background: #333">
	<canvas id="canvas" height="600" width="800"  style="cursor:pointer;margin: 0 auto;display: block;outline:1px solid #BBFF00;"></canvas>
</body>
<script src="studio-compiled.js"></script>
<script src="stats.js"></script>
<script>

var ratio = 1;

var stage = new Studio.Stage('canvas',{
	webgl : 1, 
	dur : 1000/(60/ratio), 
	// fullscreen : 1, 
	// resolution : 1, 
	// interpolate : 0, 
	_maxCount : 1600,
	// _maxCount : 3000,
	// _maxCount : 1400,
	// smoothing: false,
	// timeStep : Studio.timeStep.static_fixed
})

// var beep = new Studio.Sound('assets/bend.mp3');
// beep.addListener('ready',function(s){
// 	alert('Yeah Im Ready : ' + s );
// })

var MAX = stage._maxCount/1 | 0
var gravity = .4*ratio

var cursor = new Studio.Image('assets/cursor.png')

var ball = new Studio.Image('assets/char.png',{
	'head': {
		x : 0, 
		y : 0, 
		width : 12, 
		height : 10
	},
	'feet': {
		x : 0, 
		y : 10, 
		width : 12, 
		height : 11
	},
	'body':{
		x:0,y:0,
		width: 12,
		height: 21
	}
})

// ball.addListener('ready',function(e){
// 	alert('Character Image loaded : '+ e)
// })


var globalMessageBox = function(a,type){
	alert(type);

}

var BOXdrop = function(attr){
	this.image = ball
	this.slice = 'body'
	this.color = new Studio.Color()
	// this.rotation = 45
	if(attr){
		this.apply(attr)
	}
	// this.color= Studio.WHITE
	this.color.set(Math.random()*510 ,Math.random()*510 ,Math.random()*510, 1)
	// this.color.set(255,255,255,1)
}


Studio.inherit(BOXdrop, Studio.Sprite)

BOXdrop.prototype.logic = function(){
	this.velocityY += gravity
	this.x += this.velocityX*ratio
	this.y += this.velocityY*ratio
	this.rotation+=this.velocityX*3
	if(this.x > stage.width || this.x < 0){
		this.velocityX *= -1
	}
	if(!this.hit){
		this.y = this.y - stage.height;
		this.x = stage.width/2
		this.hit = 10
		this.velocityY = Math.random()*3
		this._snapback()
	}
	if(this.y>stage.height){
		this.velocityY *= -.8
		this.hit--
		this.y = stage.height-1;
		// beep.play()
		// this.yoyo.sendMessage('drop',true);
	}
}


for (var i = 0; i!=MAX;i++){
	var yy=new BOXdrop({
		x : stage.width/2 ,
		y : Math.random()*120,
		width : 12*2,
		height : 21*2,
		velocityX : 2-(Math.random()*4),
		velocityY : -10+(Math.random()*6),
		hit : 10
	});
	stage.addChild(yy)
}


stage.addEffect( STATS ,{
	external : true, 
	height : 50,
	width : 320,
	position : 0,
	clear_mode :'erase'
})


for (var i = 0; i!=MAX;i++){
	var yy=new BOXdrop({
		x : stage.width/2 ,
		y : Math.random()*480,
		width : 4,
		height : 4,
		velocityX : 2-(Math.random()*4),
		velocityY : -10+(Math.random()*6),
		hit : 10,
		slice: 'Full',
		image: cursor
	});
	stage.addChild(yy)
}



Studio.start()

</script>


</html>


