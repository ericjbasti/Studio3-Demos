var blocks=[],prizes=[],prizemax=8,prizegot=0,foods=[],max_food=3,food_got=0,sodas=[],max_soda=3,soda_got=0,actionables=[],gravitated=[],player_count=1,Game=new Studio.Scene({y:.5,x:-stage.width,width:1*stage.width,height:1*stage.height,color_hex:"#66CCFF",gravity:.78,onActivate:function(i){i.addTween(this,"chillInOut",{x:0},1500),i.logic=GameLogic,FOCUS_ENGINE.active=!1,wind_snd.play()},onDeactivate:function(i){i.addTween(this,"chillInOut",{x:-i.width},1500),i.logic=null,this.active=!1,FOCUS_ENGINE.active=!0},build:function(i){this.addChild(new Studio.Clip({x:0,y:0,width:this.width,height:this.height,anchorX:0,anchorY:0}));var t=new Studio.Pattern({width:this.width,height:this.height,overflowX:8,overflowY:0,image:curse,anchorX:0,anchorY:0,slice:"Skyline"},this);this.addChild(t);var e=0;t.onEnterFrame=function(){this.x-=.2,this.x<-8&&(this.x+=8),this.y-=Math.cos(e)/10,e+=.1};var a=new Studio.Pattern({y:240,width:this.width,height:128,overflowX:8,overflowY:16,image:curse,anchorX:0,anchorY:0,slice:"Water5"},this);this.addChild(a),a.onEnterFrame=function(){this.x-=.2,this.x<-8&&(this.x+=8),this.y+=Math.sin(e)/8},this.addChild(a);var s=new Studio.Sprite({x:64,y:16,width:224,height:68,image:curse,slice:"Large Cloud",borderlap:!0,border:this});this.addChild(s),s.onEnterFrame=function(){this.x-=.25,this.x<0&&(this.x=i.width)};var h=new Studio.Sprite({x:400,y:100,width:70,height:24,image:curse,slice:"Small Cloud 1",borderlap:!0,border:this});this.addChild(h),h.onEnterFrame=function(){this.x-=.35,this.x<0&&(this.x=i.width)};for(var o=0;2!=o;o++){var r=new Studio.Sprite({x:16+32*o,y:224,height:32,width:32,image:curse,slice:"Floating Rock Center"});blocks.push(r),this.addChild(r)}r.slice="Floating Rock Right";for(var o=0;22!=o;o++){var r=new Studio.Sprite({x:0+32*o,y:352,height:32,width:32,image:curse,slice:"Rock"});blocks.push(r),this.addChild(r)}for(var o=0;2!=o;o++){var r=new Studio.Sprite({x:this.width-16-32*o,y:224,height:32,width:32,image:curse,slice:"Floating Rock Center"});blocks.push(r),this.addChild(r)}r.slice="Floating Rock Left";for(var o=0;6!=o;o++){var r=new Studio.Sprite({x:this.width/2-32*o+62,y:320,height:32,width:32,image:curse});r.slice=0==o?"Rock Last":5==o?"Rock First":"Rock",blocks.push(r),this.addChild(r)}for(var o=0;4!=o;o++){var r=new Studio.Sprite({x:this.width/2-32*o+32,y:288,height:32,width:32,image:curse,slice:"Rock"});r.slice=0==o?"Rock Last":3==o?"Rock First":"Rock",blocks.push(r),this.addChild(r)}for(var o=0;2!=o;o++){var r=new Studio.Sprite({x:this.width/2-32*o,y:256,height:32,width:32,image:curse,slice:"Rock"});r.slice=0==o?"Rock Last":1==o?"Rock First":"Rock",blocks.push(r),this.addChild(r)}var l=new Studio.DisplayObject;l.x=this.width/2-32,l.y=160;var e=0;l.onEnterFrame=function(){this.velocityX=2*Math.sin(e),this.velocityY=Math.cos(e),this.x+=this.velocityX,this.y+=this.velocityY,e+=.02;for(var i=0;i!=this._hasChildren;i++)this.children[i].velocityX=this.velocityX};var r=new Studio.Sprite({x:0,y:0,height:32,width:32,image:curse,slice:"Floating Rock Left"});blocks.push(r),l.addChild(r);var r=new Studio.Sprite({x:32,y:0,height:32,width:32,image:curse,slice:"Floating Rock Center"});blocks.push(r),l.addChild(r);var r=new Studio.Sprite({x:64,y:0,height:32,width:32,image:curse,slice:"Floating Rock Right"});blocks.push(r),l.addChild(r),this.addChild(l),PLAYER_1=new Player(this),PLAYER_1.x=20,PLAYER_2=new Player(this),PLAYER_2.x=300,PLAYER_2.offsetY=4,PLAYER_3=new Player(this),PLAYER_3.x=150,PLAYER_3.offsetY=0,PLAYER_3.offsetX=8,PLAYER_4=new Player(this),PLAYER_4.x=420,PLAYER_4.offsetY=4,PLAYER_4.offsetX=8,this.addChild(PLAYER_1),this.addChild(PLAYER_2),this.addChild(PLAYER_3),this.addChild(PLAYER_4),actionables.push(PLAYER_1),actionables.push(PLAYER_2),actionables.push(PLAYER_3),actionables.push(PLAYER_4);for(var o=0;o!=prizemax;o++){var r=Coin.fromPool({x:128+64*o});prizes.push(r),this.addChild(r)}this.addChild(new Studio.Restore)}});stage.gamepadInput=function(i,t){t.MENU&&stage.setScene(Intro),(this.keys[38]||t.UP||t.A)&&(i.jumping||(i.velocityY=-i._world.height/(i._world.height/16),i.jumping=!0,jump_snd.play())),(this.keys[37]||t.LEFT)&&(i.velocityX-=.51,i.dir=left),this.keys[40]||t.DOWN,(this.keys[39]||t.RIGHT)&&(i.velocityX+=.51,i.dir=right),i.velocityY<0?i.loop=i.dir.jump:i.velocityX>1||i.velocityX<-1?(i.loop=i.dir.walk,i.fps=12):(i.loop=i.dir.pant,i.fps=6)};var players=[PLAYER_1,PLAYER_2,PLAYER_3,PLAYER_4],AI=function(i,t){if(i.ai_time+=Studio.delta,i.UP=0,i.ai_time>t){switch(parseInt(6*Math.random())){case 0:i.RIGHT=0,i.LEFT=1;break;case 1:i.RIGHT=1,i.LEFT=0;break;case 2:i.UP=1;break;case 3:i.RIGHT=0,i.LEFT=0;break;case 4:case 5:i.UP=1}i.ai_time=0}};stage.GAMEPAD_2.ai_time=0,stage.GAMEPAD_3.ai_time=0,stage.GAMEPAD_4.ai_time=0,PLAYER_2.onEnterFrame=function(){AI(stage.GAMEPAD_2,500)},PLAYER_3.onEnterFrame=function(){AI(stage.GAMEPAD_3,1e3)},PLAYER_4.onEnterFrame=function(){AI(stage.GAMEPAD_4,300)};var GameLogic=function i(){PLAYER_1&&stage.gamepadInput(PLAYER_1,stage.GAMEPAD_1),PLAYER_2&&stage.gamepadInput(PLAYER_2,stage.GAMEPAD_2),PLAYER_3&&stage.gamepadInput(PLAYER_3,stage.GAMEPAD_3),PLAYER_4&&stage.gamepadInput(PLAYER_4,stage.GAMEPAD_4);for(var t=0;t!=players.length;t++)for(var e=1;e!=players.length;e++)if(e!=t)if(players[t]._hit||players[e]._hit);else if(players[t].hitbox.hitTestRect(players[e].hitbox)){var a=players[t].x-players[e].x,s=players[t].y-players[e].y;players[t].height=players[e].height,players[t].width=players[e].width,players[e].velocityY>10&&(players[t]._hit=!0,players[t].hit(),players[e].velocityY=-18,players[e].jumping=!0),players[t].velocityY>10&&(players[e]._hit=!0,players[e].hit(),players[t].velocityY=-18,players[t].jumping=!0)}for(var t=0;t!=blocks.length;t++)for(var h=blocks[t],e=0;e!=gravitated.length;e++){var o=gravitated[e];if(h._world.x>o._world.x+32||h._world.x<o._world.x-32);else if(h._world.y>o._world.y+32||h._world.y<o._world.y-32);else if(o.hitbox.hitTestRect(h)){var a=o._world.x-h._world.x,s=o._world.y-h._world.y,r=(h._world.height-o._world.height)/4;o.platform=h,s<-10&&o.velocityY>0&&o.y+o._world.height*o.anchorY<h._world.y&&(o.velocityY*=o.bounce,o.y=h._world.y-h._world.height/2+s/2+r,o._snapback(),o.jumping=!1)}}for(var t=0;t!=prizes.length;t++)for(var h=prizes[t],e=0;e!=actionables.length;e++){var o=actionables[e];h.got||h.x-32>o.x||h.x+32<o.x||h.y-32>o.y||h.y+32<o.y||o.hitbox.hitTestRect(h)&&(h.got=!0,o.scoreUp&&(o.scoreUp(1),coin_snd.play()),prizegot++,stage.addTween(h,"quadOut",{scaleX:2,scaleY:2,alpha:0,rotation:360},300,function(){if(prizegot==prizemax)for(var i=0;i!=prizes.length;i++){var t=prizes[i];t.y=64+32*parseInt(5*Math.random()),stage.addTween(t,"quadIn",{scaleX:1,scaleY:1,alpha:1,rotation:0},300,function(){this.got=!1}),prizegot=0}}))}};