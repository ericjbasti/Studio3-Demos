<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
    <title>Studio3</title>
	<meta name="viewport" content="width=device-width, user-scalable=0, maximum-scale=1"/>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="apple-touch-icon" href="icon.png" />
</head>

<style>
	#editor{
		background: #eee;
		font-family: Courier;
		padding: .5em .8em;
		font-size: 11px;
	}
	#editor fieldset{
		border: 1px solid #ccc;
		margin-bottom: 1em
	}
	#editor label{
		color: #333;
	}
	#editor input{
		margin-right: 1em;
		border: 1px solid #ddd;
		background: none;
	}
	#editor input:focus{
		border: 1px solid #d0f;
		background: #fff;
		outline: none;
	}
	#editor input[type='number']{
		width: 5em;
	}
	#editor fieldset div {
		display: none;
	}
	#editor input:checked + legend ~ div{
		display: block;
	}

</style>


<body style="margin:0;background: #333">
	<canvas id="canvas" height="400" width="400"  style="cursor:pointer;display: block;outline:1px solid #111;"></canvas>
	<div id="editor"></div>
</body>
<script src="studio-compiled.js"></script>
<script>
	
var stage = new Studio.Stage("canvas",{webgl:0});
stage.color.setFromHex('#222')

var getType = function(who){
	var type = "null"
	switch (who.constructor){
		case Studio.Stage: 			type = "Stage"; break;
		case Studio.DisplayObject: 	type = "DisplayObject"; break;
		case Studio.Rect: 			type = "Rect"; break;
		case Studio.Sprite: 		type = "Sprite"; break;
		case Studio.ImageSlice: 	type = "ImageSlice"; break;
	}
	return type;
}

var buildSceneGraph = function(graph){
	var temp = {}

	for (item in graph){
		if(graph.hasOwnProperty(item)){
			switch (item){
				case 'parent' : break;
				case 'slice' : break;
				case '_world' : break;
				case 'color' : temp[item] = graph[item].style; break;
				case 'children' : temp.children = []; 
					for(var i = 0; i !=graph.children.length; i++){
						temp.children.push(buildSceneGraph(graph.children[i]));
					}; break;
				default: 
				if(typeof graph[item] == 'function'){
					temp[item]='' + graph[item];
				}else{
					temp[item]=graph[item];
				}
			}
		}
	}
	temp.type = getType(graph);
	return temp;
}

var buildNumberAttribute = function(label, item){
	var x = document.createElement('label');
	x.innerHTML = label + ": "
	var x_input = document.createElement('input');
	x_input.setAttribute('type','number');
	x_input.value = item[label];
	x.appendChild(x_input);
	x_input.oninput = function(){
		item[label] = parseFloat(this.value);
	}
	return x;
}


var buildRectEditor = function(item){
	var rect = document.createElement('div')
	var fieldset = document.createElement('fieldset');
	var legend = document.createElement('legend');
	legend.innerHTML = 'Studio.Rect : '+count;
	count++;
	var toggle = document.createElement('input');
	toggle.setAttribute('type','checkbox');
	fieldset.appendChild(toggle);
	rect.appendChild(fieldset);
	fieldset.appendChild(legend);
	var holder = document.createElement('div');
	fieldset.appendChild(holder);
	holder.appendChild(buildNumberAttribute('x',item));
	holder.appendChild(buildNumberAttribute('y',item));
	holder.appendChild(buildNumberAttribute('height',item));
	holder.appendChild(buildNumberAttribute('width',item));
	holder.appendChild(buildNumberAttribute('anchorX',item));
	holder.appendChild(buildNumberAttribute('anchorY',item));
	holder.appendChild(buildNumberAttribute('rotation',item));
	document.getElementById("editor").appendChild(rect);

}
var count = 0;

var buildFromSceneGraph = function(graph, editor){
	var temp = new Studio[graph.type];
	for (item in graph){
		switch (item){
			case 'color' : temp.color.style = (graph.color); break;
			case 'children' : 
				for(var i = 0; i !=graph.children.length; i++){
					temp.addChild(buildFromSceneGraph(graph.children[i], editor));
				}; break;
			break;
			case 'hasChildren': break;
			default: 
			if(typeof graph[item] == 'string' && graph[item].indexOf('function') > -1){
				temp[item] = eval('('+graph[item]+')');
			}else{
				temp[item] = graph[item];
			}
		}
	}
	if(editor) buildRectEditor(temp)
	return temp;
}




var ARM = {"color":"rgba(1,0,0,1)","anchorY":0.1,"width":50,"height":100,"y":50,"x":200,"children":[{"color":"rgba(85,85,85,1)","anchorY":0.15,"width":30,"height":120,"y":80,"x":0,"children":[{"color":"rgba(255,0,255,1)","anchorY":0.15,"width":20,"height":60,"y":90,"x":0,"children":[{"color":"rgba(0,255,255,1)","anchorY":0.15,"width":15,"height":40,"y":45,"x":0,"children":[{"color":"rgba(255,0,255,1)","width":5,"height":5,"y":0,"x":0,"onEnterFrame":"function (){\n\tthis.rotation+=5;\n}","type":"Rect"},{"color":"rgba(255,255,0,1)","anchorY":0.15,"width":11,"height":30,"y":30,"x":0,"children":[{"color":"rgba(0,255,255,1)","width":3,"height":3,"y":0,"x":0,"type":"Rect"}],"hasChildren":1,"onHoverStart":"function (){\n\tthis.color.setFromHex('#FF7F00')\n}","onHoverEnd":"function (){\n\tthis.color.setFromHex('#000')\n}","type":"Rect"}],"hasChildren":2,"type":"Rect"},{"color":"rgba(85,85,85,1)","width":7,"height":7,"y":0,"x":0,"onEnterFrame":"function (){\n\tthis.rotation+=5;\n}","type":"Rect"}],"hasChildren":2,"type":"Rect"},{"color":"rgba(0,0,0,1)","width":9,"height":9,"y":0,"x":0,"onEnterFrame":"function (){\n\tthis.rotation+=5;\n}","type":"Rect"}],"hasChildren":2,"type":"Rect"}],"hasChildren":1,"alpha":0.75,"onHoverStart":"function (){\n\tthis.color.setFromHex('#FF7F00')\n}","onHoverEnd":"function (){\n\tthis.color.setFromHex('#000')\n}","type":"Rect"};


// console.log(JSON.stringify(buildSceneGraph(shoulder)));


stage.addChild(buildFromSceneGraph(ARM, true));

Studio.start();
// Studio.active = false
</script>
</html>

