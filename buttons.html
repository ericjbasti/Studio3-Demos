<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
    <title>Studio3</title>
	<meta name="viewport" content="width=device-width, user-scalable=0, maximum-scale=1"/>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="apple-touch-icon" href="icon.png" />
</head>

<body style="margin:0;background: #333">
	<canvas id="canvas" height="400" width="600"  style="cursor:pointer;margin: 0 auto;display: block;outline:1px solid #BBFF00;"></canvas>
</body>
<script src="studio-compiled.js"></script>
<script src="stats.js"></script>
<style>
	canvas{image-rendering: -webkit-optimize-contrast;}

</style>
<script>
	
var stage = new Studio.Stage("canvas",{fullscreen:0, resolution: 1, dur: 1000/60});

Studio.UIButton = function(attr, stage){
	this.hovered = false;
	this.text = 'Button';
	if (attr) {
		this.apply(attr);
	}
	this.back = new Studio.Rect({height: this.height, width: this.width});
	this.back.color.setFromHex("#FF00FF")
	this.front = new Studio.Rect({height: this.height-4, width: this.width-4});
	this.front.color.set(0,0,0,.8);
	this.textBox = new Studio.TextBox(this.width-10, this.height, stage).apply({
		x: 0 , 
		y: 0 , 
		font: '16px BigBreak',
		lineHeight: 14 | 0 , 
		vertical_align: Studio.MIDDLE, 
		horizontal_align: 0.5,
		shadowColor: '#FF0080'
	})
	this.front.color.set(0,0,0,.8);
	this.textBox.setText(this.text).finish();
	this.addChildren(this.back,this.front,this.textBox);
	this.hoverIn_tween = stage.createTween(this, 'quadInOut', {scaleX: 1.2, scaleY: 1.2, rotation: 10}, 300).loop().reflect(true);
	this.hoverOut_tween = stage.createTween(this, 'quadOut', {scaleX: 1, scaleY: 1, rotation: 0}, 300);
}
Studio.UIButton.prototype = new Studio.DisplayObject();
Studio.UIButton.prototype.constructor = Studio.UIButton;

Studio.UIButton.prototype.onTap = Studio.UIButton.prototype.onHoverStart = function(a){
	if(this.hover){
		this.hover(a);
	}
}
Studio.UIButton.prototype.onTapOutside = Studio.UIButton.prototype.onHoverEnd = function(a){
	if(this.reset){
		this.reset(a);
	}
}

Studio.UIButton.prototype.onRelease = function(a){
	if(this.action){
		this.action(a);
	}
	if(this.reset){
		this.reset(a);
	}
}

var button = new Studio.UIButton({x:400,y:150, height: 24, width: 60, text:'Jump!'},stage);
button.hover = function(a){
	stage.stopTween(this.hoverOut_tween)
	stage.playTween(this.hoverIn_tween)
	this.back.color.setFromHex("#FF0080")
	this.textBox.setColor('#FFFF66').finish()
}
button.reset = function(a){
	stage.stopTween(this.hoverIn_tween);
	stage.playTween(this.hoverOut_tween)
	this.back.color.setFromHex("#FF00FF")
	this.textBox.setColor('#FFFFFF').finish()
}

button.action = function(a){
	t.velocityY = -20;
}

var buttonRight = new Studio.UIButton({x:450,y:200, height: 24, width: 24, text:'>'},stage);

buttonRight.hover = function(a){
	t.velocityX +=30;
}
var buttonLeft = new Studio.UIButton({x:410,y:200, height: 24, width: 24, text:'<'},stage);

buttonLeft.hover = function(a){
	t.velocityX -=30;
}
var button2 = new Studio.UIButton({x: 200, y: 100, height: 80, width: 300, text:"Hello Chupe...\n\nWelcome to a world of shapes. Those RED block? Oh you can stand on those if you want."}, stage)





var curse = new Studio.SpriteSheet('assets/Seperated.png')

var chupe = new Studio.SpriteSheet('assets/chupe.png')

var t = new Studio.SpriteAnimation({width: 32, height: 32, x: -10, y: 100, sheet: chupe, rect: {x:0,y:0, width: 32, height: 32}});

var right = {
	pant: [[0,1],[1,1],[2,1],[3,1]],
	walk: [[0,0],[1,0],[2,0],[3,0],[4,0],[5,0],[6,0],[7,0]],
	jump: [[6,1],[6,1]]
}

var left = {
	pant: [[0,3],[1,3],[2,3],[3,3]],
	walk: [[0,2],[1,2],[2,2],[3,2],[4,2],[5,2],[6,2],[7,2]],
	jump: [[5,3],[5,3]]
}
t.loop = right.walk;
t.hitbox = new Studio.DisplayObject({height: 32, width: 20});
t.addChild(t.hitbox);

var makePhysicObject = function(who, world){
	who.velocityY = 0;
	who.velocityX = 0;
	who.friction  = .9;
	who.onEnterFrame = function(){
		this.velocityY += world.gravity;
		if(this.velocityY>this.height/2) this.velocityY = this.height/2;
		this.velocityX *= this.friction;
		this.y+=this.velocityY;
		this.x+=this.velocityX;
		if(this.y+this.height*this.anchorY>world.height){
			this.y = world.height-(this.height*this.anchorX);
			this.velocityY = 0;
			t.jumping = false;
			t.platform = false;
		}
		if(this.x>world.width){
			this.x-=world.width;
		}
		if(this.x<0){
			this.x+=world.width;
		}
		if(this.platform){
			if(this.platform.velocityX)	this.x+=this.platform.velocityX;
		}
	}
}





stage.gravity = .78;


makePhysicObject( t, stage);

// RECT overlapdraw
// t.draw = function(ctx){
// 	this.setStyle(ctx);
// 	this.setAlpha(ctx);
// 	ctx.drawImage(this.image.image, this.rect.x, this.rect.y, this.rect.width, this.rect.height, this._dx - (this._world.width*this.anchorX), this._dy - (this._world.height*this.anchorY), this._world.width, this._world.height)
// 	if(this._dx -  (this._world.width*this.anchorX) < 0){
// 		ctx.drawImage(this.image.image, this.rect.x, this.rect.y, this.rect.width, this.rect.height, stage.width + this._dx - (this._world.width*this.anchorX), this._dy - (this._world.height*this.anchorY), this._world.width, this._world.height);
// 		return;
// 	}
// 	if((this._dx + this._world.width) > stage.width){
// 		ctx.drawImage(this.image.image, this.rect.x, this.rect.y, this.rect.width, this.rect.height, this._dx - (this._world.width*this.anchorX) -stage.width, this._dy - (this._world.height*this.anchorY), this._world.width, this._world.height);
// 		return; 
// 	}
// }
t.borderlap = true;
t.border= stage;



var blocks = [];

for (var i = 0; i != 2; i++){
	var block = new Studio.ImageSlice({x: 16+(i*32), y: 32*8, height: 32, width: 32, image:curse, rect:{x:0,y:32*12, width:32, height:32}})
	blocks.push(block);
	stage.addChild(block);
}

for (var i = 0; i != 2; i++){
	var block = new Studio.ImageSlice({x: (stage.width-16)-(i*32), y: 32*8, height: 32, width: 32, image:curse, rect:{x:0,y:32*12, width:32, height:32}})
	blocks.push(block);
	stage.addChild(block);
}

for (var i = 0; i != 4; i++){
	var block = new Studio.ImageSlice({x: (stage.width/2)-(i*32)+32, y: 32*10, height: 32, width: 32, image:curse, rect:{x:0,y:32*12, width:32, height:32}})
	blocks.push(block);
	stage.addChild(block);
}


var movers = new Studio.DisplayObject();
movers.x = (stage.width/2)-32
movers.y = 32*5;
var count = 0;
movers.onEnterFrame = function(){
	this.velocityX = Math.sin(count)*2;
	this.x += this.velocityX;
	count+=.02;
	for(var i = 0; i!= this.hasChildren; i++){
		this.children[i].velocityX = this.velocityX;
	}
}
for (var i = 0; i != 2; i++){
	var block = new Studio.ImageSlice({x: (i*32), y: 0, height: 32, width: 32, image:curse, rect:{x:0,y:32*13, width:32, height:32}})
	blocks.push(block);
	movers.addChild(block);
}
stage.addChild(movers)


var prizes = [];
var prizemax = 7;
var prizegot = 0;
for (var i = 0; i != prizemax; i++){
	var block = new Studio.ImageSlice({x: 100+(i*60), y: 64+parseInt(Math.random()*5)*32, height: 20, width: 20, image:curse, rect:{x:0,y:32*6, width:32, height:32}})
	prizes.push(block);
	stage.addChild(block);
}



t.jumping = false;
t.dir = right;

stage.gamepadInput = function(){
	if((this.keys[38] || this.keys["UP"] || this.keys["A"] || this.keys["B"])){
		if(!t.jumping){
			t.velocityY = -16;
			t.jumping = true;
		}
	}
	if(this.keys[37] || this.keys["LEFT"]){
		t.velocityX -= .51;
		t.dir = left;
	}
	if(this.keys[40] || this.keys["DOWN"]){
		//t.velocityY += 4;
	}
	if(this.keys[39] || this.keys["RIGHT"]){
		t.velocityX += .51;
		t.dir = right;
	}
	if (t.velocityY < 0){
		t.loop = t.dir.jump;
	}else{
		if (t.velocityX > 1 || t.velocityX < -1){
			t.loop = t.dir.walk;
		}else{
			t.loop = t.dir.pant;
		}
	}
}


stage.onExitFrame = function(){
	this.gamepadInput();
	for (var i = 0; i != blocks.length; i++){
		var block = blocks[i];

		if(block._world.x-32>t.x || block._world.x+32<t.x){

		}else if(block._world.y-32>t.y || block._world.y+32<t.y){

		}else if(t.hitbox.hitTestRect(block)){
			var dx = t.x-block._world.x;
			var dy = t.y-block._world.y;
			t.platform = block;
			if(dy<-10 && t.velocityY>0){
				if(t.y+(t.height*t.anchorY) < block._world.y){
					t.velocityY = 0;
					t.y = block._world.y-(block._world.height*block.anchorY)-(t._world.height*t.anchorY)-1;
					t._snapback();
					t.jumping = false;
				}
				return;
			}
		}else{

		}
	}

	for (var i = 0; i != prizes.length; i++){
		var block = prizes[i];
		if(block.got){

		}else if(block.x-32>t.x || block.x+32<t.x){
			
		}else if(block.y-32>t.y || block.y+32<t.y){

		}else if(t.hitTestRect(block)){
			block.got = true;
			prizegot++;
			stage.addTween(block,'quadOut', {scaleX: 2, scaleY: 2 , alpha: 0, rotation: 360}, 300 , function(){
				if(prizegot ==prizemax){
					for(var i = 0; i != prizes.length; i++){
						var block = prizes[i];
						block.y= 64+parseInt(Math.random()*5)*32;
						stage.addTween(block,'quadIn', {scaleX: 1, scaleY: 1 , alpha: 1, rotation: 0}, 300, function(){
							this.got = false;
						});
						prizegot = 0;
					}
				}
			});
		}else{
			// t.alpha = 1;
		}
	}


}

// stage.enableTouchEvents();

// stage.addButton(button);
// stage.addButton(buttonRight);
// stage.addButton(buttonLeft);
stage.addChild(t)


// stage.addChildren(button, buttonRight, buttonLeft);

// stage.addChild(button2)

// stage.addEffect(Studio.Effect.Bloom);
// stage.addEffect(Studio.Effect.BillAtkinsonDither_BW);
stage.addEffect(STATS,{
	external: false, 
	height: 60,
	width: stage.width,
	position: 0,
	clear_mode:'cover'}
);

stage.enableKeyboardInput();

var GAMEPAD = new Studio.Plugin({
	options: {
	},
	init: function(a) {
		this.gamepads = navigator.getGamepads();
		this.gamepad = null;
	    this.remote = null;
	},
	action: function(a) {
		this.gamepads = navigator.getGamepads();
		this.gamepad = null;
	    this.remote = null;

	    for(var z = 0; z!=this.gamepads.length;z++){
	        if(this.gamepads[z]){
	        	if(this.gamepads[z].id=='Remote'){
	            	this.remote = this.gamepads[z]
	            }else{
	            	this.gamepad = this.gamepads[z]
	            }
	        }
	    }
	    for(var i = 0; i != this.gamepads.length; i ++){
	        if(this.gamepads[i]){
	            this.gamepad = this.gamepads[i];
	            stage.keys['A'] = this.gamepad.buttons[0].value; // A
	            stage.keys['B'] = this.gamepad.buttons[1].value; // B
	            stage.keys['X'] = this.gamepad.buttons[2].value; // X
	            stage.keys['Y'] = this.gamepad.buttons[3].value; // Y

	            stage.keys['L1'] = this.gamepad.buttons[4].value; // L1
	            stage.keys['R1'] = this.gamepad.buttons[5].value; // R1
	            stage.keys['L2'] = this.gamepad.buttons[6].value; // L2
	            stage.keys['R2'] = this.gamepad.buttons[7].value; // R2

	            stage.keys['UP'] = this.gamepad.buttons[12].value; // Up
	            stage.keys['DOWN'] = this.gamepad.buttons[13].value; // Down
	            stage.keys['LEFT'] = this.gamepad.buttons[14].value; // Left
	            stage.keys['RIGHT'] = this.gamepad.buttons[15].value; // Right

	            //stage.keys['MENU'] = this.gamepad.buttons[16].value; // Menu

	            // drawAnalogStick(gamepad.axes[0], gamepad.axes[1], 540, 416); // left stick
	            // drawAnalogStick(gamepad.axes[2], gamepad.axes[3], 736, 416); // right stick
	            // ctx.translate(1200,0)
	        }
	    }
	}
})

if(navigator.getGamepads){
	stage.addEffect(GAMEPAD);
}

stage.snap=true
stage.ready = true;
Studio.start();
</script>
</html>

