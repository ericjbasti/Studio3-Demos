<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" >
    <title>Studio3</title>
	<meta name="viewport" content="width=device-width, user-scalable=0, maximum-scale=1"/>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="apple-touch-icon" href="icon.png" />
</head>

<body style="margin:0;background: #333">
	<canvas id="canvas" height="400" width="600"  style="cursor:pointer;margin: 0 auto;display: block;outline:1px solid #BBFF00;"></canvas>
</body>
<script src="studio-compiled.js"></script>
<script src="stats.js"></script>
<style>
	canvas{image-rendering: -webkit-optimize-contrast;}

</style>
<script>
	
var stage = new Studio.Stage("canvas",{fullscreen:0, resolution: 1, dur: 1000/60});

Studio.UIButton = function(attr, stage){
	this.hovered = false;
	this.text = 'Button';
	if (attr) {
		this.apply(attr);
	}
	this.back = new Studio.Rect({height: this.height, width: this.width});
	this.back.color.setFromHex("#FF00FF")
	this.front = new Studio.Rect({height: this.height-4, width: this.width-4});
	this.front.color.set(0,0,0,.8);
	this.textBox = new Studio.TextBox(this.width-10, this.height, stage).apply({
		x: 0 , 
		y: 0 , 
		font: '16px BigBreak',
		lineHeight: 14 | 0 , 
		vertical_align: Studio.MIDDLE, 
		horizontal_align: 0.5,
		shadowColor: '#FF0080'
	})
	this.front.color.set(0,0,0,.8);
	this.textBox.setText(this.text).finish();
	this.addChildren(this.back,this.front,this.textBox);
	this.hoverIn_tween = stage.createTween(this, 'quadInOut', {scaleX: 1.2, scaleY: 1.2, rotation: 10}, 300).loop().reflect(true);
	this.hoverOut_tween = stage.createTween(this, 'quadOut', {scaleX: 1, scaleY: 1, rotation: 0}, 300);
}
Studio.UIButton.prototype = new Studio.DisplayObject();
Studio.UIButton.prototype.constructor = Studio.UIButton;

Studio.UIButton.prototype.onTap = Studio.UIButton.prototype.onHoverStart = function(a){
	if(this.hover){
		this.hover(a);
	}
}
Studio.UIButton.prototype.onTapOutside = Studio.UIButton.prototype.onHoverEnd = function(a){
	if(this.reset){
		this.reset(a);
	}
}

Studio.UIButton.prototype.onRelease = function(a){
	if(this.action){
		this.action(a);
	}
	if(this.reset){
		this.reset(a);
	}
}

var button = new Studio.UIButton({x:400,y:150, height: 24, width: 60, text:'Jump!'},stage);
button.hover = function(a){
	stage.stopTween(this.hoverOut_tween)
	stage.playTween(this.hoverIn_tween)
	this.back.color.setFromHex("#FF0080")
	this.textBox.setColor('#FFFF66').finish()
}
button.reset = function(a){
	stage.stopTween(this.hoverIn_tween);
	stage.playTween(this.hoverOut_tween)
	this.back.color.setFromHex("#FF00FF")
	this.textBox.setColor('#FFFFFF').finish()
}

button.action = function(a){
	t.velocityY = -20;
}

var buttonRight = new Studio.UIButton({x:450,y:200, height: 24, width: 24, text:'>'},stage);

buttonRight.hover = function(a){
	t.velocityX +=30;
}
var buttonLeft = new Studio.UIButton({x:410,y:200, height: 24, width: 24, text:'<'},stage);

buttonLeft.hover = function(a){
	t.velocityX -=30;
}
var button2 = new Studio.UIButton({x: 200, y: 200, height: 330, width: 300, text:"Lorem ipsum dolor...\n\nSit amet, consectetur adipiscing elit. Quisque feugiat eleifend malesuada. Proin bibendum nunc et imperdiet viverra. Suspendisse lectus quam, tempus nec consequat tristique, pharetra a leo. Vestibulum cursus est libero, sit amet maximus erat faucibus tempor. Vestibulum at mauris ut felis eleifend finibus eget a nunc. Duis efficitur maximus leo, vel porta urna hendrerit ac.\n\nPraesent convallis tempus risus id fringilla. Aliquam id est sit amet ex tincidunt luctus ac nec nisi. Vestibulum sed libero vel enim scelerisque ornare vitae sed orci. Maecenas tincidunt turpis nibh, vitae tristique nulla commodo a. Nulla in mi in ipsum facilisis eleifend eu lobortis nunc. Aenean rhoncus, lorem a dictum consectetur, augue orci ornare lorem, sed tristique sapien orci eget lorem. Nulla ullamcorper sem vel risus commodo, iaculis dapibus arcu molestiy."}, stage)


var t = new Studio.Rect({width: 32, height: 32, x: -10, y: 100, color: Studio.BLUE})

var makePhysicObject = function(who, world){
	who.velocityY = 0;
	who.velocityX = 0;
	who.friction  = .9;
	who.onEnterFrame = function(){
		this.velocityY += world.gravity;
		this.velocityX *= this.friction;
		this.y+=this.velocityY;
		this.x+=this.velocityX;
		if(this.y+this.height*this.anchorY>world.height){
			this.y = world.height-(this.height*this.anchorX);
		}
		if(this.x>world.width){
			this.x-=world.width;
		}
		if(this.x<0){
			this.x+=world.width;
		}
	}
}



stage.gravity = .78;


makePhysicObject( t, stage);

t.draw = function(ctx){
	this.setStyle(ctx);
	this.setAlpha(ctx);
	ctx.fillRect(this._dx - (this._world.width*this.anchorX), this._dy - (this._world.height*this.anchorY), this._world.width, this._world.height)
	if(this._dx < 0){
		ctx.fillRect(stage.width + this._dx - (this._world.width*this.anchorX), this._dy - (this._world.height*this.anchorY), this._world.width, this._world.height);
		return;
	}
	if((this._dx + this._world.width) > stage.width){
		ctx.fillRect(this._dx - (this._world.width*this.anchorX) -stage.width, this._dy - (this._world.height*this.anchorY), this._world.width, this._world.height);
		return; 
	}
}

var block = new Studio.Rect({x:300, y: 300, height: 32, width: 32, color: Studio.RED})



stage.onEnterFrame = function(){
	if(this.keys[38] || this.keys["UP"]){
		t.velocityY = -10;
	}
	if(this.keys[37] || this.keys["LEFT"]){
		t.velocityX -= .51;
	}
	if(this.keys[40] || this.keys["DOWN"]){
		//t.velocityY += 4;
	}
	if(this.keys[39] || this.keys["RIGHT"]){
		t.velocityX += .51;
	}

	if(t.hitTestRect(block)){
		// if(t.velocityY<=0){
		// 	t.velocityY = 0;
		// 	t.y = block._world.y+(block._world.height*block.anchorY)+(t._world.height*t.anchorY);
		// 	t._snapback();
		// 	return;
		// }
		if(t.velocityY>=0){
			if(t.y+(t.height*t.anchorY) < block.y){
				t.velocityY = 0;
				t.y = block._world.y-(block._world.height*block.anchorY)-(t._world.height*t.anchorY);
				t._snapback();
			}
			return;
		}
		if(t.x < block._world.x){
			t.velocityX =0
			t.x = ((block._world.x-(block._world.width*block.anchorX))-t.width-1) | 0 ;
			// t.x=;
		}
		if(t.x> block._world.x){
			t.velocityX =0
			t.x = ((block._world.x+(block._world.width*block.anchorX))) | 0 ;
			// t.x=;
		}
		// t.alpha = .5;
	}else{
		// t.alpha = 1;
	}

}

stage.enableTouchEvents();

stage.addChildren(button, buttonRight, buttonLeft);

// stage.addChild(button2)

stage.addButton(button);
stage.addButton(buttonRight);
stage.addButton(buttonLeft);
stage.addChild(t)


// stage.addEffect(Studio.Effect.Bloom);
// stage.addEffect(Studio.Effect.BillAtkinsonDither_BW);
stage.addEffect(STATS,{
	external: false, 
	height: 50,
	width: stage.width,
	position: 0,
	clear_mode:'cover'}
);

stage.enableKeyboardInput();

var GAMEPAD = new Studio.Plugin({
	options: {
	},
	init: function(a) {
		this.gamepads = navigator.getGamepads();
		this.gamepad = null;
	    this.remote = null;
	},
	action: function(a) {
		this.gamepads = navigator.getGamepads();
		this.gamepad = null;
	    this.remote = null;

	    for(var z = 0; z!=this.gamepads.length;z++){
	        if(this.gamepads[z]){
	        	if(this.gamepads[z].id=='Remote'){
	            	this.remote = this.gamepads[z]
	            }else{
	            	this.gamepad = this.gamepads[z]
	            }
	        }
	    }
	    for(var i = 0; i != this.gamepads.length; i ++){
	        if(this.gamepads[i]){
	            this.gamepad = this.gamepads[i];
	            stage.keys['A'] = this.gamepad.buttons[0].value; // A
	            stage.keys['B'] = this.gamepad.buttons[1].value; // B
	            stage.keys['X'] = this.gamepad.buttons[2].value; // X
	            stage.keys['Y'] = this.gamepad.buttons[3].value; // Y

	            stage.keys['L1'] = this.gamepad.buttons[4].value; // L1
	            stage.keys['R1'] = this.gamepad.buttons[5].value; // R1
	            stage.keys['L2'] = this.gamepad.buttons[6].value; // L2
	            stage.keys['R2'] = this.gamepad.buttons[7].value; // R2

	            stage.keys['UP'] = this.gamepad.buttons[12].value; // Up
	            stage.keys['DOWN'] = this.gamepad.buttons[13].value; // Down
	            stage.keys['LEFT'] = this.gamepad.buttons[14].value; // Left
	            stage.keys['RIGHT'] = this.gamepad.buttons[15].value; // Right

	            //stage.keys['MENU'] = this.gamepad.buttons[16].value; // Menu

	            // drawAnalogStick(gamepad.axes[0], gamepad.axes[1], 540, 416); // left stick
	            // drawAnalogStick(gamepad.axes[2], gamepad.axes[3], 736, 416); // right stick
	            // ctx.translate(1200,0)
	        }
	    }
	}
})

stage.addChild(block);
if(navigator.getGamepads){
	stage.addEffect(GAMEPAD);
}


stage.ready = true;
Studio.start();
</script>
</html>

